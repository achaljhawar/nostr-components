var ah=Object.create;var Nn=Object.defineProperty;var ch=Object.getOwnPropertyDescriptor;var lh=Object.getOwnPropertyNames;var uh=Object.getPrototypeOf,hh=Object.prototype.hasOwnProperty;var fh=(e,t,n)=>t in e?Nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var dh=e=>Nn(e,"__esModule",{value:!0});var dt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Uo=(e,t)=>{for(var n in t)Nn(e,n,{get:t[n],enumerable:!0})},ph=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of lh(t))!hh.call(e,s)&&(n||s!=="default")&&Nn(e,s,{get:()=>t[s],enumerable:!(r=ch(t,s))||r.enumerable});return e},Q=(e,t)=>ph(dh(Nn(e!=null?ah(uh(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var et=(e,t,n)=>(fh(e,typeof t!="symbol"?t+"":t,n),n);var Mo=dt(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0})});var bs=dt(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir._fast_remove_single=void 0;function gh(e,t){t!==-1&&(t===0?e.shift():t===e.length-1?e.length=e.length-1:e.splice(t,1))}ir._fast_remove_single=gh});var No=dt((exports,module)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0;exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(e){var t="";if(e===0)return t;for(var n=0;n<e-1;++n)t+="arg"+String(n)+", ";return t+="arg"+String(e-1),t}function generateBodyPartsCode(e,t){for(var n="",r="",s=0;s<t;++s)n+="var f".concat(s," = collection[").concat(s,`];
`),r+="f".concat(s,"(").concat(e,`)
`);return{funcDefCode:n,funcCallCode:r}}function generateBodyPartsVariadicCode(e){for(var t="",n="",r=0;r<e;++r)t+="var f".concat(r," = collection[").concat(r,`];
`),n+="f".concat(r,`.apply(undefined, arguments)
`);return{funcDefCode:t,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var bakeCollection_1=void 0,fixedArgsNum_1=void 0,bakeCollectionVariadic_1=void 0,bakeCollectionAwait_1=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var bakeCollection_2=void 0,fixedArgsNum_2=void 0,bakeCollectionVariadic_2=void 0,bakeCollectionAwait_2=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var bakeCollection_3=void 0,fixedArgsNum=void 0,bakeCollectionVariadic_3=void 0,bakeCollectionAwait_3=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic});var Ho=dt(pn=>{"use strict";var Oo=pn&&pn.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,i;r<s;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(pn,"__esModule",{value:!0});pn.TaskCollection=void 0;var $o=bs(),re=No();function yh(e,t){var n=this.length;if(n>1)if(t){var r;(r=this._tasks).push.apply(r,arguments),this.length+=arguments.length}else this._tasks.push(e),this.length++;else if(t){if(n===1){var s=Array(1+arguments.length);s.push(s),s.push.apply(s,arguments),this._tasks=s}else{var s=Array(arguments.length);s.push.apply(s,arguments),this._tasks=s}this.length+=arguments.length}else n===1?this._tasks=[this._tasks,e]:this._tasks=e,this.length++}function mh(e,t){var n=this.length;if(n>1)if(t){var r;(r=this._tasks).push.apply(r,arguments),this.length+=arguments.length}else this._tasks.push(e),this.length++;else if(t){if(n===1){var s=Array(1+arguments.length);s.push(s),s.push.apply(s,arguments),this._tasks=s}else{var s=Array(arguments.length);s.push.apply(s,arguments),this._tasks=s}this.length+=arguments.length}else n===1?this._tasks=[this._tasks,e]:this._tasks=e,this.length++;this.firstEmitBuildStrategy?this.call=On:this.rebuild()}function bh(e){this.length!==0&&(this.length===1?this._tasks===e&&(this.length=0):((0,$o._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(e)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function wh(e){if(this.length!==0){if(this.length===1)if(this._tasks===e&&(this.length=0),this.firstEmitBuildStrategy){this.call=re.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,$o._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(e)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=On:this.rebuild()}}function vh(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.length===0?(this._tasks=n,this.length=1):this.length===1?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((t=this._tasks).splice.apply(t,Oo([e,0],n,!1)),this.length=this._tasks.length)}function xh(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.length===0?(this._tasks=n,this.length=1):this.length===1?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((t=this._tasks).splice.apply(t,Oo([e,0],n,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=On:this.rebuild()}function Eh(){this.length===0?this.call=re.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,re.bakeCollection)(this._tasks,this.argsNum)}function kh(){this.length===0?this.call=re.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,re.bakeCollectionAwait)(this._tasks,this.argsNum)}function On(){this.rebuild(),this.call.apply(void 0,arguments)}var $e=function(){function e(t,n,r,s){n===void 0&&(n=!0),r===void 0&&(r=null),s===void 0&&(s=!1),this.awaitTasks=s,this.call=re.BAKED_EMPTY_FUNC,this.argsNum=t,this.firstEmitBuildStrategy=!0,s?this.rebuild=kh.bind(this):this.rebuild=Eh.bind(this),this.setAutoRebuild(n),r?typeof r=="function"?(this._tasks=r,this.length=1):(this._tasks=r,this.length=r.length):(this._tasks=null,this.length=0),n&&this.rebuild()}return e}();pn.TaskCollection=$e;function Th(){this._tasks=null,this.length=0,this.call=re.BAKED_EMPTY_FUNC}function Ah(){this._tasks=null,this.length=0,this.call=re.BAKED_EMPTY_FUNC}function _h(e){this.argsNum<e&&(this.argsNum=e,this.firstEmitBuildStrategy?this.call=On:this.rebuild())}function Sh(e){e?(this.push=mh.bind(this),this.insert=xh.bind(this),this.removeLast=wh.bind(this)):(this.push=yh.bind(this),this.insert=vh.bind(this),this.removeLast=bh.bind(this))}function Rh(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function Ch(e){e.length===0?(this.length=0,this.call=re.BAKED_EMPTY_FUNC):e.length===1?(this.length=1,this.call=e[0],this._tasks=e[0]):(this.length=e.length,this._tasks=e,this.firstEmitBuildStrategy?this.call=On:this.rebuild())}$e.prototype.fastClear=Th;$e.prototype.clear=Ah;$e.prototype.growArgsNum=_h;$e.prototype.setAutoRebuild=Sh;$e.prototype.tasksAsArray=Rh;$e.prototype.setTasks=Ch});var qo=dt(He=>{"use strict";var Ih=He&&He.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Lh=He&&He.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&Ih(t,e,n)};Object.defineProperty(He,"__esModule",{value:!0});Lh(Ho(),He)});var zo=dt(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.nullObj=void 0;function Bh(){var e={};return e.__proto__=null,e}or.nullObj=Bh});var jo=dt(yn=>{"use strict";var qe=yn&&yn.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,i;r<s;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(yn,"__esModule",{value:!0});yn.EventEmitter=void 0;var ws=qo(),Uh=bs(),ar=zo();function gn(e,t,n,r,s,i){var o=this.events[e];if(o){if(o.length===0)return!1;if(o.argsNum<6)o.call(t,n,r,s,i);else{for(var a=new Array(o.argsNum),c=0,l=a.length;c<l;++c)a[c]=arguments[c+1];o.call.apply(void 0,a)}return!0}return!1}function Vo(e,t,n,r,s,i){var o=this.events[e],a;if(o!==void 0){if(o.length===0)return!1;if(o.argsNum<6)o.call(t,n,r,s,i);else{a=new Array(o.argsNum);for(var c=0,l=a.length;c<l;++c)a[c]=arguments[c+1];o.call.apply(void 0,a)}}var u=this.onceEvents[e];if(u){if(typeof u=="function")if(this.onceEvents[e]=void 0,arguments.length<6)u(t,n,r,s,i);else{if(a===void 0){a=new Array(arguments.length-1);for(var c=0,l=a.length;c<l;++c)a[c]=arguments[c+1]}u.apply(void 0,a)}else{var h=u;if(this.onceEvents[e]=void 0,arguments.length<6)for(var c=0;c<h.length;++c)h[c](t,n,r,s,i);else{if(a===void 0){a=new Array(arguments.length-1);for(var c=0,l=a.length;c<l;++c)a[c]=arguments[c+1]}for(var c=0;c<h.length;++c)h[c].apply(void 0,a)}}return!0}return o!==void 0}var ht=function(){function e(){this.events=(0,ar.nullObj)(),this.onceEvents=(0,ar.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(e.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),e}();yn.EventEmitter=ht;function Ph(e,t){switch(this.emit===gn&&(this.emit=Vo),typeof this.onceEvents[e]){case"undefined":this.onceEvents[e]=t,typeof e=="symbol"&&this._symbolKeys.add(e);break;case"function":this.onceEvents[e]=[this.onceEvents[e],t];break;case"object":this.onceEvents[e].push(t)}return this}function Do(e,t,n){if(n===void 0&&(n=t.length),typeof t!="function")throw new TypeError("The listener must be a function");var r=this.events[e];return r?(r.push(t),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" event!'))):(this.events[e]=new ws.TaskCollection(n,!0,t,!1),typeof e=="symbol"&&this._symbolKeys.add(e)),this}function Fo(e,t){var n=this.events[e];n&&n.removeLast(t);var r=this.onceEvents[e];return r&&(typeof r=="function"?this.onceEvents[e]=void 0:typeof r=="object"&&(r.length===1&&r[0]===t?this.onceEvents[e]=void 0:(0,Uh._fast_remove_single)(r,r.lastIndexOf(t)))),this}function Mh(e,t,n,r){n===void 0&&(n=this),r===void 0&&(r=t.length),this.boundFuncs||(this.boundFuncs=new Map);var s=t.bind(n);return this.boundFuncs.set(t,s),this.addListener(e,s,r)}function Nh(e,t){var n,r,s=(n=this.boundFuncs)===null||n===void 0?void 0:n.get(t);return(r=this.boundFuncs)===null||r===void 0||r.delete(t),this.removeListener(e,s)}function Oh(e){return this.events[e]&&!!this.events[e].length}function $h(e,t,n){if(n===void 0&&(n=t.length),typeof t!="function")throw new TypeError("The listener must be a function");var r=this.events[e];return!r||!(r instanceof ws.TaskCollection)?(r=this.events[e]=new ws.TaskCollection(n,!0,t,!1),typeof e=="symbol"&&this._symbolKeys.add(e)):(r.insert(0,t),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" event!'))),this}function Hh(e,t){this.emit===gn&&(this.emit=Vo);var n=this.onceEvents[e];return n?typeof n!="object"?(this.onceEvents[e]=[t,n],typeof e=="symbol"&&this._symbolKeys.add(e)):(n.unshift(t),this.maxListeners!==1/0&&this.maxListeners<=n.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" once event!'))):(this.onceEvents[e]=[t],typeof e=="symbol"&&this._symbolKeys.add(e)),this}function qh(e){return e===void 0?(this.events=(0,ar.nullObj)(),this.onceEvents=(0,ar.nullObj)(),this._symbolKeys=new Set):(this.events[e]=void 0,this.onceEvents[e]=void 0,typeof e=="symbol"&&this._symbolKeys.delete(e)),this}function zh(e){return this.maxListeners=e,this}function Vh(){return this.maxListeners}function Dh(e){return this.emit===gn?this.events[e]?this.events[e].tasksAsArray().slice():[]:this.events[e]&&this.onceEvents[e]?qe(qe([],this.events[e].tasksAsArray(),!0),typeof this.onceEvents[e]=="function"?[this.onceEvents[e]]:this.onceEvents[e],!0):this.events[e]?this.events[e].tasksAsArray():this.onceEvents[e]?typeof this.onceEvents[e]=="function"?[this.onceEvents[e]]:this.onceEvents[e]:[]}function Fh(){var e=this;if(this.emit===gn){var t=Object.keys(this.events);return qe(qe([],t,!0),Array.from(this._symbolKeys),!0).filter(function(r){return r in e.events&&e.events[r]&&e.events[r].length})}else{var t=Object.keys(this.events).filter(function(s){return e.events[s]&&e.events[s].length}),n=Object.keys(this.onceEvents).filter(function(s){return e.onceEvents[s]&&e.onceEvents[s].length});return qe(qe(qe([],t,!0),n,!0),Array.from(this._symbolKeys).filter(function(s){return s in e.events&&e.events[s]&&e.events[s].length||s in e.onceEvents&&e.onceEvents[s]&&e.onceEvents[s].length}),!0)}}function jh(e){return this.emit===gn?this.events[e]&&this.events[e].length||0:(this.events[e]&&this.events[e].length||0)+(this.onceEvents[e]&&this.onceEvents[e].length||0)}ht.prototype.emit=gn;ht.prototype.on=Do;ht.prototype.once=Ph;ht.prototype.addListener=Do;ht.prototype.removeListener=Fo;ht.prototype.addListenerBound=Mh;ht.prototype.removeListenerBound=Nh;ht.prototype.hasListeners=Oh;ht.prototype.prependListener=$h;ht.prototype.prependOnceListener=Hh;ht.prototype.off=Fo;ht.prototype.removeAllListeners=qh;ht.prototype.setMaxListeners=zh;ht.prototype.getMaxListeners=Vh;ht.prototype.listeners=Dh;ht.prototype.eventNames=Fh;ht.prototype.listenerCount=jh});var jt=dt(me=>{"use strict";var Wh=me&&me.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),Wo=me&&me.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&Wh(t,e,n)};Object.defineProperty(me,"__esModule",{value:!0});Wo(Mo(),me);Wo(jo(),me)});var Zo=dt((mb,Go)=>{var mn=1e3,bn=mn*60,wn=bn*60,ze=wn*24,Gh=ze*7,Zh=ze*365.25;Go.exports=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return Yh(e);if(n==="number"&&isFinite(e))return t.long?Qh(e):Jh(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Yh(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*Zh;case"weeks":case"week":case"w":return n*Gh;case"days":case"day":case"d":return n*ze;case"hours":case"hour":case"hrs":case"hr":case"h":return n*wn;case"minutes":case"minute":case"mins":case"min":case"m":return n*bn;case"seconds":case"second":case"secs":case"sec":case"s":return n*mn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function Jh(e){var t=Math.abs(e);return t>=ze?Math.round(e/ze)+"d":t>=wn?Math.round(e/wn)+"h":t>=bn?Math.round(e/bn)+"m":t>=mn?Math.round(e/mn)+"s":e+"ms"}function Qh(e){var t=Math.abs(e);return t>=ze?cr(e,t,ze,"day"):t>=wn?cr(e,t,wn,"hour"):t>=bn?cr(e,t,bn,"minute"):t>=mn?cr(e,t,mn,"second"):e+" ms"}function cr(e,t,n,r){var s=t>=n*1.5;return Math.round(e/n)+" "+r+(s?"s":"")}});var Jo=dt((bb,Yo)=>{function Xh(e){n.debug=n,n.default=n,n.coerce=c,n.disable=o,n.enable=s,n.enabled=a,n.humanize=Zo(),n.destroy=l,Object.keys(e).forEach(u=>{n[u]=e[u]}),n.names=[],n.skips=[],n.formatters={};function t(u){let h=0;for(let f=0;f<u.length;f++)h=(h<<5)-h+u.charCodeAt(f),h|=0;return n.colors[Math.abs(h)%n.colors.length]}n.selectColor=t;function n(u){let h,f=null,g,y;function p(...d){if(!p.enabled)return;let m=p,v=Number(new Date),E=v-(h||v);m.diff=E,m.prev=h,m.curr=v,h=v,d[0]=n.coerce(d[0]),typeof d[0]!="string"&&d.unshift("%O");let T=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,(S,I)=>{if(S==="%%")return"%";T++;let R=n.formatters[I];if(typeof R=="function"){let L=d[T];S=R.call(m,L),d.splice(T,1),T--}return S}),n.formatArgs.call(m,d),(m.log||n.log).apply(m,d)}return p.namespace=u,p.useColors=n.useColors(),p.color=n.selectColor(u),p.extend=r,p.destroy=n.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(g!==n.namespaces&&(g=n.namespaces,y=n.enabled(u)),y),set:d=>{f=d}}),typeof n.init=="function"&&n.init(p),p}function r(u,h){let f=n(this.namespace+(typeof h=="undefined"?":":h)+u);return f.log=this.log,f}function s(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let h=(typeof u=="string"?u:"").trim().replace(" ",",").split(",").filter(Boolean);for(let f of h)f[0]==="-"?n.skips.push(f.slice(1)):n.names.push(f)}function i(u,h){let f=0,g=0,y=-1,p=0;for(;f<u.length;)if(g<h.length&&(h[g]===u[f]||h[g]==="*"))h[g]==="*"?(y=g,p=f,g++):(f++,g++);else if(y!==-1)g=y+1,p++,f=p;else return!1;for(;g<h.length&&h[g]==="*";)g++;return g===h.length}function o(){let u=[...n.names,...n.skips.map(h=>"-"+h)].join(",");return n.enable(""),u}function a(u){for(let h of n.skips)if(i(u,h))return!1;for(let h of n.names)if(i(u,h))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}Yo.exports=Xh});var Rt=dt((vt,lr)=>{vt.formatArgs=tf;vt.save=ef;vt.load=nf;vt.useColors=Kh;vt.storage=rf();vt.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();vt.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Kh(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function tf(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+lr.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(n++,s==="%c"&&(r=n))}),e.splice(r,0,t)}vt.log=console.debug||console.log||(()=>{});function ef(e){try{e?vt.storage.setItem("debug",e):vt.storage.removeItem("debug")}catch{}}function nf(){let e;try{e=vt.storage.getItem("debug")}catch{}return!e&&typeof process!="undefined"&&"env"in process&&(e=process.env.DEBUG),e}function rf(){try{return localStorage}catch{}}lr.exports=Jo()(vt);var{formatters:sf}=lr.exports;sf.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var Nl=dt(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});os.LRUCacheNode=void 0;var Ml=class{constructor(t,n,r){let{entryExpirationTimeInMS:s=null,next:i=null,prev:o=null,onEntryEvicted:a,onEntryMarkedAsMostRecentlyUsed:c,clone:l,cloneFn:u}=r??{};if(typeof s=="number"&&(s<=0||Number.isNaN(s)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=l??!1,this.cloneFn=u??this.defaultClone,this.key=t,this.internalValue=this.clone?this.cloneFn(n):n,this.created=Date.now(),this.entryExpirationTimeInMS=s,this.next=i,this.prev=o,this.onEntryEvicted=a,this.onEntryMarkedAsMostRecentlyUsed=c}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){let{key:t,value:n,isExpired:r}=this;this.onEntryEvicted({key:t,value:n,isExpired:r})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){let{key:t,value:n}=this;this.onEntryMarkedAsMostRecentlyUsed({key:t,value:n})}}defaultClone(t){return typeof t=="boolean"||typeof t=="string"||typeof t=="number"?t:JSON.parse(JSON.stringify(t))}};os.LRUCacheNode=Ml});var $l=dt(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});as.LRUCache=void 0;var K0=Nl(),Ol=class{constructor(t){this.lookupTable=new Map,this.head=null,this.tail=null;let{maxSize:n=25,entryExpirationTimeInMS:r=null,onEntryEvicted:s,onEntryMarkedAsMostRecentlyUsed:i,cloneFn:o,clone:a}=t??{};if(Number.isNaN(n)||n<=0)throw new Error("maxSize must be greater than 0.");if(typeof r=="number"&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=n,this.entryExpirationTimeInMS=r,this.onEntryEvicted=s,this.onEntryMarkedAsMostRecentlyUsed=i,this.clone=a,this.cloneFn=o}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(t){if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=t,this.enforceSizeLimit()}set(t,n,r){let s=this.lookupTable.get(t);s&&this.removeNodeFromListAndLookupTable(s);let i=new K0.LRUCacheNode(t,n,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...r});return this.setNodeAsHead(i),this.lookupTable.set(t,i),this.enforceSizeLimit(),this}get(t){let n=this.lookupTable.get(t);return n?n.isExpired?(this.removeNodeFromListAndLookupTable(n),null):(this.setNodeAsHead(n),n.value):null}peek(t){let n=this.lookupTable.get(t);return n?n.isExpired?(this.removeNodeFromListAndLookupTable(n),null):n.value:null}delete(t){let n=this.lookupTable.get(t);return n?this.removeNodeFromListAndLookupTable(n):!1}has(t){let n=this.lookupTable.get(t);return n?n.isExpired?(this.removeNodeFromListAndLookupTable(n),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(t){let n=this.head;for(;n;){if(n.isExpired){let s=n.next;this.removeNodeFromListAndLookupTable(n),n=s;continue}let r=this.mapNodeToEntry(n);if(t(r))return this.setNodeAsHead(n),r;n=n.next}return null}forEach(t){let n=this.head,r=0;for(;n;){if(n.isExpired){let s=n.next;this.removeNodeFromListAndLookupTable(n),n=s;continue}t(n.value,n.key,r),n=n.next,r++}}*values(){let t=this.head;for(;t;){if(t.isExpired){let n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield t.value,t=t.next}}*keys(){let t=this.head;for(;t;){if(t.isExpired){let n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield t.key,t=t.next}}*entries(){let t=this.head;for(;t;){if(t.isExpired){let n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield this.mapNodeToEntry(t),t=t.next}}*[Symbol.iterator](){let t=this.head;for(;t;){if(t.isExpired){let n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield this.mapNodeToEntry(t),t=t.next}}enforceSizeLimit(){let t=this.tail;for(;t!==null&&this.size>this.maxSizeInternal;){let n=t.prev;this.removeNodeFromListAndLookupTable(t),t=n}}mapNodeToEntry({key:t,value:n}){return{key:t,value:n}}setNodeAsHead(t){this.removeNodeFromList(t),this.head?(t.next=this.head,this.head.prev=t,this.head=t):(this.head=t,this.tail=t),t.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(t){t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.head===t&&(this.head=t.next),this.tail===t&&(this.tail=t.prev),t.next=null,t.prev=null}removeNodeFromListAndLookupTable(t){return t.invokeOnEvicted(),this.removeNodeFromList(t),this.lookupTable.delete(t.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;let t=[];for(let n of this.lookupTable.values())n.isExpired&&t.push(n);t.forEach(n=>this.removeNodeFromListAndLookupTable(n))}};as.LRUCache=Ol});var ro=dt(rn=>{"use strict";var ty=rn&&rn.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),ey=rn&&rn.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&ty(t,e,n)};Object.defineProperty(rn,"__esModule",{value:!0});ey($l(),rn)});var iu=dt(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.bytes=q.stringToBytes=q.str=q.bytesToString=q.hex=q.utf8=q.bech32m=q.bech32=q.base58check=q.base58xmr=q.base58xrp=q.base58flickr=q.base58=q.base64url=q.base64=q.base32crockford=q.base32hex=q.base32=q.base16=q.utils=q.assertNumber=void 0;function Ne(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}q.assertNumber=Ne;function Dt(...e){let t=(s,i)=>o=>s(i(o)),n=Array.from(e).reverse().reduce((s,i)=>s?t(s,i.encode):i.encode,void 0),r=e.reduce((s,i)=>s?t(s,i.decode):i.decode,void 0);return{encode:n,decode:r}}function Xt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Ne(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function Kt(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function er(e,t="="){if(Ne(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Zl(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Yl(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0,s=[],i=Array.from(e);for(i.forEach(o=>{if(Ne(o),o<0||o>=t)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=r;c<i.length;c++){let l=i[c],u=t*o+l;if(!Number.isSafeInteger(u)||t*o/t!==o||u-l!==t*o)throw new Error("convertRadix: carry overflow");if(o=u%n,i[c]=Math.floor(u/n),!Number.isSafeInteger(i[c])||i[c]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)i[c]?a=!1:r=c;else continue}if(s.push(o),a)break}for(let o=0;o<e.length-1&&e[o]===0;o++)s.push(0);return s.reverse()}var Jl=(e,t)=>t?Jl(t,e%t):e,ds=(e,t)=>e+(t-Jl(e,t));function uo(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ds(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${ds(t,n)}`);let s=0,i=0,o=2**n-1,a=[];for(let c of e){if(Ne(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(s=s<<t|c,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)a.push((s>>i-n&o)>>>0);s&=2**i-1}if(s=s<<n-i&o,!r&&i>=t)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&i>0&&a.push(s>>>0),a}function Ql(e){return Ne(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Yl(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Yl(t,e,2**8))}}}function ye(e,t=!1){if(Ne(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(ds(8,e)>32||ds(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return uo(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(uo(n,e,8,t))}}}function Xl(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}function Kl(e,t){if(Ne(e),typeof t!="function")throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");let r=t(n).slice(0,e),s=new Uint8Array(n.length+e);return s.set(n),s.set(r,n.length),s},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");let r=n.slice(0,-e),s=t(r).slice(0,e),i=n.slice(-e);for(let o=0;o<e;o++)if(s[o]!==i[o])throw new Error("Invalid checksum");return r}}}q.utils={alphabet:Xt,chain:Dt,checksum:Kl,radix:Ql,radix2:ye,join:Kt,padding:er};q.base16=Dt(ye(4),Xt("0123456789ABCDEF"),Kt(""));q.base32=Dt(ye(5),Xt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),er(5),Kt(""));q.base32hex=Dt(ye(5),Xt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),er(5),Kt(""));q.base32crockford=Dt(ye(5),Xt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Kt(""),Zl(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));q.base64=Dt(ye(6),Xt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),er(6),Kt(""));q.base64url=Dt(ye(6),Xt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),er(6),Kt(""));var ho=e=>Dt(Ql(58),Xt(e),Kt(""));q.base58=ho("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");q.base58flickr=ho("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");q.base58xrp=ho("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");var tu=[0,2,3,5,6,7,9,10,11];q.base58xmr={encode(e){let t="";for(let n=0;n<e.length;n+=8){let r=e.subarray(n,n+8);t+=q.base58.encode(r).padStart(tu[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){let r=e.slice(n,n+11),s=tu.indexOf(r.length),i=q.base58.decode(r);for(let o=0;o<i.length-s;o++)if(i[o]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(i.slice(i.length-s)))}return Uint8Array.from(t)}};var ry=e=>Dt(Kl(4,t=>e(e(t))),q.base58);q.base58check=ry;var fo=Dt(Xt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Kt("")),eu=[996825010,642813549,513874426,1027748829,705979059];function nr(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<eu.length;r++)(t>>r&1)===1&&(n^=eu[r]);return n}function nu(e,t,n=1){let r=e.length,s=1;for(let i=0;i<r;i++){let o=e.charCodeAt(i);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);s=nr(s)^o>>5}s=nr(s);for(let i=0;i<r;i++)s=nr(s)^e.charCodeAt(i)&31;for(let i of t)s=nr(s)^i;for(let i=0;i<6;i++)s=nr(s);return s^=n,fo.encode(uo([s%2**30],30,5,!1))}function ru(e){let t=e==="bech32"?1:734539939,n=ye(5),r=n.decode,s=n.encode,i=Xl(r);function o(u,h,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);let g=u.length+7+h.length;if(f!==!1&&g>f)throw new TypeError(`Length ${g} exceeds limit ${f}`);return u=u.toLowerCase(),`${u}1${fo.encode(h)}${nu(u,h,t)}`}function a(u,h=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||h!==!1&&u.length>h)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${h})`);let f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=f;let g=u.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');let y=u.slice(0,g),p=u.slice(g+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");let d=fo.decode(p).slice(0,-6),m=nu(y,d,t);if(!p.endsWith(m))throw new Error(`Invalid checksum in ${u}: expected "${m}"`);return{prefix:y,words:d}}let c=Xl(a);function l(u){let{prefix:h,words:f}=a(u,!1);return{prefix:h,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:i,toWords:s}}q.bech32=ru("bech32");q.bech32m=ru("bech32m");q.utf8={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)};q.hex=Dt(ye(4),Xt("0123456789abcdef"),Kt(""),Zl(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}));var rr={utf8:q.utf8,hex:q.hex,base16:q.base16,base32:q.base32,base64:q.base64,base64url:q.base64url,base58:q.base58,base58xmr:q.base58xmr},su=`Invalid encoding type. Available types: ${Object.keys(rr).join(", ")}`,sy=(e,t)=>{if(typeof e!="string"||!rr.hasOwnProperty(e))throw new TypeError(su);if(!(t instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return rr[e].encode(t)};q.bytesToString=sy;q.str=q.bytesToString;var iy=(e,t)=>{if(!rr.hasOwnProperty(e))throw new TypeError(su);if(typeof t!="string")throw new TypeError("stringToBytes() expects string");return rr[e].decode(t)};q.stringToBytes=iy;q.bytes=q.stringToBytes});var gu=dt((Tv,pu)=>{var{bech32:te,hex:Ft,utf8:oy}=iu(),ou={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},au={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},cu={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},lu={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},uu={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},ps=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],ay={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},cy=BigInt("2100000000000000000"),hu=BigInt(1e11),po={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},fu={};for(let e=0,t=Object.keys(po);e<t.length;e++){let n=t[e],r=po[t[e]].toString();fu[r]=n}var ly={1:e=>Ft.encode(te.fromWordsUnsafe(e)),16:e=>Ft.encode(te.fromWordsUnsafe(e)),13:e=>oy.encode(te.fromWordsUnsafe(e)),19:e=>Ft.encode(te.fromWordsUnsafe(e)),23:e=>Ft.encode(te.fromWordsUnsafe(e)),27:e=>Ft.encode(te.fromWordsUnsafe(e)),6:gs,24:gs,3:hy,5:fy};function uy(e){return t=>({tagCode:parseInt(e),words:te.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function gs(e){return e.reverse().reduce((t,n,r)=>t+n*Math.pow(32,r),0)}function hy(e){let t=[],n,r,s,i,o,a=te.fromWordsUnsafe(e);for(;a.length>0;)n=Ft.encode(a.slice(0,33)),r=Ft.encode(a.slice(33,41)),s=parseInt(Ft.encode(a.slice(41,45)),16),i=parseInt(Ft.encode(a.slice(45,49)),16),o=parseInt(Ft.encode(a.slice(49,51)),16),a=a.slice(51),t.push({pubkey:n,short_channel_id:r,fee_base_msat:s,fee_proportional_millionths:i,cltv_expiry_delta:o});return t}function fy(e){let t=e.slice().reverse().map(s=>[!!(s&1),!!(s&2),!!(s&4),!!(s&8),!!(s&16)]).reduce((s,i)=>s.concat(i),[]);for(;t.length<ps.length*2;)t.push(!1);let n={};ps.forEach((s,i)=>{let o;t[i*2]?o="required":t[i*2+1]?o="supported":o="unsupported",n[s]=o});let r=t.slice(ps.length*2);return n.extra_bits={start_bit:ps.length*2,bits:r,has_required:r.reduce((s,i,o)=>o%2!==0?s||!1:s||i,!1)},n}function du(e,t){let n,r;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),r=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=e}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");let s=BigInt(r),i=n?s*hu/ay[n]:s*hu;if(n==="p"&&s%BigInt(10)!==BigInt(0)||i>cy)throw new Error("Amount is outside of valid range");return t?i.toString():i}function dy(e,t){if(typeof e!="string")throw new Error("Lightning Payment Request must be string");if(e.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");let n=[],r=te.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();let s=r.prefix,i=r.words,o=e.slice(s.length+1),a=i.slice(-104);i=i.slice(0,-104);let c=s.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(c&&!c[2]&&(c=s.match(/^ln(\S+)$/)),!c)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});let l=c[1],u;if(t){if(t.bech32===void 0||t.pubKeyHash===void 0||t.scriptHash===void 0||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");u=t}else switch(l){case ou.bech32:u=ou;break;case au.bech32:u=au;break;case cu.bech32:u=cu;break;case lu.bech32:u=lu;break;case uu.bech32:u=uu;break}if(!u||u.bech32!==l)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:l,value:u});let h=c[2],f;if(h){let T=c[3];f=du(h+T,!0),n.push({name:"amount",letters:c[2]+c[3],value:f})}else f=null;n.push({name:"separator",letters:"1"});let g=gs(i.slice(0,7));i=i.slice(7),n.push({name:"timestamp",letters:o.slice(0,7),value:g}),o=o.slice(7);let y,p,d,m;for(;i.length>0;){let T=i[0].toString();y=fu[T]||"unknown_tag",p=ly[T]||uy(T),i=i.slice(1),d=gs(i.slice(0,2)),i=i.slice(2),m=i.slice(0,d),i=i.slice(d),n.push({name:y,tag:o[0],letters:o.slice(0,1+2+d),value:p(m)}),o=o.slice(1+2+d)}n.push({name:"signature",letters:o.slice(0,104),value:Ft.encode(te.fromWordsUnsafe(a))}),o=o.slice(104),n.push({name:"checksum",letters:o});let v={paymentRequest:e,sections:n,get expiry(){let T=n.find(U=>U.name==="expiry");if(T)return E("timestamp")+T.value},get route_hints(){return n.filter(T=>T.name==="route_hint").map(T=>T.value)}};for(let T in po)T!=="route_hint"&&Object.defineProperty(v,T,{get(){return E(T)}});return v;function E(T){let U=n.find(S=>S.name===T);return U?U.value:void 0}}pu.exports={decode:dy,hrpToMillisat:du}});var oh=dt((Ro,Co)=>{(function(e,t){typeof Ro=="object"&&typeof Co!="undefined"?Co.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis!="undefined"?globalThis:e||self).dayjs=t()})(Ro,function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",s="second",i="minute",o="hour",a="day",c="week",l="month",u="quarter",h="year",f="date",g="Invalid Date",y=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(B){var C=["th","st","nd","rd"],x=B%100;return"["+B+(C[(x-20)%10]||C[x]||C[0])+"]"}},m=function(B,C,x){var b=String(B);return!b||b.length>=C?B:""+Array(C+1-b.length).join(x)+B},v={s:m,z:function(B){var C=-B.utcOffset(),x=Math.abs(C),b=Math.floor(x/60),w=x%60;return(C<=0?"+":"-")+m(b,2,"0")+":"+m(w,2,"0")},m:function B(C,x){if(C.date()<x.date())return-B(x,C);var b=12*(x.year()-C.year())+(x.month()-C.month()),w=C.clone().add(b,l),k=x-w<0,_=C.clone().add(b+(k?-1:1),l);return+(-(b+(x-w)/(k?w-_:_-w))||0)},a:function(B){return B<0?Math.ceil(B)||0:Math.floor(B)},p:function(B){return{M:l,y:h,w:c,d:a,D:f,h:o,m:i,s,ms:r,Q:u}[B]||String(B||"").toLowerCase().replace(/s$/,"")},u:function(B){return B===void 0}},E="en",T={};T[E]=d;var U="$isDayjsObject",S=function(B){return B instanceof N||!(!B||!B[U])},I=function B(C,x,b){var w;if(!C)return E;if(typeof C=="string"){var k=C.toLowerCase();T[k]&&(w=k),x&&(T[k]=x,w=k);var _=C.split("-");if(!w&&_.length>1)return B(_[0])}else{var A=C.name;T[A]=C,w=A}return!b&&w&&(E=w),w||!b&&E},R=function(B,C){if(S(B))return B.clone();var x=typeof C=="object"?C:{};return x.date=B,x.args=arguments,new N(x)},L=v;L.l=I,L.i=S,L.w=function(B,C){return R(B,{locale:C.$L,utc:C.$u,x:C.$x,$offset:C.$offset})};var N=function(){function B(x){this.$L=I(x.locale,null,!0),this.parse(x),this.$x=this.$x||x.x||{},this[U]=!0}var C=B.prototype;return C.parse=function(x){this.$d=function(b){var w=b.date,k=b.utc;if(w===null)return new Date(NaN);if(L.u(w))return new Date;if(w instanceof Date)return new Date(w);if(typeof w=="string"&&!/Z$/i.test(w)){var _=w.match(y);if(_){var A=_[2]-1||0,M=(_[7]||"0").substring(0,3);return k?new Date(Date.UTC(_[1],A,_[3]||1,_[4]||0,_[5]||0,_[6]||0,M)):new Date(_[1],A,_[3]||1,_[4]||0,_[5]||0,_[6]||0,M)}}return new Date(w)}(x),this.init()},C.init=function(){var x=this.$d;this.$y=x.getFullYear(),this.$M=x.getMonth(),this.$D=x.getDate(),this.$W=x.getDay(),this.$H=x.getHours(),this.$m=x.getMinutes(),this.$s=x.getSeconds(),this.$ms=x.getMilliseconds()},C.$utils=function(){return L},C.isValid=function(){return this.$d.toString()!==g},C.isSame=function(x,b){var w=R(x);return this.startOf(b)<=w&&w<=this.endOf(b)},C.isAfter=function(x,b){return R(x)<this.startOf(b)},C.isBefore=function(x,b){return this.endOf(b)<R(x)},C.$g=function(x,b,w){return L.u(x)?this[b]:this.set(w,x)},C.unix=function(){return Math.floor(this.valueOf()/1e3)},C.valueOf=function(){return this.$d.getTime()},C.startOf=function(x,b){var w=this,k=!!L.u(b)||b,_=L.p(x),A=function(Y,j){var W=L.w(w.$u?Date.UTC(w.$y,j,Y):new Date(w.$y,j,Y),w);return k?W:W.endOf(a)},M=function(Y,j){return L.w(w.toDate()[Y].apply(w.toDate("s"),(k?[0,0,0,0]:[23,59,59,999]).slice(j)),w)},O=this.$W,H=this.$M,z=this.$D,F="set"+(this.$u?"UTC":"");switch(_){case h:return k?A(1,0):A(31,11);case l:return k?A(1,H):A(0,H+1);case c:var G=this.$locale().weekStart||0,Z=(O<G?O+7:O)-G;return A(k?z-Z:z+(6-Z),H);case a:case f:return M(F+"Hours",0);case o:return M(F+"Minutes",1);case i:return M(F+"Seconds",2);case s:return M(F+"Milliseconds",3);default:return this.clone()}},C.endOf=function(x){return this.startOf(x,!1)},C.$set=function(x,b){var w,k=L.p(x),_="set"+(this.$u?"UTC":""),A=(w={},w[a]=_+"Date",w[f]=_+"Date",w[l]=_+"Month",w[h]=_+"FullYear",w[o]=_+"Hours",w[i]=_+"Minutes",w[s]=_+"Seconds",w[r]=_+"Milliseconds",w)[k],M=k===a?this.$D+(b-this.$W):b;if(k===l||k===h){var O=this.clone().set(f,1);O.$d[A](M),O.init(),this.$d=O.set(f,Math.min(this.$D,O.daysInMonth())).$d}else A&&this.$d[A](M);return this.init(),this},C.set=function(x,b){return this.clone().$set(x,b)},C.get=function(x){return this[L.p(x)]()},C.add=function(x,b){var w,k=this;x=Number(x);var _=L.p(b),A=function(H){var z=R(k);return L.w(z.date(z.date()+Math.round(H*x)),k)};if(_===l)return this.set(l,this.$M+x);if(_===h)return this.set(h,this.$y+x);if(_===a)return A(1);if(_===c)return A(7);var M=(w={},w[i]=t,w[o]=n,w[s]=e,w)[_]||1,O=this.$d.getTime()+x*M;return L.w(O,this)},C.subtract=function(x,b){return this.add(-1*x,b)},C.format=function(x){var b=this,w=this.$locale();if(!this.isValid())return w.invalidDate||g;var k=x||"YYYY-MM-DDTHH:mm:ssZ",_=L.z(this),A=this.$H,M=this.$m,O=this.$M,H=w.weekdays,z=w.months,F=w.meridiem,G=function(j,W,yt,wt){return j&&(j[W]||j(b,k))||yt[W].slice(0,wt)},Z=function(j){return L.s(A%12||12,j,"0")},Y=F||function(j,W,yt){var wt=j<12?"AM":"PM";return yt?wt.toLowerCase():wt};return k.replace(p,function(j,W){return W||function(yt){switch(yt){case"YY":return String(b.$y).slice(-2);case"YYYY":return L.s(b.$y,4,"0");case"M":return O+1;case"MM":return L.s(O+1,2,"0");case"MMM":return G(w.monthsShort,O,z,3);case"MMMM":return G(z,O);case"D":return b.$D;case"DD":return L.s(b.$D,2,"0");case"d":return String(b.$W);case"dd":return G(w.weekdaysMin,b.$W,H,2);case"ddd":return G(w.weekdaysShort,b.$W,H,3);case"dddd":return H[b.$W];case"H":return String(A);case"HH":return L.s(A,2,"0");case"h":return Z(1);case"hh":return Z(2);case"a":return Y(A,M,!0);case"A":return Y(A,M,!1);case"m":return String(M);case"mm":return L.s(M,2,"0");case"s":return String(b.$s);case"ss":return L.s(b.$s,2,"0");case"SSS":return L.s(b.$ms,3,"0");case"Z":return _}return null}(j)||_.replace(":","")})},C.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},C.diff=function(x,b,w){var k,_=this,A=L.p(b),M=R(x),O=(M.utcOffset()-this.utcOffset())*t,H=this-M,z=function(){return L.m(_,M)};switch(A){case h:k=z()/12;break;case l:k=z();break;case u:k=z()/3;break;case c:k=(H-O)/6048e5;break;case a:k=(H-O)/864e5;break;case o:k=H/n;break;case i:k=H/t;break;case s:k=H/e;break;default:k=H}return w?k:L.a(k)},C.daysInMonth=function(){return this.endOf(l).$D},C.$locale=function(){return T[this.$L]},C.locale=function(x,b){if(!x)return this.$L;var w=this.clone(),k=I(x,b,!0);return k&&(w.$L=k),w},C.clone=function(){return L.w(this.$d,this)},C.toDate=function(){return new Date(this.valueOf())},C.toJSON=function(){return this.isValid()?this.toISOString():null},C.toISOString=function(){return this.$d.toISOString()},C.toString=function(){return this.$d.toUTCString()},B}(),P=N.prototype;return R.prototype=P,[["$ms",r],["$s",s],["$m",i],["$H",o],["$W",a],["$M",l],["$y",h],["$D",f]].forEach(function(B){P[B[1]]=function(C){return this.$g(C,B[0],B[1])}}),R.extend=function(B,C){return B.$i||(B(C,N,R),B.$i=!0),R},R.locale=I,R.isDayjs=S,R.unix=function(B){return R(1e3*B)},R.en=T[E],R.Ls=T,R.p={},R})});var yu=Q(jt(),1),mu=Q(Rt(),1),bu=Q(jt(),1),wu=Q(jt(),1),Tu=Q(Rt(),1);function Qo(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function vs(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Xo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Qo(e.outputLen),Qo(e.blockLen)}function vn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ko(e,t){vs(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var ur=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var ta=e=>e instanceof Uint8Array;var hr=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ot=(e,t)=>e<<32-t|e>>>t,of=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!of)throw new Error("Non little-endian hardware is not supported");function af(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function $n(e){if(typeof e=="string"&&(e=af(e)),!ta(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function ea(...e){let t=new Uint8Array(e.reduce((r,s)=>r+s.length,0)),n=0;return e.forEach(r=>{if(!ta(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}var Hn=class{clone(){return this._cloneInto()}},Eb={}.toString;function na(e){let t=r=>e().update($n(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function fr(e=32){if(ur&&typeof ur.getRandomValues=="function")return ur.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function cf(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}var xs=class extends Hn{constructor(t,n,r,s){super();this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=hr(this.buffer)}update(t){vn(this);let{view:n,buffer:r,blockLen:s}=this;t=$n(t);let i=t.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=hr(t);for(;s<=i-o;o+=s)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){vn(this),Ko(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:s,isLE:i}=this,{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let h=o;h<s;h++)n[h]=0;cf(r,s-8,BigInt(this.length*8),i),this.process(r,0);let a=hr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:s,finished:i,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=i,t.destroyed=o,s%n&&t.buffer.set(r),t}};var lf=(e,t,n)=>e&t^~e&n,uf=(e,t,n)=>e&t^e&n^t&n,hf=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),be=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),we=new Uint32Array(64),ra=class extends xs{constructor(){super(64,32,8,!1);this.A=be[0]|0,this.B=be[1]|0,this.C=be[2]|0,this.D=be[3]|0,this.E=be[4]|0,this.F=be[5]|0,this.G=be[6]|0,this.H=be[7]|0}get(){let{A:t,B:n,C:r,D:s,E:i,F:o,G:a,H:c}=this;return[t,n,r,s,i,o,a,c]}set(t,n,r,s,i,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let h=0;h<16;h++,n+=4)we[h]=t.getUint32(n,!1);for(let h=16;h<64;h++){let f=we[h-15],g=we[h-2],y=Ot(f,7)^Ot(f,18)^f>>>3,p=Ot(g,17)^Ot(g,19)^g>>>10;we[h]=p+we[h-7]+y+we[h-16]|0}let{A:r,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){let f=Ot(a,6)^Ot(a,11)^Ot(a,25),g=u+f+lf(a,c,l)+hf[h]+we[h]|0,p=(Ot(r,2)^Ot(r,13)^Ot(r,22))+uf(r,s,i)|0;u=l,l=c,c=a,a=o+g|0,o=i,i=s,s=r,r=g+p|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,s,i,o,a,c,l,u)}roundClean(){we.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var dr=na(()=>new ra);var As={};Uo(As,{bitGet:()=>bf,bitLen:()=>mf,bitMask:()=>qn,bitSet:()=>wf,bytesToHex:()=>Ve,bytesToNumberBE:()=>pt,bytesToNumberLE:()=>yr,concatBytes:()=>se,createHmacDrbg:()=>Ts,ensureBytes:()=>rt,equalBytes:()=>gf,hexToBytes:()=>De,hexToNumber:()=>Es,numberToBytesBE:()=>$t,numberToBytesLE:()=>mr,numberToHexUnpadded:()=>ia,numberToVarBytesBE:()=>pf,utf8ToBytes:()=>yf,validateObject:()=>ve});var sa=BigInt(0),pr=BigInt(1),ff=BigInt(2),gr=e=>e instanceof Uint8Array,df=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ve(e){if(!gr(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=df[e[n]];return t}function ia(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function Es(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function De(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){let s=r*2,i=e.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function pt(e){return Es(Ve(e))}function yr(e){if(!gr(e))throw new Error("Uint8Array expected");return Es(Ve(Uint8Array.from(e).reverse()))}function $t(e,t){return De(e.toString(16).padStart(t*2,"0"))}function mr(e,t){return $t(e,t).reverse()}function pf(e){return De(ia(e))}function rt(e,t,n){let r;if(typeof t=="string")try{r=De(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else if(gr(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let s=r.length;if(typeof n=="number"&&s!==n)throw new Error(`${e} expected ${n} bytes, got ${s}`);return r}function se(...e){let t=new Uint8Array(e.reduce((r,s)=>r+s.length,0)),n=0;return e.forEach(r=>{if(!gr(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function gf(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function yf(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function mf(e){let t;for(t=0;e>sa;e>>=pr,t+=1);return t}function bf(e,t){return e>>BigInt(t)&pr}var wf=(e,t,n)=>e|(n?pr:sa)<<BigInt(t),qn=e=>(ff<<BigInt(e-1))-pr,ks=e=>new Uint8Array(e),oa=e=>Uint8Array.from(e);function Ts(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=ks(e),s=ks(e),i=0,o=()=>{r.fill(1),s.fill(0),i=0},a=(...h)=>n(s,r,...h),c=(h=ks())=>{s=a(oa([0]),h),r=a(),h.length!==0&&(s=a(oa([1]),h),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,f=[];for(;h<t;){r=a();let g=r.slice();f.push(g),h+=r.length}return se(...f)};return(h,f)=>{o(),c(h);let g;for(;!(g=f(l()));)c();return o(),g}}var vf={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function ve(e,t,n={}){let r=(s,i,o)=>{let a=vf[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);let c=e[s];if(!(o&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(let[s,i]of Object.entries(t))r(s,i,!1);for(let[s,i]of Object.entries(n))r(s,i,!0);return e}var st=BigInt(0),X=BigInt(1),Fe=BigInt(2),xf=BigInt(3),_s=BigInt(4),aa=BigInt(5),ca=BigInt(8),Ef=BigInt(9),kf=BigInt(16);function it(e,t){let n=e%t;return n>=st?n:t+n}function Tf(e,t,n){if(n<=st||t<st)throw new Error("Expected power/modulo > 0");if(n===X)return st;let r=X;for(;t>st;)t&X&&(r=r*e%n),e=e*e%n,t>>=X;return r}function xt(e,t,n){let r=e;for(;t-- >st;)r*=r,r%=n;return r}function br(e,t){if(e===st||t<=st)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=it(e,t),r=t,s=st,i=X,o=X,a=st;for(;n!==st;){let l=r/n,u=r%n,h=s-o*l,f=i-a*l;r=n,n=u,s=o,i=a,o=h,a=f}if(r!==X)throw new Error("invert: does not exist");return it(s,t)}function Af(e){let t=(e-X)/Fe,n,r,s;for(n=e-X,r=0;n%Fe===st;n/=Fe,r++);for(s=Fe;s<e&&Tf(s,t,e)!==e-X;s++);if(r===1){let o=(e+X)/_s;return function(c,l){let u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}let i=(n+X)/Fe;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,u=a.pow(a.mul(a.ONE,s),n),h=a.pow(c,i),f=a.pow(c,n);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let g=1;for(let p=a.sqr(f);g<l&&!a.eql(p,a.ONE);g++)p=a.sqr(p);let y=a.pow(u,X<<BigInt(l-g-1));u=a.sqr(y),h=a.mul(h,y),f=a.mul(f,u),l=g}return h}}function _f(e){if(e%_s===xf){let t=(e+X)/_s;return function(r,s){let i=r.pow(s,t);if(!r.eql(r.sqr(i),s))throw new Error("Cannot find square root");return i}}if(e%ca===aa){let t=(e-aa)/ca;return function(r,s){let i=r.mul(s,Fe),o=r.pow(i,t),a=r.mul(s,o),c=r.mul(r.mul(a,Fe),o),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return e%kf===Ef,Af(e)}var Sf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ss(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Sf.reduce((r,s)=>(r[s]="function",r),t);return ve(e,n)}function Rf(e,t,n){if(n<st)throw new Error("Expected power > 0");if(n===st)return e.ONE;if(n===X)return t;let r=e.ONE,s=t;for(;n>st;)n&X&&(r=e.mul(r,s)),s=e.sqr(s),n>>=X;return r}function Cf(e,t){let n=new Array(t.length),r=t.reduce((i,o,a)=>e.is0(o)?i:(n[a]=i,e.mul(i,o)),e.ONE),s=e.inv(r);return t.reduceRight((i,o,a)=>e.is0(o)?i:(n[a]=e.mul(i,n[a]),e.mul(i,o)),s),n}function Rs(e,t){let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function la(e,t,n=!1,r={}){if(e<=st)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:s,nByteLength:i}=Rs(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=_f(e),a=Object.freeze({ORDER:e,BITS:s,BYTES:i,MASK:qn(s),ZERO:st,ONE:X,create:c=>it(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return st<=c&&c<e},is0:c=>c===st,isOdd:c=>(c&X)===X,neg:c=>it(-c,e),eql:(c,l)=>c===l,sqr:c=>it(c*c,e),add:(c,l)=>it(c+l,e),sub:(c,l)=>it(c-l,e),mul:(c,l)=>it(c*l,e),pow:(c,l)=>Rf(a,c,l),div:(c,l)=>it(c*br(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>br(c,e),sqrt:r.sqrt||(c=>o(a,c)),invertBatch:c=>Cf(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>n?mr(c,i):$t(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return n?yr(c):pt(c)}});return Object.freeze(a)}function ua(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Cs(e){let t=ua(e);return t+Math.ceil(t/2)}function ha(e,t,n=!1){let r=e.length,s=ua(t),i=Cs(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);let o=n?pt(e):yr(e),a=it(o,t-X)+X;return n?mr(a,s):$t(a,s)}var Lf=BigInt(0),Is=BigInt(1);function fa(e,t){let n=(s,i)=>{let o=i.negate();return s?o:i},r=s=>{let i=Math.ceil(t/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:n,unsafeLadder(s,i){let o=e.ZERO,a=s;for(;i>Lf;)i&Is&&(o=o.add(a)),a=a.double(),i>>=Is;return o},precomputeWindow(s,i){let{windows:o,windowSize:a}=r(i),c=[],l=s,u=l;for(let h=0;h<o;h++){u=l,c.push(u);for(let f=1;f<a;f++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(s,i,o){let{windows:a,windowSize:c}=r(s),l=e.ZERO,u=e.BASE,h=BigInt(2**s-1),f=2**s,g=BigInt(s);for(let y=0;y<a;y++){let p=y*c,d=Number(o&h);o>>=g,d>c&&(d-=f,o+=Is);let m=p,v=p+Math.abs(d)-1,E=y%2!==0,T=d<0;d===0?u=u.add(n(E,i[m])):l=l.add(n(T,i[v]))}return{p:l,f:u}},wNAFCached(s,i,o,a){let c=s._WINDOW_SIZE||1,l=i.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&i.set(s,a(l))),this.wNAF(c,l,o)}}}function Ls(e){return Ss(e.Fp),ve(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Rs(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function Bf(e){let t=Ls(e);ve(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:s}=t;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Uf,hexToBytes:Pf}=As,je={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=je;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Uf(r),l:e.subarray(n+2)}},toSig(e){let{Err:t}=je,n=typeof e=="string"?Pf(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");let{d:s,l:i}=je._parseInt(n.subarray(2)),{d:o,l:a}=je._parseInt(i);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(e){let t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let u=l.toString(16);return u.length&1?`0${u}`:u},r=t(n(e.s)),s=t(n(e.r)),i=r.length/2,o=s.length/2,a=n(i),c=n(o);return`30${n(o+i+4)}02${c}${s}02${a}${r}`}},ie=BigInt(0),Ct=BigInt(1),Ob=BigInt(2),da=BigInt(3),$b=BigInt(4);function Mf(e){let t=Bf(e),{Fp:n}=t,r=t.toBytes||((y,p,d)=>{let m=p.toAffine();return se(Uint8Array.from([4]),n.toBytes(m.x),n.toBytes(m.y))}),s=t.fromBytes||(y=>{let p=y.subarray(1),d=n.fromBytes(p.subarray(0,n.BYTES)),m=n.fromBytes(p.subarray(n.BYTES,2*n.BYTES));return{x:d,y:m}});function i(y){let{a:p,b:d}=t,m=n.sqr(y),v=n.mul(m,y);return n.add(n.add(v,n.mul(y,p)),d)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function o(y){return typeof y=="bigint"&&ie<y&&y<t.n}function a(y){if(!o(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){let{allowedPrivateKeyLengths:p,nByteLength:d,wrapPrivateKey:m,n:v}=t;if(p&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=Ve(y)),typeof y!="string"||!p.includes(y.length))throw new Error("Invalid key");y=y.padStart(d*2,"0")}let E;try{E=typeof y=="bigint"?y:pt(rt("private key",y,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof y}`)}return m&&(E=it(E,v)),a(E),E}let l=new Map;function u(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(p,d,m){if(this.px=p,this.py=d,this.pz=m,p==null||!n.isValid(p))throw new Error("x required");if(d==null||!n.isValid(d))throw new Error("y required");if(m==null||!n.isValid(m))throw new Error("z required")}static fromAffine(p){let{x:d,y:m}=p||{};if(!p||!n.isValid(d)||!n.isValid(m))throw new Error("invalid affine point");if(p instanceof h)throw new Error("projective point not allowed");let v=E=>n.eql(E,n.ZERO);return v(d)&&v(m)?h.ZERO:new h(d,m,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){let d=n.invertBatch(p.map(m=>m.pz));return p.map((m,v)=>m.toAffine(d[v])).map(h.fromAffine)}static fromHex(p){let d=h.fromAffine(s(rt("pointHex",p)));return d.assertValidity(),d}static fromPrivateKey(p){return h.BASE.multiply(c(p))}_setWindowSize(p){this._WINDOW_SIZE=p,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:p,y:d}=this.toAffine();if(!n.isValid(p)||!n.isValid(d))throw new Error("bad point: x or y not FE");let m=n.sqr(d),v=i(p);if(!n.eql(m,v))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:p}=this.toAffine();if(n.isOdd)return!n.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){u(p);let{px:d,py:m,pz:v}=this,{px:E,py:T,pz:U}=p,S=n.eql(n.mul(d,U),n.mul(E,v)),I=n.eql(n.mul(m,U),n.mul(T,v));return S&&I}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){let{a:p,b:d}=t,m=n.mul(d,da),{px:v,py:E,pz:T}=this,U=n.ZERO,S=n.ZERO,I=n.ZERO,R=n.mul(v,v),L=n.mul(E,E),N=n.mul(T,T),P=n.mul(v,E);return P=n.add(P,P),I=n.mul(v,T),I=n.add(I,I),U=n.mul(p,I),S=n.mul(m,N),S=n.add(U,S),U=n.sub(L,S),S=n.add(L,S),S=n.mul(U,S),U=n.mul(P,U),I=n.mul(m,I),N=n.mul(p,N),P=n.sub(R,N),P=n.mul(p,P),P=n.add(P,I),I=n.add(R,R),R=n.add(I,R),R=n.add(R,N),R=n.mul(R,P),S=n.add(S,R),N=n.mul(E,T),N=n.add(N,N),R=n.mul(N,P),U=n.sub(U,R),I=n.mul(N,L),I=n.add(I,I),I=n.add(I,I),new h(U,S,I)}add(p){u(p);let{px:d,py:m,pz:v}=this,{px:E,py:T,pz:U}=p,S=n.ZERO,I=n.ZERO,R=n.ZERO,L=t.a,N=n.mul(t.b,da),P=n.mul(d,E),B=n.mul(m,T),C=n.mul(v,U),x=n.add(d,m),b=n.add(E,T);x=n.mul(x,b),b=n.add(P,B),x=n.sub(x,b),b=n.add(d,v);let w=n.add(E,U);return b=n.mul(b,w),w=n.add(P,C),b=n.sub(b,w),w=n.add(m,v),S=n.add(T,U),w=n.mul(w,S),S=n.add(B,C),w=n.sub(w,S),R=n.mul(L,b),S=n.mul(N,C),R=n.add(S,R),S=n.sub(B,R),R=n.add(B,R),I=n.mul(S,R),B=n.add(P,P),B=n.add(B,P),C=n.mul(L,C),b=n.mul(N,b),B=n.add(B,C),C=n.sub(P,C),C=n.mul(L,C),b=n.add(b,C),P=n.mul(B,b),I=n.add(I,P),P=n.mul(w,b),S=n.mul(x,S),S=n.sub(S,P),P=n.mul(x,B),R=n.mul(w,R),R=n.add(R,P),new h(S,I,R)}subtract(p){return this.add(p.negate())}is0(){return this.equals(h.ZERO)}wNAF(p){return g.wNAFCached(this,l,p,d=>{let m=n.invertBatch(d.map(v=>v.pz));return d.map((v,E)=>v.toAffine(m[E])).map(h.fromAffine)})}multiplyUnsafe(p){let d=h.ZERO;if(p===ie)return d;if(a(p),p===Ct)return this;let{endo:m}=t;if(!m)return g.unsafeLadder(this,p);let{k1neg:v,k1:E,k2neg:T,k2:U}=m.splitScalar(p),S=d,I=d,R=this;for(;E>ie||U>ie;)E&Ct&&(S=S.add(R)),U&Ct&&(I=I.add(R)),R=R.double(),E>>=Ct,U>>=Ct;return v&&(S=S.negate()),T&&(I=I.negate()),I=new h(n.mul(I.px,m.beta),I.py,I.pz),S.add(I)}multiply(p){a(p);let d=p,m,v,{endo:E}=t;if(E){let{k1neg:T,k1:U,k2neg:S,k2:I}=E.splitScalar(d),{p:R,f:L}=this.wNAF(U),{p:N,f:P}=this.wNAF(I);R=g.constTimeNegate(T,R),N=g.constTimeNegate(S,N),N=new h(n.mul(N.px,E.beta),N.py,N.pz),m=R.add(N),v=L.add(P)}else{let{p:T,f:U}=this.wNAF(d);m=T,v=U}return h.normalizeZ([m,v])[0]}multiplyAndAddUnsafe(p,d,m){let v=h.BASE,E=(U,S)=>S===ie||S===Ct||!U.equals(v)?U.multiplyUnsafe(S):U.multiply(S),T=E(this,d).add(E(p,m));return T.is0()?void 0:T}toAffine(p){let{px:d,py:m,pz:v}=this,E=this.is0();p==null&&(p=E?n.ONE:n.inv(v));let T=n.mul(d,p),U=n.mul(m,p),S=n.mul(v,p);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(S,n.ONE))throw new Error("invZ was invalid");return{x:T,y:U}}isTorsionFree(){let{h:p,isTorsionFree:d}=t;if(p===Ct)return!0;if(d)return d(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:p,clearCofactor:d}=t;return p===Ct?this:d?d(h,this):this.multiplyUnsafe(t.h)}toRawBytes(p=!0){return this.assertValidity(),r(h,this,p)}toHex(p=!0){return Ve(this.toRawBytes(p))}}h.BASE=new h(t.Gx,t.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);let f=t.nBitLength,g=fa(h,t.endo?Math.ceil(f/2):f);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function Nf(e){let t=Ls(e);return ve(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function pa(e){let t=Nf(e),{Fp:n,n:r}=t,s=n.BYTES+1,i=2*n.BYTES+1;function o(b){return ie<b&&b<n.ORDER}function a(b){return it(b,r)}function c(b){return br(b,r)}let{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:f}=Mf({...t,toBytes(b,w,k){let _=w.toAffine(),A=n.toBytes(_.x),M=se;return k?M(Uint8Array.from([w.hasEvenY()?2:3]),A):M(Uint8Array.from([4]),A,n.toBytes(_.y))},fromBytes(b){let w=b.length,k=b[0],_=b.subarray(1);if(w===s&&(k===2||k===3)){let A=pt(_);if(!o(A))throw new Error("Point is not on curve");let M=h(A),O=n.sqrt(M),H=(O&Ct)===Ct;return(k&1)===1!==H&&(O=n.neg(O)),{x:A,y:O}}else if(w===i&&k===4){let A=n.fromBytes(_.subarray(0,n.BYTES)),M=n.fromBytes(_.subarray(n.BYTES,2*n.BYTES));return{x:A,y:M}}else throw new Error(`Point of length ${w} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),g=b=>Ve($t(b,t.nByteLength));function y(b){let w=r>>Ct;return b>w}function p(b){return y(b)?a(-b):b}let d=(b,w,k)=>pt(b.slice(w,k));class m{constructor(w,k,_){this.r=w,this.s=k,this.recovery=_,this.assertValidity()}static fromCompact(w){let k=t.nByteLength;return w=rt("compactSignature",w,k*2),new m(d(w,0,k),d(w,k,2*k))}static fromDER(w){let{r:k,s:_}=je.toSig(rt("DER",w));return new m(k,_)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(w){return new m(this.r,this.s,w)}recoverPublicKey(w){let{r:k,s:_,recovery:A}=this,M=I(rt("msgHash",w));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");let O=A===2||A===3?k+t.n:k;if(O>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let H=(A&1)===0?"02":"03",z=l.fromHex(H+g(O)),F=c(O),G=a(-M*F),Z=a(_*F),Y=l.BASE.multiplyAndAddUnsafe(z,G,Z);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return De(this.toDERHex())}toDERHex(){return je.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return De(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}let v={isValidPrivateKey(b){try{return u(b),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let b=Cs(t.n);return ha(t.randomBytes(b),t.n)},precompute(b=8,w=l.BASE){return w._setWindowSize(b),w.multiply(BigInt(3)),w}};function E(b,w=!0){return l.fromPrivateKey(b).toRawBytes(w)}function T(b){let w=b instanceof Uint8Array,k=typeof b=="string",_=(w||k)&&b.length;return w?_===s||_===i:k?_===2*s||_===2*i:b instanceof l}function U(b,w,k=!0){if(T(b))throw new Error("first arg must be private key");if(!T(w))throw new Error("second arg must be public key");return l.fromHex(w).multiply(u(b)).toRawBytes(k)}let S=t.bits2int||function(b){let w=pt(b),k=b.length*8-t.nBitLength;return k>0?w>>BigInt(k):w},I=t.bits2int_modN||function(b){return a(S(b))},R=qn(t.nBitLength);function L(b){if(typeof b!="bigint")throw new Error("bigint expected");if(!(ie<=b&&b<R))throw new Error(`bigint expected < 2^${t.nBitLength}`);return $t(b,t.nByteLength)}function N(b,w,k=P){if(["recovered","canonical"].some(W=>W in k))throw new Error("sign() legacy options not supported");let{hash:_,randomBytes:A}=t,{lowS:M,prehash:O,extraEntropy:H}=k;M==null&&(M=!0),b=rt("msgHash",b),O&&(b=rt("prehashed msgHash",_(b)));let z=I(b),F=u(w),G=[L(F),L(z)];if(H!=null){let W=H===!0?A(n.BYTES):H;G.push(rt("extraEntropy",W))}let Z=se(...G),Y=z;function j(W){let yt=S(W);if(!f(yt))return;let wt=c(yt),ut=l.BASE.multiply(yt).toAffine(),St=a(ut.x);if(St===ie)return;let Nt=a(wt*a(Y+St*F));if(Nt===ie)return;let Mn=(ut.x===St?0:2)|Number(ut.y&Ct),Bo=Nt;return M&&y(Nt)&&(Bo=p(Nt),Mn^=1),new m(St,Bo,Mn)}return{seed:Z,k2sig:j}}let P={lowS:t.lowS,prehash:!1},B={lowS:t.lowS,prehash:!1};function C(b,w,k=P){let{seed:_,k2sig:A}=N(b,w,k),M=t;return Ts(M.hash.outputLen,M.nByteLength,M.hmac)(_,A)}l.BASE._setWindowSize(8);function x(b,w,k,_=B){let A=b;if(w=rt("msgHash",w),k=rt("publicKey",k),"strict"in _)throw new Error("options.strict was renamed to lowS");let{lowS:M,prehash:O}=_,H,z;try{if(typeof A=="string"||A instanceof Uint8Array)try{H=m.fromDER(A)}catch(ut){if(!(ut instanceof je.Err))throw ut;H=m.fromCompact(A)}else if(typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint"){let{r:ut,s:St}=A;H=new m(ut,St)}else throw new Error("PARSE");z=l.fromHex(k)}catch(ut){if(ut.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(M&&H.hasHighS())return!1;O&&(w=t.hash(w));let{r:F,s:G}=H,Z=I(w),Y=c(G),j=a(Z*Y),W=a(F*Y),yt=l.BASE.multiplyAndAddUnsafe(z,j,W)?.toAffine();return yt?a(yt.x)===F:!1}return{CURVE:t,getPublicKey:E,getSharedSecret:U,sign:C,verify:x,ProjectivePoint:l,Signature:m,utils:v}}var Bs=class extends Hn{constructor(t,n){super();this.finished=!1,this.destroyed=!1,Xo(t);let r=$n(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?t.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=t.create();for(let o=0;o<i.length;o++)i[o]^=54^92;this.oHash.update(i),i.fill(0)}update(t){return vn(this),this.iHash.update(t),this}digestInto(t){vn(this),vs(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Us=(e,t,n)=>new Bs(e,t).update(n).digest();Us.create=(e,t)=>new Bs(e,t);function Of(e){return{hash:e,hmac:(t,...n)=>Us(e,t,ea(...n)),randomBytes:fr}}function ga(e,t){let n=r=>pa({...e,...Of(r)});return Object.freeze({...n(t),create:n})}var wr=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),vr=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ya=BigInt(1),xr=BigInt(2),ma=(e,t)=>(e+t/xr)/t;function ba(e){let t=wr,n=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=xt(u,n,t)*u%t,f=xt(h,n,t)*u%t,g=xt(f,xr,t)*l%t,y=xt(g,s,t)*g%t,p=xt(y,i,t)*y%t,d=xt(p,a,t)*p%t,m=xt(d,c,t)*d%t,v=xt(m,a,t)*p%t,E=xt(v,n,t)*u%t,T=xt(E,o,t)*y%t,U=xt(T,r,t)*l%t,S=xt(U,xr,t);if(!Ps.eql(Ps.sqr(S),e))throw new Error("Cannot find square root");return S}var Ps=la(wr,void 0,void 0,{sqrt:ba}),xe=ga({a:BigInt(0),b:BigInt(7),Fp:Ps,n:vr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=vr,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-ya*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,o=BigInt("0x100000000000000000000000000000000"),a=ma(i*e,t),c=ma(-r*e,t),l=it(e-a*n-c*s,t),u=it(-a*r-c*i,t),h=l>o,f=u>o;if(h&&(l=t-l),f&&(u=t-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},dr),Er=BigInt(0),wa=e=>typeof e=="bigint"&&Er<e&&e<wr,$f=e=>typeof e=="bigint"&&Er<e&&e<vr,va={};function kr(e,...t){let n=va[e];if(n===void 0){let r=dr(Uint8Array.from(e,s=>s.charCodeAt(0)));n=se(r,r),va[e]=n}return dr(se(n,...t))}var Ms=e=>e.toRawBytes(!0).slice(1),Ns=e=>$t(e,32),Os=e=>it(e,wr),zn=e=>it(e,vr),$s=xe.ProjectivePoint,Hf=(e,t,n)=>$s.BASE.multiplyAndAddUnsafe(e,t,n);function Hs(e){let t=xe.utils.normPrivateKeyToScalar(e),n=$s.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:zn(-t),bytes:Ms(n)}}function xa(e){if(!wa(e))throw new Error("bad x: need 0 < x < p");let t=Os(e*e),n=Os(t*e+BigInt(7)),r=ba(n);r%xr!==Er&&(r=Os(-r));let s=new $s(e,r,ya);return s.assertValidity(),s}function Ea(...e){return zn(pt(kr("BIP0340/challenge",...e)))}function qf(e){return Hs(e).bytes}function zf(e,t,n=fr(32)){let r=rt("message",e),{bytes:s,scalar:i}=Hs(t),o=rt("auxRand",n,32),a=Ns(i^pt(kr("BIP0340/aux",o))),c=kr("BIP0340/nonce",a,s,r),l=zn(pt(c));if(l===Er)throw new Error("sign failed: k is zero");let{bytes:u,scalar:h}=Hs(l),f=Ea(u,s,r),g=new Uint8Array(64);if(g.set(u,0),g.set(Ns(zn(h+f*i)),32),!ka(g,r,s))throw new Error("sign: Invalid signature produced");return g}function ka(e,t,n){let r=rt("signature",e,64),s=rt("message",t),i=rt("publicKey",n,32);try{let o=xa(pt(i)),a=pt(r.subarray(0,32));if(!wa(a))return!1;let c=pt(r.subarray(32,64));if(!$f(c))return!1;let l=Ea(Ns(a),Ms(o),s),u=Hf(o,c,zn(-l));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}var xn=(()=>({getPublicKey:qf,sign:zf,verify:ka,utils:{randomPrivateKey:xe.utils.randomPrivateKey,lift_x:xa,pointToBytes:Ms,numberToBytesBE:$t,bytesToNumberBE:pt,taggedHash:kr,mod:it}}))();var Tr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var qs=e=>e instanceof Uint8Array;var Ar=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ht=(e,t)=>e<<32-t|e>>>t,Vf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Vf)throw new Error("Non little-endian hardware is not supported");var Df=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function nt(e){if(!qs(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Df[e[n]];return t}function We(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){let s=r*2,i=e.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Ff(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Ee(e){if(typeof e=="string"&&(e=Ff(e)),!qs(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function En(...e){let t=new Uint8Array(e.reduce((r,s)=>r+s.length,0)),n=0;return e.forEach(r=>{if(!qs(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}var Vn=class{clone(){return this._cloneInto()}};function zs(e){let t=r=>e().update(Ee(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function _r(e=32){if(Tr&&typeof Tr.getRandomValues=="function")return Tr.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Vs(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function jf(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Ta(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Wf(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Vs(e.outputLen),Vs(e.blockLen)}function Gf(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Zf(e,t){Ta(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Yf={number:Vs,bool:jf,bytes:Ta,hash:Wf,exists:Gf,output:Zf},Et=Yf;function Jf(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}var Ds=class extends Vn{constructor(t,n,r,s){super();this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ar(this.buffer)}update(t){Et.exists(this);let{view:n,buffer:r,blockLen:s}=this;t=Ee(t);let i=t.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=Ar(t);for(;s<=i-o;o+=s)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Et.exists(this),Et.output(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:s,isLE:i}=this,{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let h=o;h<s;h++)n[h]=0;Jf(r,s-8,BigInt(this.length*8),i),this.process(r,0);let a=Ar(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:s,finished:i,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=i,t.destroyed=o,s%n&&t.buffer.set(r),t}};var Qf=(e,t,n)=>e&t^~e&n,Xf=(e,t,n)=>e&t^e&n^t&n,Kf=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ke=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=new Uint32Array(64),Fs=class extends Ds{constructor(){super(64,32,8,!1);this.A=ke[0]|0,this.B=ke[1]|0,this.C=ke[2]|0,this.D=ke[3]|0,this.E=ke[4]|0,this.F=ke[5]|0,this.G=ke[6]|0,this.H=ke[7]|0}get(){let{A:t,B:n,C:r,D:s,E:i,F:o,G:a,H:c}=this;return[t,n,r,s,i,o,a,c]}set(t,n,r,s,i,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let h=0;h<16;h++,n+=4)Te[h]=t.getUint32(n,!1);for(let h=16;h<64;h++){let f=Te[h-15],g=Te[h-2],y=Ht(f,7)^Ht(f,18)^f>>>3,p=Ht(g,17)^Ht(g,19)^g>>>10;Te[h]=p+Te[h-7]+y+Te[h-16]|0}let{A:r,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){let f=Ht(a,6)^Ht(a,11)^Ht(a,25),g=u+f+Qf(a,c,l)+Kf[h]+Te[h]|0,p=(Ht(r,2)^Ht(r,13)^Ht(r,22))+Xf(r,s,i)|0;u=l,l=c,c=a,a=o+g|0,o=i,i=s,s=r,r=g+p|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,s,i,o,a,c,l,u)}roundClean(){Te.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Aa=class extends Fs{constructor(){super();this.A=3238371032|0,this.B=914150663|0,this.C=812702999|0,this.D=4144912697|0,this.E=4290775857|0,this.F=1750603025|0,this.G=1694076839|0,this.H=3204075428|0,this.outputLen=28}},Wt=zs(()=>new Fs),cw=zs(()=>new Aa);function kn(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function oe(...e){let t=(s,i)=>o=>s(i(o)),n=Array.from(e).reverse().reduce((s,i)=>s?t(s,i.encode):i.encode,void 0),r=e.reduce((s,i)=>s?t(s,i.decode):i.decode,void 0);return{encode:n,decode:r}}function ae(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(kn(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);let r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function ce(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Sr(e,t="="){if(kn(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Sa(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Ra(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0,s=[],i=Array.from(e);for(i.forEach(o=>{if(kn(o),o<0||o>=t)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=r;c<i.length;c++){let l=i[c],u=t*o+l;if(!Number.isSafeInteger(u)||t*o/t!==o||u-l!==t*o)throw new Error("convertRadix: carry overflow");if(o=u%n,i[c]=Math.floor(u/n),!Number.isSafeInteger(i[c])||i[c]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)i[c]?a=!1:r=c;else continue}if(s.push(o),a)break}for(let o=0;o<e.length-1&&e[o]===0;o++)s.push(0);return s.reverse()}var Ca=(e,t)=>t?Ca(t,e%t):e,Rr=(e,t)=>e+(t-Ca(e,t));function js(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Rr(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Rr(t,n)}`);let s=0,i=0,o=2**n-1,a=[];for(let c of e){if(kn(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(s=s<<t|c,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)a.push((s>>i-n&o)>>>0);s&=2**i-1}if(s=s<<n-i&o,!r&&i>=t)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&i>0&&a.push(s>>>0),a}function td(e){return kn(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Ra(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Ra(t,e,2**8))}}}function Ae(e,t=!1){if(kn(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Rr(8,e)>32||Rr(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return js(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(js(n,e,8,t))}}}function Ia(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}var ed=oe(Ae(4),ae("0123456789ABCDEF"),ce("")),nd=oe(Ae(5),ae("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Sr(5),ce("")),uw=oe(Ae(5),ae("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Sr(5),ce("")),hw=oe(Ae(5),ae("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ce(""),Sa(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),It=oe(Ae(6),ae("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Sr(6),ce("")),rd=oe(Ae(6),ae("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Sr(6),ce("")),Ws=e=>oe(td(58),ae(e),ce("")),Gs=Ws("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),fw=Ws("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),dw=Ws("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),La=[0,2,3,5,6,7,9,10,11],sd={encode(e){let t="";for(let n=0;n<e.length;n+=8){let r=e.subarray(n,n+8);t+=Gs.encode(r).padStart(La[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){let r=e.slice(n,n+11),s=La.indexOf(r.length),i=Gs.decode(r);for(let o=0;o<i.length-s;o++)if(i[o]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(i.slice(i.length-s)))}return Uint8Array.from(t)}};var Zs=oe(ae("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ce("")),Ba=[996825010,642813549,513874426,1027748829,705979059];function Dn(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<Ba.length;r++)(t>>r&1)===1&&(n^=Ba[r]);return n}function Ua(e,t,n=1){let r=e.length,s=1;for(let i=0;i<r;i++){let o=e.charCodeAt(i);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);s=Dn(s)^o>>5}s=Dn(s);for(let i=0;i<r;i++)s=Dn(s)^e.charCodeAt(i)&31;for(let i of t)s=Dn(s)^i;for(let i=0;i<6;i++)s=Dn(s);return s^=n,Zs.encode(js([s%2**30],30,5,!1))}function Pa(e){let t=e==="bech32"?1:734539939,n=Ae(5),r=n.decode,s=n.encode,i=Ia(r);function o(u,h,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);let g=u.length+7+h.length;if(f!==!1&&g>f)throw new TypeError(`Length ${g} exceeds limit ${f}`);return u=u.toLowerCase(),`${u}1${Zs.encode(h)}${Ua(u,h,t)}`}function a(u,h=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||h!==!1&&u.length>h)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${h})`);let f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=f;let g=u.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');let y=u.slice(0,g),p=u.slice(g+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");let d=Zs.decode(p).slice(0,-6),m=Ua(y,d,t);if(!p.endsWith(m))throw new Error(`Invalid checksum in ${u}: expected "${m}"`);return{prefix:y,words:d}}let c=Ia(a);function l(u){let{prefix:h,words:f}=a(u,!1);return{prefix:h,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:i,toWords:s}}var _e=Pa("bech32"),pw=Pa("bech32m"),id={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},od=oe(Ae(4),ae("0123456789abcdef"),ce(""),Sa(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),ad={utf8:id,hex:od,base16:ed,base32:nd,base64:It,base64url:rd,base58:Gs,base58xmr:sd},gw=`Invalid encoding type. Available types: ${Object.keys(ad).join(", ")}`;function Cr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Ys(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Js(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function V(e,...t){if(!Js(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Se(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Fn(e,t){V(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ir=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);var D=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Re=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),cd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!cd)throw new Error("Non little-endian hardware is not supported");function ld(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Gt(e){if(typeof e=="string")e=ld(e);else if(Js(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function Ma(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Ge(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var Zt=(e,t)=>(Object.assign(t,e),t);function Ze(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}var le=16,Qs=new Uint8Array(16),Yt=D(Qs),ud=225,hd=(e,t,n,r)=>{let s=r&1;return{s3:n<<31|r>>>1,s2:t<<31|n>>>1,s1:e<<31|t>>>1,s0:e>>>1^ud<<24&-(s&1)}},Lt=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function fd(e){e.reverse();let t=e[15]&1,n=0;for(let r=0;r<e.length;r++){let s=e[r];e[r]=s>>>1|n,n=(s&1)<<7}return e[0]^=-t&225,e}var dd=e=>e>64*1024?8:e>1024?4:2,Xs=class{constructor(t,n){this.blockLen=le,this.outputLen=le,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,t=Gt(t),V(t,16);let r=Re(t),s=r.getUint32(0,!1),i=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1),c=[];for(let y=0;y<128;y++)c.push({s0:Lt(s),s1:Lt(i),s2:Lt(o),s3:Lt(a)}),{s0:s,s1:i,s2:o,s3:a}=hd(s,i,o,a);let l=dd(n||1024);if(![1,2,4,8].includes(l))throw new Error(`ghash: wrong window size=${l}, should be 2, 4 or 8`);this.W=l;let h=128/l,f=this.windowSize=2**l,g=[];for(let y=0;y<h;y++)for(let p=0;p<f;p++){let d=0,m=0,v=0,E=0;for(let T=0;T<l;T++){if(!(p>>>l-T-1&1))continue;let{s0:S,s1:I,s2:R,s3:L}=c[l*y+T];d^=S,m^=I,v^=R,E^=L}g.push({s0:d,s1:m,s2:v,s3:E})}this.t=g}_updateBlock(t,n,r,s){t^=this.s0,n^=this.s1,r^=this.s2,s^=this.s3;let{W:i,t:o,windowSize:a}=this,c=0,l=0,u=0,h=0,f=(1<<i)-1,g=0;for(let y of[t,n,r,s])for(let p=0;p<4;p++){let d=y>>>8*p&255;for(let m=8/i-1;m>=0;m--){let v=d>>>i*m&f,{s0:E,s1:T,s2:U,s3:S}=o[g*a+v];c^=E,l^=T,u^=U,h^=S,g+=1}}this.s0=c,this.s1=l,this.s2=u,this.s3=h}update(t){t=Gt(t),Se(this);let n=D(t),r=Math.floor(t.length/le),s=t.length%le;for(let i=0;i<r;i++)this._updateBlock(n[i*4+0],n[i*4+1],n[i*4+2],n[i*4+3]);return s&&(Qs.set(t.subarray(r*le)),this._updateBlock(Yt[0],Yt[1],Yt[2],Yt[3]),Yt.fill(0)),this}destroy(){let{t}=this;for(let n of t)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(t){Se(this),Fn(t,this),this.finished=!0;let{s0:n,s1:r,s2:s,s3:i}=this,o=D(t);return o[0]=n,o[1]=r,o[2]=s,o[3]=i,t}digest(){let t=new Uint8Array(le);return this.digestInto(t),this.destroy(),t}},Na=class extends Xs{constructor(t,n){t=Gt(t);let r=fd(t.slice());super(r,n);r.fill(0)}update(t){t=Gt(t),Se(this);let n=D(t),r=t.length%le,s=Math.floor(t.length/le);for(let i=0;i<s;i++)this._updateBlock(Lt(n[i*4+3]),Lt(n[i*4+2]),Lt(n[i*4+1]),Lt(n[i*4+0]));return r&&(Qs.set(t.subarray(s*le)),this._updateBlock(Lt(Yt[3]),Lt(Yt[2]),Lt(Yt[1]),Lt(Yt[0])),Yt.fill(0)),this}digestInto(t){Se(this),Fn(t,this),this.finished=!0;let{s0:n,s1:r,s2:s,s3:i}=this,o=D(t);return o[0]=n,o[1]=r,o[2]=s,o[3]=i,t.reverse()}};function Oa(e){let t=(r,s)=>e(s,r.length).update(Gt(r)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(r,s)=>e(r,s),t}var Ks=Oa((e,t)=>new Xs(e,t)),$a=Oa((e,t)=>new Na(e,t));var mt=16,ti=4,Lr=new Uint8Array(mt),pd=283;function ei(e){return e<<1^pd&-(e>>7)}function Tn(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=ei(e);return n}var ni=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=ei(r))e[n]=r;let t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),gd=ni.map((e,t)=>ni.indexOf(t)),yd=e=>e<<24|e>>>8,ri=e=>e<<8|e>>>24;function Ha(e,t){if(e.length!==256)throw new Error("Wrong sbox length");let n=new Uint32Array(256).map((l,u)=>t(e[u])),r=n.map(ri),s=r.map(ri),i=s.map(ri),o=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let u=0;u<256;u++){let h=l*256+u;o[h]=n[l]^r[u],a[h]=s[l]^i[u],c[h]=e[l]<<8|e[u]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:s,T3:i,T01:o,T23:a}}var si=Ha(ni,e=>Tn(e,3)<<24|e<<16|e<<8|Tn(e,2)),qa=Ha(gd,e=>Tn(e,11)<<24|Tn(e,13)<<16|Tn(e,9)<<8|Tn(e,14)),md=(()=>{let e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=ei(n))e[t]=n;return e})();function Ce(e){V(e);let t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);let{sbox2:n}=si,r=D(e),s=r.length,i=a=>Jt(n,a,a,a,a),o=new Uint32Array(t+28);o.set(r);for(let a=s;a<o.length;a++){let c=o[a-1];a%s===0?c=i(yd(c))^md[a/s-1]:s>6&&a%s===4&&(c=i(c)),o[a]=o[a-s]^c}return o}function za(e){let t=Ce(e),n=t.slice(),r=t.length,{sbox2:s}=si,{T0:i,T1:o,T2:a,T3:c}=qa;for(let l=0;l<r;l+=4)for(let u=0;u<4;u++)n[l+u]=t[r-l-4+u];t.fill(0);for(let l=4;l<r-4;l++){let u=n[l],h=Jt(s,u,u,u,u);n[l]=i[h&255]^o[h>>>8&255]^a[h>>>16&255]^c[h>>>24]}return n}function Ie(e,t,n,r,s,i){return e[n<<8&65280|r>>>8&255]^t[s>>>8&65280|i>>>24&255]}function Jt(e,t,n,r,s){return e[t&255|n&65280]|e[r>>>16&255|s>>>16&65280]<<16}function Bt(e,t,n,r,s){let{sbox2:i,T01:o,T23:a}=si,c=0;t^=e[c++],n^=e[c++],r^=e[c++],s^=e[c++];let l=e.length/4-2;for(let y=0;y<l;y++){let p=e[c++]^Ie(o,a,t,n,r,s),d=e[c++]^Ie(o,a,n,r,s,t),m=e[c++]^Ie(o,a,r,s,t,n),v=e[c++]^Ie(o,a,s,t,n,r);t=p,n=d,r=m,s=v}let u=e[c++]^Jt(i,t,n,r,s),h=e[c++]^Jt(i,n,r,s,t),f=e[c++]^Jt(i,r,s,t,n),g=e[c++]^Jt(i,s,t,n,r);return{s0:u,s1:h,s2:f,s3:g}}function Va(e,t,n,r,s){let{sbox2:i,T01:o,T23:a}=qa,c=0;t^=e[c++],n^=e[c++],r^=e[c++],s^=e[c++];let l=e.length/4-2;for(let y=0;y<l;y++){let p=e[c++]^Ie(o,a,t,s,r,n),d=e[c++]^Ie(o,a,n,t,s,r),m=e[c++]^Ie(o,a,r,n,t,s),v=e[c++]^Ie(o,a,s,r,n,t);t=p,n=d,r=m,s=v}let u=e[c++]^Jt(i,t,s,r,n),h=e[c++]^Jt(i,n,t,s,r),f=e[c++]^Jt(i,r,n,t,s),g=e[c++]^Jt(i,s,r,n,t);return{s0:u,s1:h,s2:f,s3:g}}function An(e,t){if(!t)return new Uint8Array(e);if(V(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function bd(e,t,n,r){V(t,mt),V(n);let s=n.length;r=An(s,r);let i=t,o=D(i),{s0:a,s1:c,s2:l,s3:u}=Bt(e,o[0],o[1],o[2],o[3]),h=D(n),f=D(r);for(let y=0;y+4<=h.length;y+=4){f[y+0]=h[y+0]^a,f[y+1]=h[y+1]^c,f[y+2]=h[y+2]^l,f[y+3]=h[y+3]^u;let p=1;for(let d=i.length-1;d>=0;d--)p=p+(i[d]&255)|0,i[d]=p&255,p>>>=8;({s0:a,s1:c,s2:l,s3:u}=Bt(e,o[0],o[1],o[2],o[3]))}let g=mt*Math.floor(h.length/ti);if(g<s){let y=new Uint32Array([a,c,l,u]),p=Ir(y);for(let d=g,m=0;d<s;d++,m++)r[d]=n[d]^p[m]}return r}function jn(e,t,n,r,s){V(n,mt),V(r),s=An(r.length,s);let i=n,o=D(i),a=Re(i),c=D(r),l=D(s),u=t?0:12,h=r.length,f=a.getUint32(u,t),{s0:g,s1:y,s2:p,s3:d}=Bt(e,o[0],o[1],o[2],o[3]);for(let v=0;v+4<=c.length;v+=4)l[v+0]=c[v+0]^g,l[v+1]=c[v+1]^y,l[v+2]=c[v+2]^p,l[v+3]=c[v+3]^d,f=f+1>>>0,a.setUint32(u,f,t),{s0:g,s1:y,s2:p,s3:d}=Bt(e,o[0],o[1],o[2],o[3]);let m=mt*Math.floor(c.length/ti);if(m<h){let v=new Uint32Array([g,y,p,d]),E=Ir(v);for(let T=m,U=0;T<h;T++,U++)s[T]=r[T]^E[U]}return s}var _w=Zt({blockSize:16,nonceLength:16},function(t,n){V(t),V(n,mt);function r(s,i){let o=Ce(t),a=n.slice(),c=bd(o,a,s,i);return o.fill(0),a.fill(0),c}return{encrypt:(s,i)=>r(s,i),decrypt:(s,i)=>r(s,i)}});function Da(e){if(V(e),e.length%mt!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${mt}`)}function Fa(e,t,n){let r=e.length,s=r%mt;if(!t&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let i=D(e);if(t){let c=mt-s;c||(c=mt),r=r+c}let o=An(r,n),a=D(o);return{b:i,o:a,out:o}}function ja(e,t){if(!t)return e;let n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");let r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);let s=e.subarray(0,-r);for(let i=0;i<r;i++)if(e[n-i-1]!==r)throw new Error("aes/pcks5: wrong padding");return s}function Wa(e){let t=new Uint8Array(16),n=D(t);t.set(e);let r=mt-e.length;for(let s=mt-r;s<mt;s++)t[s]=r;return n}var Sw=Zt({blockSize:16},function(t,n={}){V(t);let r=!n.disablePadding;return{encrypt:(s,i)=>{V(s);let{b:o,o:a,out:c}=Fa(s,r,i),l=Ce(t),u=0;for(;u+4<=o.length;){let{s0:h,s1:f,s2:g,s3:y}=Bt(l,o[u+0],o[u+1],o[u+2],o[u+3]);a[u++]=h,a[u++]=f,a[u++]=g,a[u++]=y}if(r){let h=Wa(s.subarray(u*4)),{s0:f,s1:g,s2:y,s3:p}=Bt(l,h[0],h[1],h[2],h[3]);a[u++]=f,a[u++]=g,a[u++]=y,a[u++]=p}return l.fill(0),c},decrypt:(s,i)=>{Da(s);let o=za(t),a=An(s.length,i),c=D(s),l=D(a);for(let u=0;u+4<=c.length;){let{s0:h,s1:f,s2:g,s3:y}=Va(o,c[u+0],c[u+1],c[u+2],c[u+3]);l[u++]=h,l[u++]=f,l[u++]=g,l[u++]=y}return o.fill(0),ja(a,r)}}}),ii=Zt({blockSize:16,nonceLength:16},function(t,n,r={}){V(t),V(n,16);let s=!r.disablePadding;return{encrypt:(i,o)=>{let a=Ce(t),{b:c,o:l,out:u}=Fa(i,s,o),h=D(n),f=h[0],g=h[1],y=h[2],p=h[3],d=0;for(;d+4<=c.length;)f^=c[d+0],g^=c[d+1],y^=c[d+2],p^=c[d+3],{s0:f,s1:g,s2:y,s3:p}=Bt(a,f,g,y,p),l[d++]=f,l[d++]=g,l[d++]=y,l[d++]=p;if(s){let m=Wa(i.subarray(d*4));f^=m[0],g^=m[1],y^=m[2],p^=m[3],{s0:f,s1:g,s2:y,s3:p}=Bt(a,f,g,y,p),l[d++]=f,l[d++]=g,l[d++]=y,l[d++]=p}return a.fill(0),u},decrypt:(i,o)=>{Da(i);let a=za(t),c=D(n),l=An(i.length,o),u=D(i),h=D(l),f=c[0],g=c[1],y=c[2],p=c[3];for(let d=0;d+4<=u.length;){let m=f,v=g,E=y,T=p;f=u[d+0],g=u[d+1],y=u[d+2],p=u[d+3];let{s0:U,s1:S,s2:I,s3:R}=Va(a,f,g,y,p);h[d++]=U^m,h[d++]=S^v,h[d++]=I^E,h[d++]=R^T}return a.fill(0),ja(l,s)}}}),Rw=Zt({blockSize:16,nonceLength:16},function(t,n){V(t),V(n,16);function r(s,i,o){let a=Ce(t),c=s.length;o=An(c,o);let l=D(s),u=D(o),h=i?u:l,f=D(n),g=f[0],y=f[1],p=f[2],d=f[3];for(let v=0;v+4<=l.length;){let{s0:E,s1:T,s2:U,s3:S}=Bt(a,g,y,p,d);u[v+0]=l[v+0]^E,u[v+1]=l[v+1]^T,u[v+2]=l[v+2]^U,u[v+3]=l[v+3]^S,g=h[v++],y=h[v++],p=h[v++],d=h[v++]}let m=mt*Math.floor(l.length/ti);if(m<c){({s0:g,s1:y,s2:p,s3:d}=Bt(a,g,y,p,d));let v=Ir(new Uint32Array([g,y,p,d]));for(let E=m,T=0;E<c;E++,T++)o[E]=s[E]^v[T];v.fill(0)}return a.fill(0),o}return{encrypt:(s,i)=>r(s,!0,i),decrypt:(s,i)=>r(s,!1,i)}});function Ga(e,t,n,r,s){let i=e.create(n,r.length+(s?.length||0));s&&i.update(s),i.update(r);let o=new Uint8Array(16),a=Re(o);return s&&Ze(a,0,BigInt(s.length*8),t),Ze(a,8,BigInt(r.length*8),t),i.update(o),i.digest()}var Cw=Zt({blockSize:16,nonceLength:12,tagLength:16},function(t,n,r){if(V(n),n.length===0)throw new Error("aes/gcm: empty nonce");let s=16;function i(a,c,l){let u=Ga(Ks,!1,a,l,r);for(let h=0;h<c.length;h++)u[h]^=c[h];return u}function o(){let a=Ce(t),c=Lr.slice(),l=Lr.slice();if(jn(a,!1,l,l,c),n.length===12)l.set(n);else{let h=Lr.slice(),f=Re(h);Ze(f,8,BigInt(n.length*8),!1),Ks.create(c).update(n).update(h).digestInto(l)}let u=jn(a,!1,l,Lr);return{xk:a,authKey:c,counter:l,tagMask:u}}return{encrypt:a=>{V(a);let{xk:c,authKey:l,counter:u,tagMask:h}=o(),f=new Uint8Array(a.length+s);jn(c,!1,u,a,f);let g=i(l,h,f.subarray(0,f.length-s));return f.set(g,a.length),c.fill(0),f},decrypt:a=>{if(V(a),a.length<s)throw new Error(`aes/gcm: ciphertext less than tagLen (${s})`);let{xk:c,authKey:l,counter:u,tagMask:h}=o(),f=a.subarray(0,-s),g=a.subarray(-s),y=i(l,h,f);if(!Ge(y,g))throw new Error("aes/gcm: invalid ghash tag");let p=jn(c,!1,u,f);return l.fill(0),h.fill(0),c.fill(0),p}}}),Br=(e,t,n)=>r=>{if(!Number.isSafeInteger(r)||t>r||r>n)throw new Error(`${e}: invalid value=${r}, must be [${t}..${n}]`)},Iw=Zt({blockSize:16,nonceLength:12,tagLength:16},function(t,n,r){let s=16,i=Br("AAD",0,2**36),o=Br("plaintext",0,2**36),a=Br("nonce",12,12),c=Br("ciphertext",16,2**36+16);V(n),a(n.length),r&&(V(r),i(r.length));function l(){let f=t.length;if(f!==16&&f!==24&&f!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${f} bytes`);let g=Ce(t),y=new Uint8Array(f),p=new Uint8Array(16),d=D(n),m=0,v=d[0],E=d[1],T=d[2],U=0;for(let S of[p,y].map(D)){let I=D(S);for(let R=0;R<I.length;R+=2){let{s0:L,s1:N}=Bt(g,m,v,E,T);I[R+0]=L,I[R+1]=N,m=++U}}return g.fill(0),{authKey:p,encKey:Ce(y)}}function u(f,g,y){let p=Ga($a,!0,g,y,r);for(let U=0;U<12;U++)p[U]^=n[U];p[15]&=127;let d=D(p),m=d[0],v=d[1],E=d[2],T=d[3];return{s0:m,s1:v,s2:E,s3:T}=Bt(f,m,v,E,T),d[0]=m,d[1]=v,d[2]=E,d[3]=T,p}function h(f,g,y){let p=g.slice();return p[15]|=128,jn(f,!0,p,y)}return{encrypt:f=>{V(f),o(f.length);let{encKey:g,authKey:y}=l(),p=u(g,y,f),d=new Uint8Array(f.length+s);return d.set(p,f.length),d.set(h(g,p,f)),g.fill(0),y.fill(0),d},decrypt:f=>{V(f),c(f.length);let g=f.subarray(-s),{encKey:y,authKey:p}=l(),d=h(y,g,f.subarray(0,-s)),m=u(y,p,d);if(y.fill(0),p.fill(0),!Ge(g,m))throw new Error("invalid polyval tag");return d}}});var gt=(e,t)=>e[t++]&255|(e[t++]&255)<<8,Za=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Gt(t),V(t,32);let n=gt(t,0),r=gt(t,2),s=gt(t,4),i=gt(t,6),o=gt(t,8),a=gt(t,10),c=gt(t,12),l=gt(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=gt(t,16+2*u)}process(t,n,r=!1){let s=r?0:1<<11,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],g=o[6],y=o[7],p=o[8],d=o[9],m=gt(t,n+0),v=gt(t,n+2),E=gt(t,n+4),T=gt(t,n+6),U=gt(t,n+8),S=gt(t,n+10),I=gt(t,n+12),R=gt(t,n+14),L=i[0]+(m&8191),N=i[1]+((m>>>13|v<<3)&8191),P=i[2]+((v>>>10|E<<6)&8191),B=i[3]+((E>>>7|T<<9)&8191),C=i[4]+((T>>>4|U<<12)&8191),x=i[5]+(U>>>1&8191),b=i[6]+((U>>>14|S<<2)&8191),w=i[7]+((S>>>11|I<<5)&8191),k=i[8]+((I>>>8|R<<8)&8191),_=i[9]+(R>>>5|s),A=0,M=A+L*a+N*(5*d)+P*(5*p)+B*(5*y)+C*(5*g);A=M>>>13,M&=8191,M+=x*(5*f)+b*(5*h)+w*(5*u)+k*(5*l)+_*(5*c),A+=M>>>13,M&=8191;let O=A+L*c+N*a+P*(5*d)+B*(5*p)+C*(5*y);A=O>>>13,O&=8191,O+=x*(5*g)+b*(5*f)+w*(5*h)+k*(5*u)+_*(5*l),A+=O>>>13,O&=8191;let H=A+L*l+N*c+P*a+B*(5*d)+C*(5*p);A=H>>>13,H&=8191,H+=x*(5*y)+b*(5*g)+w*(5*f)+k*(5*h)+_*(5*u),A+=H>>>13,H&=8191;let z=A+L*u+N*l+P*c+B*a+C*(5*d);A=z>>>13,z&=8191,z+=x*(5*p)+b*(5*y)+w*(5*g)+k*(5*f)+_*(5*h),A+=z>>>13,z&=8191;let F=A+L*h+N*u+P*l+B*c+C*a;A=F>>>13,F&=8191,F+=x*(5*d)+b*(5*p)+w*(5*y)+k*(5*g)+_*(5*f),A+=F>>>13,F&=8191;let G=A+L*f+N*h+P*u+B*l+C*c;A=G>>>13,G&=8191,G+=x*a+b*(5*d)+w*(5*p)+k*(5*y)+_*(5*g),A+=G>>>13,G&=8191;let Z=A+L*g+N*f+P*h+B*u+C*l;A=Z>>>13,Z&=8191,Z+=x*c+b*a+w*(5*d)+k*(5*p)+_*(5*y),A+=Z>>>13,Z&=8191;let Y=A+L*y+N*g+P*f+B*h+C*u;A=Y>>>13,Y&=8191,Y+=x*l+b*c+w*a+k*(5*d)+_*(5*p),A+=Y>>>13,Y&=8191;let j=A+L*p+N*y+P*g+B*f+C*h;A=j>>>13,j&=8191,j+=x*u+b*l+w*c+k*a+_*(5*d),A+=j>>>13,j&=8191;let W=A+L*d+N*p+P*y+B*g+C*f;A=W>>>13,W&=8191,W+=x*h+b*u+w*l+k*c+_*a,A+=W>>>13,W&=8191,A=(A<<2)+A|0,A=A+M|0,M=A&8191,A=A>>>13,O+=A,i[0]=M,i[1]=O,i[2]=H,i[3]=z,i[4]=F,i[5]=G,i[6]=Z,i[7]=Y,i[8]=j,i[9]=W}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),s=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=s,s=t[a]>>>13,t[a]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,r[0]=t[0]+5,s=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=t[a]+s,s=r[a]>>>13,r[a]&=8191;r[9]-=1<<13;let i=(s^1)-1;for(let a=0;a<10;a++)r[a]&=i;i=~i;for(let a=0;a<10;a++)t[a]=t[a]&i|r[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let o=t[0]+n[0];t[0]=o&65535;for(let a=1;a<8;a++)o=(t[a]+n[a]|0)+(o>>>16)|0,t[a]=o&65535}update(t){Se(this);let{buffer:n,blockLen:r}=this;t=Gt(t);let s=t.length;for(let i=0;i<s;){let o=Math.min(r-this.pos,s-i);if(o===r){for(;r<=s-i;i+=r)this.process(t,i);continue}n.set(t.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){Se(this),Fn(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:s}=this;if(s){for(n[s++]=1;s<16;s++)n[s]=0;this.process(n,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)t[i++]=r[o]>>>0,t[i++]=r[o]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function wd(e){let t=(r,s)=>e(s).update(Gt(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var Ya=wd(e=>new Za(e));var Ja=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),vd=Ja("expand 16-byte k"),xd=Ja("expand 32-byte k"),Ed=D(vd),Qa=D(xd),Ow=Qa.slice();function $(e,t){return e<<t|e>>>32-t}function oi(e){return e.byteOffset%4===0}var Ur=64,kd=16,Xa=2**32-1,Ka=new Uint32Array;function Td(e,t,n,r,s,i,o,a){let c=s.length,l=new Uint8Array(Ur),u=D(l),h=oi(s)&&oi(i),f=h?D(s):Ka,g=h?D(i):Ka;for(let y=0;y<c;o++){if(e(t,n,r,u,o,a),o>=Xa)throw new Error("arx: counter overflow");let p=Math.min(Ur,c-y);if(h&&p===Ur){let d=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let m=0,v;m<kd;m++)v=d+m,g[v]=f[v]^u[m];y+=Ur;continue}for(let d=0,m;d<p;d++)m=y+d,i[m]=s[m]^l[d];y+=p}}function ai(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:s,counterRight:i,rounds:o}=Ma({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Cr(s),Cr(o),Ys(i),Ys(n),(a,c,l,u,h=0)=>{V(a),V(c),V(l);let f=l.length;if(u||(u=new Uint8Array(f)),V(u),Cr(h),h<0||h>=Xa)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);let g=[],y=a.length,p,d;if(y===32)p=a.slice(),g.push(p),d=Qa;else if(y===16&&n)p=new Uint8Array(32),p.set(a),p.set(a,16),d=Ed,g.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);oi(c)||(c=c.slice(),g.push(c));let m=D(p);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,m,D(c.subarray(0,16)),m),c=c.subarray(16)}let v=16-s;if(v!==c.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){let T=new Uint8Array(12);T.set(c,i?0:12-c.length),c=T,g.push(c)}let E=D(c);for(Td(e,d,m,E,l,u,h,o);g.length>0;)g.pop().fill(0);return u}}function tc(e,t,n,r,s,i=20){let o=e[0],a=e[1],c=e[2],l=e[3],u=t[0],h=t[1],f=t[2],g=t[3],y=t[4],p=t[5],d=t[6],m=t[7],v=s,E=n[0],T=n[1],U=n[2],S=o,I=a,R=c,L=l,N=u,P=h,B=f,C=g,x=y,b=p,w=d,k=m,_=v,A=E,M=T,O=U;for(let z=0;z<i;z+=2)S=S+N|0,_=$(_^S,16),x=x+_|0,N=$(N^x,12),S=S+N|0,_=$(_^S,8),x=x+_|0,N=$(N^x,7),I=I+P|0,A=$(A^I,16),b=b+A|0,P=$(P^b,12),I=I+P|0,A=$(A^I,8),b=b+A|0,P=$(P^b,7),R=R+B|0,M=$(M^R,16),w=w+M|0,B=$(B^w,12),R=R+B|0,M=$(M^R,8),w=w+M|0,B=$(B^w,7),L=L+C|0,O=$(O^L,16),k=k+O|0,C=$(C^k,12),L=L+C|0,O=$(O^L,8),k=k+O|0,C=$(C^k,7),S=S+P|0,O=$(O^S,16),w=w+O|0,P=$(P^w,12),S=S+P|0,O=$(O^S,8),w=w+O|0,P=$(P^w,7),I=I+B|0,_=$(_^I,16),k=k+_|0,B=$(B^k,12),I=I+B|0,_=$(_^I,8),k=k+_|0,B=$(B^k,7),R=R+C|0,A=$(A^R,16),x=x+A|0,C=$(C^x,12),R=R+C|0,A=$(A^R,8),x=x+A|0,C=$(C^x,7),L=L+N|0,M=$(M^L,16),b=b+M|0,N=$(N^b,12),L=L+N|0,M=$(M^L,8),b=b+M|0,N=$(N^b,7);let H=0;r[H++]=o+S|0,r[H++]=a+I|0,r[H++]=c+R|0,r[H++]=l+L|0,r[H++]=u+N|0,r[H++]=h+P|0,r[H++]=f+B|0,r[H++]=g+C|0,r[H++]=y+x|0,r[H++]=p+b|0,r[H++]=d+w|0,r[H++]=m+k|0,r[H++]=v+_|0,r[H++]=E+A|0,r[H++]=T+M|0,r[H++]=U+O|0}function Ad(e,t,n,r){let s=e[0],i=e[1],o=e[2],a=e[3],c=t[0],l=t[1],u=t[2],h=t[3],f=t[4],g=t[5],y=t[6],p=t[7],d=n[0],m=n[1],v=n[2],E=n[3];for(let U=0;U<20;U+=2)s=s+c|0,d=$(d^s,16),f=f+d|0,c=$(c^f,12),s=s+c|0,d=$(d^s,8),f=f+d|0,c=$(c^f,7),i=i+l|0,m=$(m^i,16),g=g+m|0,l=$(l^g,12),i=i+l|0,m=$(m^i,8),g=g+m|0,l=$(l^g,7),o=o+u|0,v=$(v^o,16),y=y+v|0,u=$(u^y,12),o=o+u|0,v=$(v^o,8),y=y+v|0,u=$(u^y,7),a=a+h|0,E=$(E^a,16),p=p+E|0,h=$(h^p,12),a=a+h|0,E=$(E^a,8),p=p+E|0,h=$(h^p,7),s=s+l|0,E=$(E^s,16),y=y+E|0,l=$(l^y,12),s=s+l|0,E=$(E^s,8),y=y+E|0,l=$(l^y,7),i=i+u|0,d=$(d^i,16),p=p+d|0,u=$(u^p,12),i=i+u|0,d=$(d^i,8),p=p+d|0,u=$(u^p,7),o=o+h|0,m=$(m^o,16),f=f+m|0,h=$(h^f,12),o=o+h|0,m=$(m^o,8),f=f+m|0,h=$(h^f,7),a=a+c|0,v=$(v^a,16),g=g+v|0,c=$(c^g,12),a=a+c|0,v=$(v^a,8),g=g+v|0,c=$(c^g,7);let T=0;r[T++]=s,r[T++]=i,r[T++]=o,r[T++]=a,r[T++]=d,r[T++]=m,r[T++]=v,r[T++]=E}var Pr=ai(tc,{counterRight:!1,counterLength:4,allowShortKeys:!1}),_d=ai(tc,{counterRight:!1,counterLength:8,extendNonceFn:Ad,allowShortKeys:!1});var Sd=new Uint8Array(16),ec=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(Sd.subarray(n))},Rd=new Uint8Array(32);function nc(e,t,n,r,s){let i=e(t,n,Rd),o=Ya.create(i);s&&ec(o,s),ec(o,r);let a=new Uint8Array(16),c=Re(a);Ze(c,0,BigInt(s?s.length:0),!0),Ze(c,8,BigInt(r.length),!0),o.update(a);let l=o.digest();return i.fill(0),l}var rc=e=>(t,n,r)=>{let s=16;return V(t,32),V(n),{encrypt:(i,o)=>{let a=i.length,c=a+s;o?V(o,c):o=new Uint8Array(c),e(t,n,i,o,1);let l=nc(e,t,n,o.subarray(0,-s),r);return o.set(l,a),o},decrypt:(i,o)=>{let a=i.length,c=a-s;if(a<s)throw new Error(`encrypted data must be at least ${s} bytes`);o?V(o,c):o=new Uint8Array(c);let l=i.subarray(0,-s),u=i.subarray(-s),h=nc(e,t,n,l,r);if(!Ge(u,h))throw new Error("invalid tag");return e(t,n,l,o,1),o}}},Dw=Zt({blockSize:64,nonceLength:12,tagLength:16},rc(Pr)),Fw=Zt({blockSize:64,nonceLength:24,tagLength:16},rc(_d));var ci=class extends Vn{constructor(t,n){super();this.finished=!1,this.destroyed=!1,Et.hash(t);let r=Ee(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?t.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=t.create();for(let o=0;o<i.length;o++)i[o]^=54^92;this.oHash.update(i),i.fill(0)}update(t){return Et.exists(this),this.iHash.update(t),this}digestInto(t){Et.exists(this),Et.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},_n=(e,t,n)=>new ci(e,t).update(n).digest();_n.create=(e,t)=>new ci(e,t);function sc(e,t,n){return Et.hash(e),n===void 0&&(n=new Uint8Array(e.outputLen)),_n(e,Ee(n),Ee(t))}var li=new Uint8Array([0]),ic=new Uint8Array;function oc(e,t,n,r=32){if(Et.hash(e),Et.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(r/e.outputLen);n===void 0&&(n=ic);let i=new Uint8Array(s*e.outputLen),o=_n.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<s;l++)li[0]=l+1,a.update(l===0?ic:c).update(n).update(li).digestInto(c),i.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),li.fill(0),i.slice(0,r)}var Cd=Object.defineProperty,K=(e,t)=>{for(var n in t)Cd(e,n,{get:t[n],enumerable:!0})},Sn=Symbol("verified"),Id=e=>e instanceof Object;function ui(e){if(!Id(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var Ld={};K(Ld,{Queue:()=>lc,QueueNode:()=>cc,binarySearch:()=>hi,insertEventIntoAscendingList:()=>Ud,insertEventIntoDescendingList:()=>Bd,normalizeURL:()=>ac,utf8Decoder:()=>ue,utf8Encoder:()=>qt});var ue=new TextDecoder("utf-8"),qt=new TextEncoder;function ac(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function Bd(e,t){let[n,r]=hi(e,s=>t.id===s.id?0:t.created_at===s.created_at?-1:s.created_at-t.created_at);return r||e.splice(n,0,t),e}function Ud(e,t){let[n,r]=hi(e,s=>t.id===s.id?0:t.created_at===s.created_at?-1:t.created_at-s.created_at);return r||e.splice(n,0,t),e}function hi(e,t){let n=0,r=e.length-1;for(;n<=r;){let s=Math.floor((n+r)/2),i=t(e[s]);if(i===0)return[s,!0];i<0?r=s-1:n=s+1}return[n,!1]}var cc=class{value;next=null;prev=null;constructor(e){this.value=e}},lc=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new cc(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let t=this.first;return this.first=null,this.last=null,t.value}let e=this.first;return this.first=e.next,e.value}},Pd=class{generateSecretKey(){return xn.utils.randomPrivateKey()}getPublicKey(e){return nt(xn.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=nt(xn.getPublicKey(t)),n.id=Mr(n),n.sig=nt(xn.sign(Mr(n),t)),n[Sn]=!0,n}verifyEvent(e){if(typeof e[Sn]=="boolean")return e[Sn];let t=Mr(e);if(t!==e.id)return e[Sn]=!1,!1;try{let n=xn.verify(e.sig,t,e.pubkey);return e[Sn]=n,n}catch{return e[Sn]=!1,!1}}};function Md(e){if(!ui(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Mr(e){let t=Wt(qt.encode(Md(e)));return nt(t)}var Nr=new Pd,fi=Nr.generateSecretKey,Or=Nr.getPublicKey,Ut=Nr.finalizeEvent,di=Nr.verifyEvent,Nd={};K(Nd,{Application:()=>$p,BadgeAward:()=>jd,BadgeDefinition:()=>Lp,BlockedRelaysList:()=>gp,BookmarkList:()=>fp,Bookmarksets:()=>Rp,Calendar:()=>jp,CalendarEventRSVP:()=>Wp,ChannelCreation:()=>gc,ChannelHideMessage:()=>bc,ChannelMessage:()=>mc,ChannelMetadata:()=>yc,ChannelMuteUser:()=>wc,ClassifiedListing:()=>zp,ClientAuth:()=>xc,CommunitiesList:()=>dp,CommunityDefinition:()=>Yp,CommunityPostApproval:()=>ep,Contacts:()=>Vd,CreateOrUpdateProduct:()=>Pp,CreateOrUpdateStall:()=>Up,Curationsets:()=>Cp,Date:()=>Dp,DirectMessageRelaysList:()=>wp,DraftClassifiedListing:()=>Vp,DraftLong:()=>Np,Emojisets:()=>Op,EncryptedDirectMessage:()=>Dd,EventDeletion:()=>Fd,FileMetadata:()=>Yd,FileServerPreference:()=>vp,Followsets:()=>Ap,GenericRepost:()=>Gd,Genericlists:()=>_p,GiftWrap:()=>vc,HTTPAuth:()=>yi,Handlerinformation:()=>Zp,Handlerrecommendation:()=>Gp,Highlights:()=>cp,InterestsList:()=>mp,Interestsets:()=>Bp,JobFeedback:()=>sp,JobRequest:()=>np,JobResult:()=>rp,Label:()=>tp,LightningPubRPC:()=>Ep,LiveChatMessage:()=>Jd,LiveEvent:()=>Hp,LongFormArticle:()=>Mp,Metadata:()=>Hd,Mutelist:()=>lp,NWCWalletInfo:()=>xp,NWCWalletRequest:()=>Ec,NWCWalletResponse:()=>kp,NostrConnect:()=>Tp,OpenTimestamps:()=>Zd,Pinlist:()=>up,PrivateDirectMessage:()=>Wd,ProblemTracker:()=>Qd,ProfileBadges:()=>Ip,PublicChatsList:()=>pp,Reaction:()=>gi,RecommendRelay:()=>zd,RelayList:()=>hp,Relaysets:()=>Sp,Report:()=>Xd,Reporting:()=>Kd,Repost:()=>pi,Seal:()=>pc,SearchRelaysList:()=>yp,ShortTextNote:()=>qd,Time:()=>Fp,UserEmojiList:()=>bp,UserStatuses:()=>qp,Zap:()=>ap,ZapGoal:()=>ip,ZapRequest:()=>op,classifyKind:()=>Od,isEphemeralKind:()=>fc,isKind:()=>$d,isParameterizedReplaceableKind:()=>dc,isRegularKind:()=>uc,isReplaceableKind:()=>hc});function uc(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function hc(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function fc(e){return 2e4<=e&&e<3e4}function dc(e){return 3e4<=e&&e<4e4}function Od(e){return uc(e)?"regular":hc(e)?"replaceable":fc(e)?"ephemeral":dc(e)?"parameterized":"unknown"}function $d(e,t){let n=t instanceof Array?t:[t];return ui(e)&&n.includes(e.kind)||!1}var Hd=0,qd=1,zd=2,Vd=3,Dd=4,Fd=5,pi=6,gi=7,jd=8,pc=13,Wd=14,Gd=16,gc=40,yc=41,mc=42,bc=43,wc=44,Zd=1040,vc=1059,Yd=1063,Jd=1311,Qd=1971,Xd=1984,Kd=1984,tp=1985,ep=4550,np=5999,rp=6999,sp=7e3,ip=9041,op=9734,ap=9735,cp=9802,lp=1e4,up=10001,hp=10002,fp=10003,dp=10004,pp=10005,gp=10006,yp=10007,mp=10015,bp=10030,wp=10050,vp=10096,xp=13194,Ep=21e3,xc=22242,Ec=23194,kp=23195,Tp=24133,yi=27235,Ap=3e4,_p=30001,Sp=30002,Rp=30003,Cp=30004,Ip=30008,Lp=30009,Bp=30015,Up=30017,Pp=30018,Mp=30023,Np=30024,Op=30030,$p=30078,Hp=30311,qp=30315,zp=30402,Vp=30403,Dp=31922,Fp=31923,jp=31924,Wp=31925,Gp=31989,Zp=31990,Yp=34550;function Jp(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),s=e[`#${r}`];if(s&&!t.tags.find(([i,o])=>i===n.slice(1)&&s.indexOf(o)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function mi(e,t){for(let n=0;n<e.length;n++)if(Jp(e[n],t))return!0;return!1}var Qp={};K(Qp,{getHex64:()=>$r,getInt:()=>kc,getSubscriptionId:()=>Tc,matchEventId:()=>Xp,matchEventKind:()=>tg,matchEventPubkey:()=>Kp});function $r(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,s=e.slice(r).indexOf('"')+r+1;return e.slice(s,s+64)}function kc(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,s=e.slice(r),i=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,i),10)}function Tc(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,s=e.slice(r+1,80).indexOf('"');if(s===-1)return null;let i=r+1+s;return e.slice(r+1,i)}function Xp(e,t){return t===$r(e,"id")}function Kp(e,t){return t===$r(e,"pubkey")}function tg(e,t){return t===kc(e,"kind")}var eg={};K(eg,{makeAuthEvent:()=>Ac});function Ac(e,t){return{kind:xc,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function ng(){return new Promise(e=>{let t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var rg=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new lc;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=ac(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){let n=new rg(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=n=>{t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await ng();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=Tc(e);if(t){let n=this.openSubs.get(t);if(!n)return;let r=$r(e,"id"),s=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),s)return}try{let n=JSON.parse(e);switch(n[0]){case"EVENT":{let r=this.openSubs.get(n[1]),s=n[2];this.verifyEvent(s)&&mi(r.filters,s)&&r.onevent(s);return}case"COUNT":{let r=n[1],s=n[2],i=this.openCountRequests.get(r);i&&(i.resolve(s.count),this.openCountRequests.delete(r));return}case"EOSE":{let r=this.openSubs.get(n[1]);if(!r)return;r.receivedEose();return}case"OK":{let r=n[1],s=n[2],i=n[3],o=this.openEventPublishes.get(r);o&&(s?o.resolve(i):o.reject(new Error(i)),this.openEventPublishes.delete(r));return}case"CLOSED":{let r=n[1],s=this.openSubs.get(r);if(!s)return;s.closed=!0,s.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1],this._onauth?.(n[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");let t=await e(Ac(this.url,this.challenge)),n=new Promise((r,s)=>{this.openEventPublishes.set(t.id,{resolve:r,reject:s})});return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){let t=new Promise((n,r)=>{this.openEventPublishes.set(e.id,{resolve:n,reject:r})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),setTimeout(()=>{let n=this.openEventPublishes.get(e.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout),t}async count(e,t){this.serial++;let n=t?.id||"count:"+this.serial,r=new Promise((s,i)=>{this.openCountRequests.set(n,{resolve:s,reject:i})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){let n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;let n=t.id||"sub:"+this.serial,r=new sg(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},sg=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(s=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,s)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(e)}},ig;try{ig=WebSocket}catch{}var og;try{og=WebSocket}catch{}var ot={};K(ot,{BECH32_REGEX:()=>_c,Bech32MaxSize:()=>bi,NostrTypeGuard:()=>ag,decode:()=>Hr,encodeBytes:()=>zr,naddrEncode:()=>pg,neventEncode:()=>dg,noteEncode:()=>hg,nprofileEncode:()=>fg,npubEncode:()=>ug,nsecEncode:()=>lg});var ag={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},bi=5e3,_c=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function cg(e){let t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Hr(e){let{prefix:t,words:n}=_e.decode(e,bi),r=new Uint8Array(_e.fromWords(n));switch(t){case"nprofile":{let s=wi(r);if(!s[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:nt(s[0][0]),relays:s[1]?s[1].map(i=>ue.decode(i)):[]}}}case"nevent":{let s=wi(r);if(!s[0]?.[0])throw new Error("missing TLV 0 for nevent");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(s[2]&&s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(s[3]&&s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:nt(s[0][0]),relays:s[1]?s[1].map(i=>ue.decode(i)):[],author:s[2]?.[0]?nt(s[2][0]):void 0,kind:s[3]?.[0]?parseInt(nt(s[3][0]),16):void 0}}}case"naddr":{let s=wi(r);if(!s[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!s[2]?.[0])throw new Error("missing TLV 2 for naddr");if(s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!s[3]?.[0])throw new Error("missing TLV 3 for naddr");if(s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ue.decode(s[0][0]),pubkey:nt(s[2][0]),kind:parseInt(nt(s[3][0]),16),relays:s[1]?s[1].map(i=>ue.decode(i)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:nt(r)};default:throw new Error(`unknown prefix ${t}`)}}function wi(e){let t={},n=e;for(;n.length>0;){let r=n[0],s=n[1],i=n.slice(2,2+s);if(n=n.slice(2+s),i.length<s)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(i)}return t}function lg(e){return zr("nsec",e)}function ug(e){return zr("npub",We(e))}function hg(e){return zr("note",We(e))}function qr(e,t){let n=_e.toWords(t);return _e.encode(e,n,bi)}function zr(e,t){return qr(e,t)}function fg(e){let t=vi({0:[We(e.pubkey)],1:(e.relays||[]).map(n=>qt.encode(n))});return qr("nprofile",t)}function dg(e){let t;e.kind!==void 0&&(t=cg(e.kind));let n=vi({0:[We(e.id)],1:(e.relays||[]).map(r=>qt.encode(r)),2:e.author?[We(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return qr("nevent",n)}function pg(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=vi({0:[qt.encode(e.identifier)],1:(e.relays||[]).map(r=>qt.encode(r)),2:[We(e.pubkey)],3:[new Uint8Array(t)]});return qr("naddr",n)}function vi(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(s=>{let i=new Uint8Array(s.length+2);i.set([parseInt(n)],0),i.set([s.length],1),i.set(s,2),t.push(i)})}),En(...t)}var Vr={};K(Vr,{decrypt:()=>gg,encrypt:()=>Sc});async function Sc(e,t,n){let r=e instanceof Uint8Array?nt(e):e,s=xe.getSharedSecret(r,"02"+t),i=Rc(s),o=Uint8Array.from(_r(16)),a=qt.encode(n),c=ii(i,o).encrypt(a),l=It.encode(new Uint8Array(c)),u=It.encode(new Uint8Array(o.buffer));return`${l}?iv=${u}`}async function gg(e,t,n){let r=e instanceof Uint8Array?nt(e):e,[s,i]=n.split("?iv="),o=xe.getSharedSecret(r,"02"+t),a=Rc(o),c=It.decode(i),l=It.decode(s),u=ii(a,c).decrypt(l);return ue.decode(u)}function Rc(e){return e.slice(1,33)}var yg={};K(yg,{NIP05_REGEX:()=>xi,isNip05:()=>mg,isValid:()=>vg,queryProfile:()=>Cc,searchDomain:()=>wg,useFetchImplementation:()=>bg});var xi=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,mg=e=>xi.test(e||""),Dr;try{Dr=fetch}catch{}function bg(e){Dr=e}async function wg(e,t=""){try{let n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await Dr(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Cc(e){let t=e.match(xi);if(!t)return null;let[,n="_",r]=t;try{let s=`https://${r}/.well-known/nostr.json?name=${n}`,i=await Dr(s,{redirect:"manual"});if(i.status!==200)throw Error("Wrong response code");let o=await i.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function vg(e,t){let n=await Cc(t);return n?n.pubkey===e:!1}var xg={};K(xg,{parse:()=>Eg});function Eg(e){let t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]},n,r;for(let s=e.tags.length-1;s>=0;s--){let i=e.tags[s];if(i[0]==="e"&&i[1]){let[o,a,c,l,u]=i,h={id:a,relays:c?[c]:[],author:u};if(l==="root"){t.root=h;continue}if(l==="reply"){t.reply=h;continue}if(l==="mention"){t.mentions.push(h);continue}n?r=h:n=h,t.mentions.push(h);continue}if(i[0]==="q"&&i[1]){let[o,a,c]=i;t.quotes.push({id:a,relays:c?[c]:[]})}if(i[0]==="p"&&i[1]){t.profiles.push({pubkey:i[1],relays:i[2]?[i[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(s=>{if(!s)return;let i=t.mentions.indexOf(s);if(i!==-1&&t.mentions.splice(i,1),s.author){let o=t.profiles.find(a=>a.pubkey===s.author);o&&o.relays&&(s.relays||(s.relays=[]),o.relays.forEach(a=>{s.relays?.indexOf(a)===-1&&s.relays.push(a)}),o.relays=s.relays)}}),t.mentions.forEach(s=>{if(s.author){let i=t.profiles.find(o=>o.pubkey===s.author);i&&i.relays&&(s.relays||(s.relays=[]),i.relays.forEach(o=>{s.relays.indexOf(o)===-1&&s.relays.push(o)}),i.relays=s.relays)}}),t}var kg={};K(kg,{fetchRelayInformation:()=>Ag,useFetchImplementation:()=>Tg});var Ic;try{Ic=fetch}catch{}function Tg(e){Ic=e}async function Ag(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var _g={};K(_g,{fastEventHash:()=>Bc,getPow:()=>Lc,minePow:()=>Sg});function Lc(e){let t=0;for(let n=0;n<64;n+=8){let r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function Sg(e,t){let n=0,r=e,s=["nonce",n.toString(),t.toString()];for(r.tags.push(s);;){let i=Math.floor(new Date().getTime()/1e3);if(i!==r.created_at&&(n=0,r.created_at=i),s[1]=(++n).toString(),r.id=Bc(r),Lc(r.id)>=t)break}return r}function Bc(e){return nt(Wt(qt.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var Rg={};K(Rg,{finishRepostEvent:()=>Cg,getRepostedEvent:()=>Ig,getRepostedEventPointer:()=>Uc});function Cg(e,t,n,r){return Ut({kind:pi,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:e.content===""?"":JSON.stringify(t),created_at:e.created_at},r)}function Uc(e){if(e.kind!==pi)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){let s=e.tags[r];s.length>=2&&(s[0]==="e"&&t===void 0?t=s:s[0]==="p"&&n===void 0&&(n=s))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Ig(e,{skipVerification:t}={}){let n=Uc(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!di(r)))return r}var Lg={};K(Lg,{NOSTR_URI_REGEX:()=>Fr,parse:()=>Ug,test:()=>Bg});var Fr=new RegExp(`nostr:(${_c.source})`);function Bg(e){return typeof e=="string"&&new RegExp(`^${Fr.source}$`).test(e)}function Ug(e){let t=e.match(new RegExp(`^${Fr.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Hr(t[1])}}var Pg={};K(Pg,{finishReactionEvent:()=>Mg,getReactedEventPointer:()=>Ng});function Mg(e,t,n){let r=t.tags.filter(s=>s.length>=2&&(s[0]==="e"||s[0]==="p"));return Ut({...e,kind:gi,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Ng(e){if(e.kind!==gi)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){let s=e.tags[r];s.length>=2&&(s[0]==="e"&&t===void 0?t=s:s[0]==="p"&&n===void 0&&(n=s))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Og={};K(Og,{matchAll:()=>$g,regex:()=>Ei,replaceAll:()=>Hg});var Ei=()=>new RegExp(`\\b${Fr.source}\\b`,"g");function*$g(e){let t=e.matchAll(Ei());for(let n of t)try{let[r,s]=n;yield{uri:r,value:s,decoded:Hr(s),start:n.index,end:n.index+r.length}}catch{}}function Hg(e,t){return e.replaceAll(Ei(),(n,r)=>t({uri:n,value:r,decoded:Hr(r)}))}var qg={};K(qg,{channelCreateEvent:()=>zg,channelHideMessageEvent:()=>Fg,channelMessageEvent:()=>Dg,channelMetadataEvent:()=>Vg,channelMuteUserEvent:()=>jg});var zg=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Ut({kind:gc,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Vg=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Ut({kind:yc,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Dg=(e,t)=>{let n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Ut({kind:mc,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Fg=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Ut({kind:bc,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},jg=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Ut({kind:wc,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},Wg={};K(Wg,{EMOJI_SHORTCODE_REGEX:()=>Pc,matchAll:()=>Gg,regex:()=>ki,replaceAll:()=>Zg});var Pc=/:(\w+):/,ki=()=>new RegExp(`\\B${Pc.source}\\B`,"g");function*Gg(e){let t=e.matchAll(ki());for(let n of t)try{let[r,s]=n;yield{shortcode:r,name:s,start:n.index,end:n.index+r.length}}catch{}}function Zg(e,t){return e.replaceAll(ki(),(n,r)=>t({shortcode:n,name:r}))}var Yg={};K(Yg,{useFetchImplementation:()=>Jg,validateGithub:()=>Qg});var Ti;try{Ti=fetch}catch{}function Jg(e){Ti=e}async function Qg(e,t,n){try{return await(await Ti(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var Wn={};K(Wn,{decrypt:()=>Ri,encrypt:()=>Si,getConversationKey:()=>Ai,v2:()=>n0});var Mc=1,Nc=65535;function Ai(e,t){let n=xe.getSharedSecret(e,"02"+t).subarray(1,33);return sc(Wt,n,"nip44-v2")}function Oc(e,t){let n=oc(Wt,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function _i(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;let t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Xg(e){if(!Number.isSafeInteger(e)||e<Mc||e>Nc)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");let t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function Kg(e){let t=qt.encode(e),n=t.length,r=Xg(n),s=new Uint8Array(_i(n)-n);return En(r,t,s)}function t0(e){let t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Mc||t>Nc||n.length!==t||e.length!==2+_i(t))throw new Error("invalid padding");return ue.decode(n)}function $c(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");let r=En(n,t);return _n(Wt,e,r)}function e0(e){if(typeof e!="string")throw new Error("payload must be a valid string");let t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=It.decode(e)}catch(i){throw new Error("invalid base64: "+i.message)}let r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);let s=n[0];if(s!==2)throw new Error("unknown encryption version "+s);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Si(e,t,n=_r(32)){let{chacha_key:r,chacha_nonce:s,hmac_key:i}=Oc(t,n),o=Kg(e),a=Pr(r,s,o),c=$c(i,a,n);return It.encode(En(new Uint8Array([2]),n,a,c))}function Ri(e,t){let{nonce:n,ciphertext:r,mac:s}=e0(e),{chacha_key:i,chacha_nonce:o,hmac_key:a}=Oc(t,n),c=$c(a,r,n);if(!Ge(c,s))throw new Error("invalid MAC");let l=Pr(i,o,r);return t0(l)}var n0={utils:{getConversationKey:Ai,calcPaddedLen:_i},encrypt:Si,decrypt:Ri},r0={};K(r0,{makeNwcRequestEvent:()=>i0,parseConnectionString:()=>s0});function s0(e){let{pathname:t,searchParams:n}=new URL(e),r=t,s=n.get("relay"),i=n.get("secret");if(!r||!s||!i)throw new Error("invalid connection string");return{pubkey:r,relay:s,secret:i}}async function i0(e,t,n){let r={method:"pay_invoice",params:{invoice:n}},s=await Sc(t,e,JSON.stringify(r)),i={kind:Ec,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",e]]};return Ut(i,t)}var o0={};K(o0,{getZapEndpoint:()=>c0,makeZapReceipt:()=>h0,makeZapRequest:()=>l0,useFetchImplementation:()=>a0,validateZapRequest:()=>u0});var Ci;try{Ci=fetch}catch{}function a0(e){Ci=e}async function c0(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:o}=_e.decode(n,1e3),a=_e.fromWords(o);t=ue.decode(a)}else if(r){let[o,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let i=await(await Ci(t)).json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch{}return null}function l0({profile:e,event:t,amount:n,relays:r,comment:s=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let i={kind:9734,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&i.tags.push(["e",t]),i}function u0(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!ui(t))return"Zap request is not a valid Nostr event.";if(!di(t))return"Invalid signature on zap request.";let n=t.tags.find(([i,o])=>i==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([i,o])=>i==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([i,o])=>i==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function h0({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let s=JSON.parse(e),i=s.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",s.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}var f0={};K(f0,{createRumor:()=>Fc,createSeal:()=>jc,createWrap:()=>Wc,unwrapEvent:()=>Gc,unwrapManyEvents:()=>g0,wrapEvent:()=>Ii,wrapManyEvents:()=>p0});var d0=2*24*60*60,Hc=()=>Math.round(Date.now()/1e3),qc=()=>Math.round(Hc()-Math.random()*d0),zc=(e,t)=>Ai(e,t),Vc=(e,t,n)=>Si(JSON.stringify(e),zc(t,n)),Dc=(e,t)=>JSON.parse(Ri(e.content,zc(t,e.pubkey)));function Fc(e,t){let n={created_at:Hc(),content:"",tags:[],...e,pubkey:Or(t)};return n.id=Mr(n),n}function jc(e,t,n){return Ut({kind:pc,content:Vc(e,t,n),created_at:qc(),tags:[]},t)}function Wc(e,t){let n=fi();return Ut({kind:vc,content:Vc(e,n,t),created_at:qc(),tags:[["p",t]]},n)}function Ii(e,t,n){let r=Fc(e,t),s=jc(r,t,n);return Wc(s,n)}function p0(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");let r=Or(t),s=[Ii(e,t,r)];return n.forEach(i=>{s.push(Ii(e,t,i))}),s}function Gc(e,t){let n=Dc(e,t);return Dc(n,t)}function g0(e,t){let n=[];return e.forEach(r=>{n.push(Gc(r,t))}),n.sort((r,s)=>r.created_at-s.created_at),n}var y0={};K(y0,{getToken:()=>m0,hashPayload:()=>Li,unpackEventFromToken:()=>Yc,validateEvent:()=>el,validateEventKind:()=>Qc,validateEventMethodTag:()=>Kc,validateEventPayloadTag:()=>tl,validateEventTimestamp:()=>Jc,validateEventUrlTag:()=>Xc,validateToken:()=>b0});var Zc="Nostr ";async function m0(e,t,n,r=!1,s){let i={kind:yi,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};s&&i.tags.push(["payload",Li(s)]);let o=await n(i);return(r?Zc:"")+It.encode(qt.encode(JSON.stringify(o)))}async function b0(e,t,n){let r=await Yc(e).catch(i=>{throw i});return await el(r,t,n).catch(i=>{throw i})}async function Yc(e){if(!e)throw new Error("Missing token");e=e.replace(Zc,"");let t=ue.decode(It.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Jc(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Qc(e){return e.kind===yi}function Xc(e,t){let n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Kc(e,t){let n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function Li(e){let t=Wt(qt.encode(JSON.stringify(e)));return nt(t)}function tl(e,t){let n=e.tags.find(s=>s[0]==="payload");if(!n)return!1;let r=Li(t);return n.length>0&&n[1]===r}async function el(e,t,n,r){if(!di(e))throw new Error("Invalid nostr event, signature invalid");if(!Qc(e))throw new Error("Invalid nostr event, kind invalid");if(!Jc(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Xc(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Kc(e,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&typeof r=="object"&&Object.keys(r).length>0&&!tl(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function nl(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function w0(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ye(e,...t){if(!w0(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function rl(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");nl(e.outputLen),nl(e.blockLen)}function Rn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function sl(e,t){Ye(e);let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}var Je=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function jr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function zt(e,t){return e<<32-t|e>>>t}var v0=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Wr(e){Ye(e);let t="";for(let n=0;n<e.length;n++)t+=v0[e[n]];return t}var he={_0:48,_9:57,A:65,F:70,a:97,f:102};function il(e){if(e>=he._0&&e<=he._9)return e-he._0;if(e>=he.A&&e<=he.F)return e-(he.A-10);if(e>=he.a&&e<=he.f)return e-(he.a-10)}function Gr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let s=0,i=0;s<n;s++,i+=2){let o=il(e.charCodeAt(i)),a=il(e.charCodeAt(i+1));if(o===void 0||a===void 0){let c=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}r[s]=o*16+a}return r}function x0(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function Gn(e){return typeof e=="string"&&(e=x0(e)),Ye(e),e}function ol(...e){let t=0;for(let r=0;r<e.length;r++){let s=e[r];Ye(s),t+=s.length}let n=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){let i=e[r];n.set(i,s),s+=i.length}return n}var Zn=class{clone(){return this._cloneInto()}};function al(e){let t=r=>e().update(Gn(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Zr(e=32){if(Je&&typeof Je.getRandomValues=="function")return Je.getRandomValues(new Uint8Array(e));if(Je&&typeof Je.randomBytes=="function")return Je.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function E0(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}function cl(e,t,n){return e&t^~e&n}function ll(e,t,n){return e&t^e&n^t&n}var Bi=class extends Zn{constructor(t,n,r,s){super();this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=jr(this.buffer)}update(t){Rn(this);let{view:n,buffer:r,blockLen:s}=this;t=Gn(t);let i=t.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=jr(t);for(;s<=i-o;o+=s)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Rn(this),sl(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:s,isLE:i}=this,{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let h=o;h<s;h++)n[h]=0;E0(r,s-8,BigInt(this.length*8),i),this.process(r,0);let a=jr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:s,finished:i,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=i,t.destroyed=o,s%n&&t.buffer.set(r),t}};var k0=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Le=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Be=new Uint32Array(64),ul=class extends Bi{constructor(){super(64,32,8,!1);this.A=Le[0]|0,this.B=Le[1]|0,this.C=Le[2]|0,this.D=Le[3]|0,this.E=Le[4]|0,this.F=Le[5]|0,this.G=Le[6]|0,this.H=Le[7]|0}get(){let{A:t,B:n,C:r,D:s,E:i,F:o,G:a,H:c}=this;return[t,n,r,s,i,o,a,c]}set(t,n,r,s,i,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let h=0;h<16;h++,n+=4)Be[h]=t.getUint32(n,!1);for(let h=16;h<64;h++){let f=Be[h-15],g=Be[h-2],y=zt(f,7)^zt(f,18)^f>>>3,p=zt(g,17)^zt(g,19)^g>>>10;Be[h]=p+Be[h-7]+y+Be[h-16]|0}let{A:r,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){let f=zt(a,6)^zt(a,11)^zt(a,25),g=u+f+cl(a,c,l)+k0[h]+Be[h]|0,p=(zt(r,2)^zt(r,13)^zt(r,22))+ll(r,s,i)|0;u=l,l=c,c=a,a=o+g|0,o=i,i=s,s=r,r=g+p|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,s,i,o,a,c,l,u)}roundClean(){Be.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Qe=al(()=>new ul);var Ui=class extends Zn{constructor(t,n){super();this.finished=!1,this.destroyed=!1,rl(t);let r=Gn(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?t.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=t.create();for(let o=0;o<i.length;o++)i[o]^=54^92;this.oHash.update(i),i.fill(0)}update(t){return Rn(this),this.iHash.update(t),this}digestInto(t){Rn(this),Ye(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Pi=(e,t,n)=>new Ui(e,t).update(n).digest();Pi.create=(e,t)=>new Ui(e,t);var qi={};Uo(qi,{aInRange:()=>Qt,abool:()=>Xe,abytes:()=>Cn,bitGet:()=>C0,bitLen:()=>Oi,bitMask:()=>Yn,bitSet:()=>I0,bytesToHex:()=>Ke,bytesToNumberBE:()=>Pt,bytesToNumberLE:()=>Qr,concatBytes:()=>de,createHmacDrbg:()=>Hi,ensureBytes:()=>at,equalBytes:()=>S0,hexToBytes:()=>en,hexToNumber:()=>Mi,inRange:()=>Pe,isBytes:()=>Ue,memoized:()=>Kr,notImplemented:()=>B0,numberToBytesBE:()=>Vt,numberToBytesLE:()=>Xr,numberToHexUnpadded:()=>tn,numberToVarBytesBE:()=>_0,utf8ToBytes:()=>R0,validateObject:()=>Me});var Yr=BigInt(0),Jr=BigInt(1),T0=BigInt(2);function Ue(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Cn(e){if(!Ue(e))throw new Error("Uint8Array expected")}function Xe(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}var A0=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ke(e){Cn(e);let t="";for(let n=0;n<e.length;n++)t+=A0[e[n]];return t}function tn(e){let t=e.toString(16);return t.length&1?"0"+t:t}function Mi(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Yr:BigInt("0x"+e)}var fe={_0:48,_9:57,A:65,F:70,a:97,f:102};function hl(e){if(e>=fe._0&&e<=fe._9)return e-fe._0;if(e>=fe.A&&e<=fe.F)return e-(fe.A-10);if(e>=fe.a&&e<=fe.f)return e-(fe.a-10)}function en(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let s=0,i=0;s<n;s++,i+=2){let o=hl(e.charCodeAt(i)),a=hl(e.charCodeAt(i+1));if(o===void 0||a===void 0){let c=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}r[s]=o*16+a}return r}function Pt(e){return Mi(Ke(e))}function Qr(e){return Cn(e),Mi(Ke(Uint8Array.from(e).reverse()))}function Vt(e,t){return en(e.toString(16).padStart(t*2,"0"))}function Xr(e,t){return Vt(e,t).reverse()}function _0(e){return en(tn(e))}function at(e,t,n){let r;if(typeof t=="string")try{r=en(t)}catch(i){throw new Error(e+" must be hex string or Uint8Array, cause: "+i)}else if(Ue(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let s=r.length;if(typeof n=="number"&&s!==n)throw new Error(e+" of length "+n+" expected, got "+s);return r}function de(...e){let t=0;for(let r=0;r<e.length;r++){let s=e[r];Cn(s),t+=s.length}let n=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){let i=e[r];n.set(i,s),s+=i.length}return n}function S0(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function R0(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}var Ni=e=>typeof e=="bigint"&&Yr<=e;function Pe(e,t,n){return Ni(e)&&Ni(t)&&Ni(n)&&t<=e&&e<n}function Qt(e,t,n,r){if(!Pe(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Oi(e){let t;for(t=0;e>Yr;e>>=Jr,t+=1);return t}function C0(e,t){return e>>BigInt(t)&Jr}function I0(e,t,n){return e|(n?Jr:Yr)<<BigInt(t)}var Yn=e=>(T0<<BigInt(e-1))-Jr,$i=e=>new Uint8Array(e),fl=e=>Uint8Array.from(e);function Hi(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=$i(e),s=$i(e),i=0,o=()=>{r.fill(1),s.fill(0),i=0},a=(...h)=>n(s,r,...h),c=(h=$i())=>{s=a(fl([0]),h),r=a(),h.length!==0&&(s=a(fl([1]),h),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,f=[];for(;h<t;){r=a();let g=r.slice();f.push(g),h+=r.length}return de(...f)};return(h,f)=>{o(),c(h);let g;for(;!(g=f(l()));)c();return o(),g}}var L0={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||Ue(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Me(e,t,n={}){let r=(s,i,o)=>{let a=L0[i];if(typeof a!="function")throw new Error("invalid validator function");let c=e[s];if(!(o&&c===void 0)&&!a(c,e))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(let[s,i]of Object.entries(t))r(s,i,!1);for(let[s,i]of Object.entries(n))r(s,i,!0);return e}var B0=()=>{throw new Error("not implemented")};function Kr(e){let t=new WeakMap;return(n,...r)=>{let s=t.get(n);if(s!==void 0)return s;let i=e(n,...r);return t.set(n,i),i}}var ct=BigInt(0),tt=BigInt(1),nn=BigInt(2),U0=BigInt(3),zi=BigInt(4),dl=BigInt(5),pl=BigInt(8),P0=BigInt(9),M0=BigInt(16);function lt(e,t){let n=e%t;return n>=ct?n:t+n}function N0(e,t,n){if(t<ct)throw new Error("invalid exponent, negatives unsupported");if(n<=ct)throw new Error("invalid modulus");if(n===tt)return ct;let r=tt;for(;t>ct;)t&tt&&(r=r*e%n),e=e*e%n,t>>=tt;return r}function kt(e,t,n){let r=e;for(;t-- >ct;)r*=r,r%=n;return r}function ts(e,t){if(e===ct)throw new Error("invert: expected non-zero number");if(t<=ct)throw new Error("invert: expected positive modulus, got "+t);let n=lt(e,t),r=t,s=ct,i=tt,o=tt,a=ct;for(;n!==ct;){let l=r/n,u=r%n,h=s-o*l,f=i-a*l;r=n,n=u,s=o,i=a,o=h,a=f}if(r!==tt)throw new Error("invert: does not exist");return lt(s,t)}function O0(e){let t=(e-tt)/nn,n,r,s;for(n=e-tt,r=0;n%nn===ct;n/=nn,r++);for(s=nn;s<e&&N0(s,t,e)!==e-tt;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){let o=(e+tt)/zi;return function(c,l){let u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}let i=(n+tt)/nn;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,u=a.pow(a.mul(a.ONE,s),n),h=a.pow(c,i),f=a.pow(c,n);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let g=1;for(let p=a.sqr(f);g<l&&!a.eql(p,a.ONE);g++)p=a.sqr(p);let y=a.pow(u,tt<<BigInt(l-g-1));u=a.sqr(y),h=a.mul(h,y),f=a.mul(f,u),l=g}return h}}function $0(e){if(e%zi===U0){let t=(e+tt)/zi;return function(r,s){let i=r.pow(s,t);if(!r.eql(r.sqr(i),s))throw new Error("Cannot find square root");return i}}if(e%pl===dl){let t=(e-dl)/pl;return function(r,s){let i=r.mul(s,nn),o=r.pow(i,t),a=r.mul(s,o),c=r.mul(r.mul(a,nn),o),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return e%M0===P0,O0(e)}var H0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Vi(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=H0.reduce((r,s)=>(r[s]="function",r),t);return Me(e,n)}function q0(e,t,n){if(n<ct)throw new Error("invalid exponent, negatives unsupported");if(n===ct)return e.ONE;if(n===tt)return t;let r=e.ONE,s=t;for(;n>ct;)n&tt&&(r=e.mul(r,s)),s=e.sqr(s),n>>=tt;return r}function z0(e,t){let n=new Array(t.length),r=t.reduce((i,o,a)=>e.is0(o)?i:(n[a]=i,e.mul(i,o)),e.ONE),s=e.inv(r);return t.reduceRight((i,o,a)=>e.is0(o)?i:(n[a]=e.mul(i,n[a]),e.mul(i,o)),s),n}function Di(e,t){let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function es(e,t,n=!1,r={}){if(e<=ct)throw new Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:s,nByteLength:i}=Di(e,t);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:e,isLE:n,BITS:s,BYTES:i,MASK:Yn(s),ZERO:ct,ONE:tt,create:c=>lt(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ct<=c&&c<e},is0:c=>c===ct,isOdd:c=>(c&tt)===tt,neg:c=>lt(-c,e),eql:(c,l)=>c===l,sqr:c=>lt(c*c,e),add:(c,l)=>lt(c+l,e),sub:(c,l)=>lt(c-l,e),mul:(c,l)=>lt(c*l,e),pow:(c,l)=>q0(a,c,l),div:(c,l)=>lt(c*ts(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>ts(c,e),sqrt:r.sqrt||(c=>(o||(o=$0(e)),o(a,c))),invertBatch:c=>z0(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>n?Xr(c,i):Vt(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return n?Qr(c):Pt(c)}});return Object.freeze(a)}function gl(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Fi(e){let t=gl(e);return t+Math.ceil(t/2)}function yl(e,t,n=!1){let r=e.length,s=gl(t),i=Fi(t);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);let o=n?Qr(e):Pt(e),a=lt(o,t-tt)+tt;return n?Xr(a,s):Vt(a,s)}var ml=BigInt(0),ns=BigInt(1);function ji(e,t){let n=t.negate();return e?n:t}function bl(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Wi(e,t){bl(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1);return{windows:n,windowSize:r}}function V0(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function D0(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}var Gi=new WeakMap,wl=new WeakMap;function Zi(e){return wl.get(e)||1}function vl(e,t){return{constTimeNegate:ji,hasPrecomputes(n){return Zi(n)!==1},unsafeLadder(n,r,s=e.ZERO){let i=n;for(;r>ml;)r&ns&&(s=s.add(i)),i=i.double(),r>>=ns;return s},precomputeWindow(n,r){let{windows:s,windowSize:i}=Wi(r,t),o=[],a=n,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,s){let{windows:i,windowSize:o}=Wi(n,t),a=e.ZERO,c=e.BASE,l=BigInt(2**n-1),u=2**n,h=BigInt(n);for(let f=0;f<i;f++){let g=f*o,y=Number(s&l);s>>=h,y>o&&(y-=u,s+=ns);let p=g,d=g+Math.abs(y)-1,m=f%2!==0,v=y<0;y===0?c=c.add(ji(m,r[p])):a=a.add(ji(v,r[d]))}return{p:a,f:c}},wNAFUnsafe(n,r,s,i=e.ZERO){let{windows:o,windowSize:a}=Wi(n,t),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){let f=h*a;if(s===ml)break;let g=Number(s&c);if(s>>=u,g>a&&(g-=l,s+=ns),g===0)continue;let y=r[f+Math.abs(g)-1];g<0&&(y=y.negate()),i=i.add(y)}return i},getPrecomputes(n,r,s){let i=Gi.get(r);return i||(i=this.precomputeWindow(r,n),n!==1&&Gi.set(r,s(i))),i},wNAFCached(n,r,s){let i=Zi(n);return this.wNAF(i,this.getPrecomputes(i,n,s),r)},wNAFCachedUnsafe(n,r,s,i){let o=Zi(n);return o===1?this.unsafeLadder(n,r,i):this.wNAFUnsafe(o,this.getPrecomputes(o,n,s),r,i)},setWindowSize(n,r){bl(r,t),wl.set(n,r),Gi.delete(n)}}}function xl(e,t,n,r){if(V0(n,e),D0(r,t),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");let s=e.ZERO,i=Oi(BigInt(n.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((t.BITS-1)/o)*o,u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let g=0;g<r.length;g++){let y=r[g],p=Number(y>>BigInt(h)&BigInt(a));c[p]=c[p].add(n[g])}let f=s;for(let g=c.length-1,y=s;g>0;g--)y=y.add(c[g]),f=f.add(y);if(u=u.add(f),h!==0)for(let g=0;g<o;g++)u=u.double()}return u}function Yi(e){return Vi(e.Fp),Me(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Di(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function El(e){e.lowS!==void 0&&Xe("lowS",e.lowS),e.prehash!==void 0&&Xe("prehash",e.prehash)}function F0(e){let t=Yi(e);Me(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:s}=t;if(n){if(!r.eql(s,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:j0,hexToBytes:W0}=qi,kl=class extends Error{constructor(t=""){super(t)}},pe={Err:kl,_tlv:{encode:(e,t)=>{let{Err:n}=pe;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");let r=t.length/2,s=tn(r);if(s.length/2&128)throw new n("tlv.encode: long form length too big");let i=r>127?tn(s.length/2|128):"";return tn(e)+i+s+t},decode(e,t){let{Err:n}=pe,r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");let s=t[r++],i=!!(s&128),o=0;if(!i)o=s;else{let c=s&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");let l=t.subarray(r,r+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(let u of l)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}let a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){let{Err:t}=pe;if(e<ge)throw new t("integer: negative integers are not allowed");let n=tn(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){let{Err:t}=pe;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return j0(e)}},toSig(e){let{Err:t,_int:n,_tlv:r}=pe,s=typeof e=="string"?W0(e):e;Cn(s);let{v:i,l:o}=r.decode(48,s);if(o.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=r.decode(2,i),{v:l,l:u}=r.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(e){let{_tlv:t,_int:n}=pe,r=t.encode(2,n.encode(e.r)),s=t.encode(2,n.encode(e.s)),i=r+s;return t.encode(48,i)}},ge=BigInt(0),ft=BigInt(1),j1=BigInt(2),Tl=BigInt(3),W1=BigInt(4);function G0(e){let t=F0(e),{Fp:n}=t,r=es(t.n,t.nBitLength),s=t.toBytes||((p,d,m)=>{let v=d.toAffine();return de(Uint8Array.from([4]),n.toBytes(v.x),n.toBytes(v.y))}),i=t.fromBytes||(p=>{let d=p.subarray(1),m=n.fromBytes(d.subarray(0,n.BYTES)),v=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:m,y:v}});function o(p){let{a:d,b:m}=t,v=n.sqr(p),E=n.mul(v,p);return n.add(n.add(E,n.mul(p,d)),m)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function a(p){return Pe(p,ft,t.n)}function c(p){let{allowedPrivateKeyLengths:d,nByteLength:m,wrapPrivateKey:v,n:E}=t;if(d&&typeof p!="bigint"){if(Ue(p)&&(p=Ke(p)),typeof p!="string"||!d.includes(p.length))throw new Error("invalid private key");p=p.padStart(m*2,"0")}let T;try{T=typeof p=="bigint"?p:Pt(at("private key",p,m))}catch{throw new Error("invalid private key, expected hex or "+m+" bytes, got "+typeof p)}return v&&(T=lt(T,E)),Qt("private key",T,ft,E),T}function l(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}let u=Kr((p,d)=>{let{px:m,py:v,pz:E}=p;if(n.eql(E,n.ONE))return{x:m,y:v};let T=p.is0();d==null&&(d=T?n.ONE:n.inv(E));let U=n.mul(m,d),S=n.mul(v,d),I=n.mul(E,d);if(T)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:U,y:S}}),h=Kr(p=>{if(p.is0()){if(t.allowInfinityPoint&&!n.is0(p.py))return;throw new Error("bad point: ZERO")}let{x:d,y:m}=p.toAffine();if(!n.isValid(d)||!n.isValid(m))throw new Error("bad point: x or y not FE");let v=n.sqr(m),E=o(d);if(!n.eql(v,E))throw new Error("bad point: equation left != right");if(!p.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class f{constructor(d,m,v){if(this.px=d,this.py=m,this.pz=v,d==null||!n.isValid(d))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(v==null||!n.isValid(v))throw new Error("z required");Object.freeze(this)}static fromAffine(d){let{x:m,y:v}=d||{};if(!d||!n.isValid(m)||!n.isValid(v))throw new Error("invalid affine point");if(d instanceof f)throw new Error("projective point not allowed");let E=T=>n.eql(T,n.ZERO);return E(m)&&E(v)?f.ZERO:new f(m,v,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let m=n.invertBatch(d.map(v=>v.pz));return d.map((v,E)=>v.toAffine(m[E])).map(f.fromAffine)}static fromHex(d){let m=f.fromAffine(i(at("pointHex",d)));return m.assertValidity(),m}static fromPrivateKey(d){return f.BASE.multiply(c(d))}static msm(d,m){return xl(f,r,d,m)}_setWindowSize(d){y.setWindowSize(this,d)}assertValidity(){h(this)}hasEvenY(){let{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){l(d);let{px:m,py:v,pz:E}=this,{px:T,py:U,pz:S}=d,I=n.eql(n.mul(m,S),n.mul(T,E)),R=n.eql(n.mul(v,S),n.mul(U,E));return I&&R}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){let{a:d,b:m}=t,v=n.mul(m,Tl),{px:E,py:T,pz:U}=this,S=n.ZERO,I=n.ZERO,R=n.ZERO,L=n.mul(E,E),N=n.mul(T,T),P=n.mul(U,U),B=n.mul(E,T);return B=n.add(B,B),R=n.mul(E,U),R=n.add(R,R),S=n.mul(d,R),I=n.mul(v,P),I=n.add(S,I),S=n.sub(N,I),I=n.add(N,I),I=n.mul(S,I),S=n.mul(B,S),R=n.mul(v,R),P=n.mul(d,P),B=n.sub(L,P),B=n.mul(d,B),B=n.add(B,R),R=n.add(L,L),L=n.add(R,L),L=n.add(L,P),L=n.mul(L,B),I=n.add(I,L),P=n.mul(T,U),P=n.add(P,P),L=n.mul(P,B),S=n.sub(S,L),R=n.mul(P,N),R=n.add(R,R),R=n.add(R,R),new f(S,I,R)}add(d){l(d);let{px:m,py:v,pz:E}=this,{px:T,py:U,pz:S}=d,I=n.ZERO,R=n.ZERO,L=n.ZERO,N=t.a,P=n.mul(t.b,Tl),B=n.mul(m,T),C=n.mul(v,U),x=n.mul(E,S),b=n.add(m,v),w=n.add(T,U);b=n.mul(b,w),w=n.add(B,C),b=n.sub(b,w),w=n.add(m,E);let k=n.add(T,S);return w=n.mul(w,k),k=n.add(B,x),w=n.sub(w,k),k=n.add(v,E),I=n.add(U,S),k=n.mul(k,I),I=n.add(C,x),k=n.sub(k,I),L=n.mul(N,w),I=n.mul(P,x),L=n.add(I,L),I=n.sub(C,L),L=n.add(C,L),R=n.mul(I,L),C=n.add(B,B),C=n.add(C,B),x=n.mul(N,x),w=n.mul(P,w),C=n.add(C,x),x=n.sub(B,x),x=n.mul(N,x),w=n.add(w,x),B=n.mul(C,w),R=n.add(R,B),B=n.mul(k,w),I=n.mul(b,I),I=n.sub(I,B),B=n.mul(b,C),L=n.mul(k,L),L=n.add(L,B),new f(I,R,L)}subtract(d){return this.add(d.negate())}is0(){return this.equals(f.ZERO)}wNAF(d){return y.wNAFCached(this,d,f.normalizeZ)}multiplyUnsafe(d){let{endo:m,n:v}=t;Qt("scalar",d,ge,v);let E=f.ZERO;if(d===ge)return E;if(this.is0()||d===ft)return this;if(!m||y.hasPrecomputes(this))return y.wNAFCachedUnsafe(this,d,f.normalizeZ);let{k1neg:T,k1:U,k2neg:S,k2:I}=m.splitScalar(d),R=E,L=E,N=this;for(;U>ge||I>ge;)U&ft&&(R=R.add(N)),I&ft&&(L=L.add(N)),N=N.double(),U>>=ft,I>>=ft;return T&&(R=R.negate()),S&&(L=L.negate()),L=new f(n.mul(L.px,m.beta),L.py,L.pz),R.add(L)}multiply(d){let{endo:m,n:v}=t;Qt("scalar",d,ft,v);let E,T;if(m){let{k1neg:U,k1:S,k2neg:I,k2:R}=m.splitScalar(d),{p:L,f:N}=this.wNAF(S),{p:P,f:B}=this.wNAF(R);L=y.constTimeNegate(U,L),P=y.constTimeNegate(I,P),P=new f(n.mul(P.px,m.beta),P.py,P.pz),E=L.add(P),T=N.add(B)}else{let{p:U,f:S}=this.wNAF(d);E=U,T=S}return f.normalizeZ([E,T])[0]}multiplyAndAddUnsafe(d,m,v){let E=f.BASE,T=(S,I)=>I===ge||I===ft||!S.equals(E)?S.multiplyUnsafe(I):S.multiply(I),U=T(this,m).add(T(d,v));return U.is0()?void 0:U}toAffine(d){return u(this,d)}isTorsionFree(){let{h:d,isTorsionFree:m}=t;if(d===ft)return!0;if(m)return m(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:m}=t;return d===ft?this:m?m(f,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return Xe("isCompressed",d),this.assertValidity(),s(f,this,d)}toHex(d=!0){return Xe("isCompressed",d),Ke(this.toRawBytes(d))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);let g=t.nBitLength,y=vl(f,t.endo?Math.ceil(g/2):g);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Z0(e){let t=Yi(e);return Me(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Al(e){let t=Z0(e),{Fp:n,n:r}=t,s=n.BYTES+1,i=2*n.BYTES+1;function o(x){return lt(x,r)}function a(x){return ts(x,r)}let{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=G0({...t,toBytes(x,b,w){let k=b.toAffine(),_=n.toBytes(k.x),A=de;return Xe("isCompressed",w),w?A(Uint8Array.from([b.hasEvenY()?2:3]),_):A(Uint8Array.from([4]),_,n.toBytes(k.y))},fromBytes(x){let b=x.length,w=x[0],k=x.subarray(1);if(b===s&&(w===2||w===3)){let _=Pt(k);if(!Pe(_,ft,n.ORDER))throw new Error("Point is not on curve");let A=u(_),M;try{M=n.sqrt(A)}catch(z){let F=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+F)}let O=(M&ft)===ft;return(w&1)===1!==O&&(M=n.neg(M)),{x:_,y:M}}else if(b===i&&w===4){let _=n.fromBytes(k.subarray(0,n.BYTES)),A=n.fromBytes(k.subarray(n.BYTES,2*n.BYTES));return{x:_,y:A}}else{let _=s,A=i;throw new Error("invalid Point, expected length of "+_+", or uncompressed "+A+", got "+b)}}}),f=x=>Ke(Vt(x,t.nByteLength));function g(x){let b=r>>ft;return x>b}function y(x){return g(x)?o(-x):x}let p=(x,b,w)=>Pt(x.slice(b,w));class d{constructor(b,w,k){this.r=b,this.s=w,this.recovery=k,this.assertValidity()}static fromCompact(b){let w=t.nByteLength;return b=at("compactSignature",b,w*2),new d(p(b,0,w),p(b,w,2*w))}static fromDER(b){let{r:w,s:k}=pe.toSig(at("DER",b));return new d(w,k)}assertValidity(){Qt("r",this.r,ft,r),Qt("s",this.s,ft,r)}addRecoveryBit(b){return new d(this.r,this.s,b)}recoverPublicKey(b){let{r:w,s:k,recovery:_}=this,A=S(at("msgHash",b));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");let M=_===2||_===3?w+t.n:w;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let O=(_&1)===0?"02":"03",H=c.fromHex(O+f(M)),z=a(M),F=o(-A*z),G=o(k*z),Z=c.BASE.multiplyAndAddUnsafe(H,F,G);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return en(this.toDERHex())}toDERHex(){return pe.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return en(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let m={isValidPrivateKey(x){try{return l(x),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let x=Fi(t.n);return yl(t.randomBytes(x),t.n)},precompute(x=8,b=c.BASE){return b._setWindowSize(x),b.multiply(BigInt(3)),b}};function v(x,b=!0){return c.fromPrivateKey(x).toRawBytes(b)}function E(x){let b=Ue(x),w=typeof x=="string",k=(b||w)&&x.length;return b?k===s||k===i:w?k===2*s||k===2*i:x instanceof c}function T(x,b,w=!0){if(E(x))throw new Error("first arg must be private key");if(!E(b))throw new Error("second arg must be public key");return c.fromHex(b).multiply(l(x)).toRawBytes(w)}let U=t.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");let b=Pt(x),w=x.length*8-t.nBitLength;return w>0?b>>BigInt(w):b},S=t.bits2int_modN||function(x){return o(U(x))},I=Yn(t.nBitLength);function R(x){return Qt("num < 2^"+t.nBitLength,x,ge,I),Vt(x,t.nByteLength)}function L(x,b,w=N){if(["recovered","canonical"].some(j=>j in w))throw new Error("sign() legacy options not supported");let{hash:k,randomBytes:_}=t,{lowS:A,prehash:M,extraEntropy:O}=w;A==null&&(A=!0),x=at("msgHash",x),El(w),M&&(x=at("prehashed msgHash",k(x)));let H=S(x),z=l(b),F=[R(z),R(H)];if(O!=null&&O!==!1){let j=O===!0?_(n.BYTES):O;F.push(at("extraEntropy",j))}let G=de(...F),Z=H;function Y(j){let W=U(j);if(!h(W))return;let yt=a(W),wt=c.BASE.multiply(W).toAffine(),ut=o(wt.x);if(ut===ge)return;let St=o(yt*o(Z+ut*z));if(St===ge)return;let Nt=(wt.x===ut?0:2)|Number(wt.y&ft),Mn=St;return A&&g(St)&&(Mn=y(St),Nt^=1),new d(ut,Mn,Nt)}return{seed:G,k2sig:Y}}let N={lowS:t.lowS,prehash:!1},P={lowS:t.lowS,prehash:!1};function B(x,b,w=N){let{seed:k,k2sig:_}=L(x,b,w),A=t;return Hi(A.hash.outputLen,A.nByteLength,A.hmac)(k,_)}c.BASE._setWindowSize(8);function C(x,b,w,k=P){let _=x;b=at("msgHash",b),w=at("publicKey",w);let{lowS:A,prehash:M,format:O}=k;if(El(k),"strict"in k)throw new Error("options.strict was renamed to lowS");if(O!==void 0&&O!=="compact"&&O!=="der")throw new Error("format must be compact or der");let H=typeof _=="string"||Ue(_),z=!H&&!O&&typeof _=="object"&&_!==null&&typeof _.r=="bigint"&&typeof _.s=="bigint";if(!H&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let F,G;try{if(z&&(F=new d(_.r,_.s)),H){try{O!=="compact"&&(F=d.fromDER(_))}catch(Nt){if(!(Nt instanceof pe.Err))throw Nt}!F&&O!=="der"&&(F=d.fromCompact(_))}G=c.fromHex(w)}catch{return!1}if(!F||A&&F.hasHighS())return!1;M&&(b=t.hash(b));let{r:Z,s:Y}=F,j=S(b),W=a(Y),yt=o(j*W),wt=o(Z*W),ut=c.BASE.multiplyAndAddUnsafe(G,yt,wt)?.toAffine();return ut?o(ut.x)===Z:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:T,sign:B,verify:C,ProjectivePoint:c,Signature:d,utils:m}}function Y0(e){return{hash:e,hmac:(t,...n)=>Pi(e,t,ol(...n)),randomBytes:Zr}}function _l(e,t){let n=r=>Al({...e,...Y0(r)});return{...n(t),create:n}}var Jn=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),rs=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qn=BigInt(1),ss=BigInt(2),Sl=(e,t)=>(e+t/ss)/t;function Rl(e){let t=Jn,n=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=kt(u,n,t)*u%t,f=kt(h,n,t)*u%t,g=kt(f,ss,t)*l%t,y=kt(g,s,t)*g%t,p=kt(y,i,t)*y%t,d=kt(p,a,t)*p%t,m=kt(d,c,t)*d%t,v=kt(m,a,t)*p%t,E=kt(v,n,t)*u%t,T=kt(E,o,t)*y%t,U=kt(T,r,t)*l%t,S=kt(U,ss,t);if(!Ji.eql(Ji.sqr(S),e))throw new Error("Cannot find square root");return S}var Ji=es(Jn,void 0,void 0,{sqrt:Rl}),Qi=_l({a:BigInt(0),b:BigInt(7),Fp:Ji,n:rs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=rs,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Qn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,o=BigInt("0x100000000000000000000000000000000"),a=Sl(i*e,t),c=Sl(-r*e,t),l=lt(e-a*n-c*s,t),u=lt(-a*r-c*i,t),h=l>o,f=u>o;if(h&&(l=t-l),f&&(u=t-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},Qe),Cl=BigInt(0),Il={};function is(e,...t){let n=Il[e];if(n===void 0){let r=Qe(Uint8Array.from(e,s=>s.charCodeAt(0)));n=de(r,r),Il[e]=n}return Qe(de(n,...t))}var Xi=e=>e.toRawBytes(!0).slice(1),Ki=e=>Vt(e,32),to=e=>lt(e,Jn),Xn=e=>lt(e,rs),eo=Qi.ProjectivePoint,J0=(e,t,n)=>eo.BASE.multiplyAndAddUnsafe(e,t,n);function no(e){let t=Qi.utils.normPrivateKeyToScalar(e),n=eo.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Xn(-t),bytes:Xi(n)}}function Ll(e){Qt("x",e,Qn,Jn);let t=to(e*e),n=to(t*e+BigInt(7)),r=Rl(n);r%ss!==Cl&&(r=to(-r));let s=new eo(e,r,Qn);return s.assertValidity(),s}var In=Pt;function Bl(...e){return Xn(In(is("BIP0340/challenge",...e)))}function Q0(e){return no(e).bytes}function X0(e,t,n=Zr(32)){let r=at("message",e),{bytes:s,scalar:i}=no(t),o=at("auxRand",n,32),a=Ki(i^In(is("BIP0340/aux",o))),c=is("BIP0340/nonce",a,s,r),l=Xn(In(c));if(l===Cl)throw new Error("sign failed: k is zero");let{bytes:u,scalar:h}=no(l),f=Bl(u,s,r),g=new Uint8Array(64);if(g.set(u,0),g.set(Ki(Xn(h+f*i)),32),!Ul(g,r,s))throw new Error("sign: Invalid signature produced");return g}function Ul(e,t,n){let r=at("signature",e,64),s=at("message",t),i=at("publicKey",n,32);try{let o=Ll(In(i)),a=In(r.subarray(0,32));if(!Pe(a,Qn,Jn))return!1;let c=In(r.subarray(32,64));if(!Pe(c,Qn,rs))return!1;let l=Bl(Ki(a),Xi(o),s),u=J0(o,c,Xn(-l));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}var Pl=(()=>({getPublicKey:Q0,sign:X0,verify:Ul,utils:{randomPrivateKey:Qi.utils.randomPrivateKey,lift_x:Ll,pointToBytes:Xi,numberToBytesBE:Vt,bytesToNumberBE:Pt,taggedHash:is,mod:lt}}))();var _u=Q(ro(),1);var Su=Q(jt(),1);function so(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Hl(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function ql(e){if(typeof e!="function")throw new Error("function expected");return!0}function Ln(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function Kn(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function cs(e){if(!Array.isArray(e))throw new Error("array expected")}function ls(e,t){if(!Hl(!0,t))throw new Error(`${e}: array of strings expected`)}function io(e,t){if(!Hl(!1,t))throw new Error(`${e}: array of numbers expected`)}function Tt(...e){let t=i=>i,n=(i,o)=>a=>i(o(a)),r=e.map(i=>i.encode).reduceRight(n,t),s=e.map(i=>i.decode).reduce(n,t);return{encode:r,decode:s}}function At(e){let t=typeof e=="string"?e.split(""):e,n=t.length;ls("alphabet",t);let r=new Map(t.map((s,i)=>[s,i]));return{encode:s=>(cs(s),s.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${e}`);return t[i]})),decode:s=>(cs(s),s.map(i=>{Ln("alphabet.decode",i);let o=r.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${e}`);return o}))}}function _t(e=""){return Ln("join",e),{encode:t=>(ls("join.decode",t),t.join(e)),decode:t=>(Ln("join.decode",t),t.split(e))}}function us(e,t="="){return Kn(e),Ln("padding",t),{encode(n){for(ls("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){ls("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if((r-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}function zl(e){return ql(e),{encode:t=>t,decode:t=>e(t)}}function Vl(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(cs(e),!e.length)return[];let r=0,s=[],i=Array.from(e,a=>{if(Kn(a),a<0||a>=t)throw new Error(`invalid integer: ${a}`);return a}),o=i.length;for(;;){let a=0,c=!0;for(let l=r;l<o;l++){let u=i[l],h=t*a,f=h+u;if(!Number.isSafeInteger(f)||h/t!==a||f-u!==h)throw new Error("convertRadix: carry overflow");let g=f/n;a=f%n;let y=Math.floor(g);if(i[l]=y,!Number.isSafeInteger(y)||y*n+a!==f)throw new Error("convertRadix: carry overflow");if(c)y?c=!1:r=l;else continue}if(s.push(a),c)break}for(let a=0;a<e.length-1&&e[a]===0;a++)s.push(0);return s.reverse()}var Dl=(e,t)=>t===0?e:Dl(t,e%t),hs=(e,t)=>e+(t-Dl(e,t)),fs=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function oo(e,t,n,r){if(cs(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(hs(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${hs(t,n)}`);let s=0,i=0,o=fs[t],a=fs[n]-1,c=[];for(let l of e){if(Kn(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${t}`);if(s=s<<t|l,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)c.push((s>>i-n&a)>>>0);let u=fs[i];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<n-i&a,!r&&i>=t)throw new Error("Excess padding");if(!r&&s>0)throw new Error(`Non-zero padding: ${s}`);return r&&i>0&&c.push(s>>>0),c}function ny(e){Kn(e);let t=2**8;return{encode:n=>{if(!so(n))throw new Error("radix.encode input should be Uint8Array");return Vl(Array.from(n),t,e)},decode:n=>(io("radix.decode",n),Uint8Array.from(Vl(n,e,t)))}}function Mt(e,t=!1){if(Kn(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(hs(8,e)>32||hs(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!so(n))throw new Error("radix2.encode input should be Uint8Array");return oo(Array.from(n),8,e,!t)},decode:n=>(io("radix2.decode",n),Uint8Array.from(oo(n,e,8,t)))}}function Fl(e){return ql(e),function(...t){try{return e.apply(null,t)}catch{}}}var av=Tt(Mt(4),At("0123456789ABCDEF"),_t("")),cv=Tt(Mt(5),At("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),us(5),_t("")),lv=Tt(Mt(5),At("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),_t("")),uv=Tt(Mt(5),At("0123456789ABCDEFGHIJKLMNOPQRSTUV"),us(5),_t("")),hv=Tt(Mt(5),At("0123456789ABCDEFGHIJKLMNOPQRSTUV"),_t("")),fv=Tt(Mt(5),At("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),_t(""),zl(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),dv=Tt(Mt(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),us(6),_t("")),pv=Tt(Mt(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),_t("")),gv=Tt(Mt(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),us(6),_t("")),yv=Tt(Mt(6),At("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),_t("")),ao=e=>Tt(ny(58),At(e),_t("")),mv=ao("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),bv=ao("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),wv=ao("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");var co=Tt(At("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),_t("")),jl=[996825010,642813549,513874426,1027748829,705979059];function tr(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<jl.length;r++)(t>>r&1)===1&&(n^=jl[r]);return n}function Wl(e,t,n=1){let r=e.length,s=1;for(let i=0;i<r;i++){let o=e.charCodeAt(i);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);s=tr(s)^o>>5}s=tr(s);for(let i=0;i<r;i++)s=tr(s)^e.charCodeAt(i)&31;for(let i of t)s=tr(s)^i;for(let i=0;i<6;i++)s=tr(s);return s^=n,co.encode(oo([s%fs[30]],30,5,!1))}function Gl(e){let t=e==="bech32"?1:734539939,n=Mt(5),r=n.decode,s=n.encode,i=Fl(r);function o(h,f,g=90){Ln("bech32.encode prefix",h),so(f)&&(f=Array.from(f)),io("bech32.encode",f);let y=h.length;if(y===0)throw new TypeError(`Invalid prefix length ${y}`);let p=y+7+f.length;if(g!==!1&&p>g)throw new TypeError(`Length ${p} exceeds limit ${g}`);let d=h.toLowerCase(),m=Wl(d,f,t);return`${d}1${co.encode(f)}${m}`}function a(h,f=90){Ln("bech32.decode input",h);let g=h.length;if(g<8||f!==!1&&g>f)throw new TypeError(`invalid string length: ${g} (${h}). Expected (8..${f})`);let y=h.toLowerCase();if(h!==y&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");let p=y.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');let d=y.slice(0,p),m=y.slice(p+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");let v=co.decode(m).slice(0,-6),E=Wl(d,v,t);if(!m.endsWith(E))throw new Error(`Invalid checksum in ${h}: expected "${E}"`);return{prefix:d,words:v}}let c=Fl(a);function l(h){let{prefix:f,words:g}=a(h,!1);return{prefix:f,words:g,bytes:r(g)}}function u(h,f){return o(h,s(f))}return{encode:o,decode:a,encodeFromBytes:u,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:i,toWords:s}}var lo=Gl("bech32"),vv=Gl("bech32m");var xv=Tt(Mt(4),At("0123456789abcdef"),_t(""),zl(e=>{if(typeof e!="string"||e.length%2!==0)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}));var Bu=Q(Rt(),1);var Am=Q(Rt(),1),_m=Q(Rt(),1),zu=Q(Rt(),1),To=Q(Rt(),1),Im=Q(Rt(),1);var Fu=Q(jt(),1);var jm=Q(jt(),1),ju=Q(Rt(),1),Wu=Q(jt(),1),Gu=Q(jt(),1),Zu=Q(ro(),1);var Ku=Q(Rt(),1),ab=Q(gu(),1),rh=Q(Rt(),1),cb=Q(jt(),1);function ys(e,t,n="write"){if(!e.outboxTracker)return;let r=e.outboxTracker.data.get(t);if(!!r)return n==="write"?r.writeRelays:r.readRelays}async function py(e,t,n="write"){if(!!e.outboxTracker)return e.outboxTracker.data.has(t)||await e.outboxTracker.trackUsers([t]),ys(e,t,n)}function gy(e,t){let n=new Map;return t.forEach(s=>{let i=ys(e,s);i&&i.forEach(o=>{let a=n.get(o)||0;n.set(o,a+1)})}),Array.from(n.entries()).sort((s,i)=>i[1]-s[1]).map(s=>s[0])}function yy(e,t,n="read"){let r=new Map,s=new Set;return t.forEach(i=>{let o=ys(e,i,n);o&&o.size>0?(o.forEach(a=>{(r.get(a)||new Set).add(i)}),r.set(i,o)):s.add(i)}),{pubkeysToRelays:r,authorsMissingRelays:s}}function vu(e,t,n,{count:r,preferredRelays:s}={}){r??=2,s??=new Set;let i=e.pool,o=i.connectedRelays();o.forEach(f=>{s.add(f.url)});let a=new Map,{pubkeysToRelays:c,authorsMissingRelays:l}=yy(e,t,n),u=gy(e,t),h=(f,g)=>{let y=a.get(g)||[];y.push(f),a.set(g,y)};for(let[f,g]of c.entries()){let y=r;for(let p of o)g.has(p.url)&&(h(f,p.url),y--);for(let p of g)a.has(p)&&(h(f,p),y--);if(!(y<=0))for(let p of u){if(y<=0)break;g.has(p)&&(h(f,p),y--)}}for(let f of l)i.permanentAndConnectedRelays().forEach(g=>{let y=a.get(g.url)||[];y.push(f),a.set(g.url,y)});return a}function my(e,t,n=2){return vu(e,t,"write",{count:n})}function xu(e){try{return ee(e)}catch{return}}function ee(e){let t=ky(e.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}function Eu(e){let t=new Set;for(let n of e)try{t.add(ee(n))}catch{}return Array.from(t)}var by="text/plain",wy="us-ascii",go=(e,t)=>t.some(n=>n instanceof RegExp?n.test(e):n===e),vy=new Set(["https:","http:","file:"]),xy=e=>{try{let{protocol:t}=new URL(e);return t.endsWith(":")&&!t.includes(".")&&!vy.has(t)}catch{return!1}},Ey=(e,{stripHash:t})=>{let n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!n)throw new Error(`Invalid URL: ${e}`);let r=n.groups?.type??"",s=n.groups?.data??"",i=n.groups?.hash??"",o=r.split(";");i=t?"":i;let a=!1;o[o.length-1]==="base64"&&(o.pop(),a=!0);let c=o.shift()?.toLowerCase()??"",u=[...o.map(h=>{let[f,g=""]=h.split("=").map(y=>y.trim());return f==="charset"&&(g=g.toLowerCase(),g===wy)?"":`${f}${g?`=${g}`:""}`}).filter(Boolean)];return a&&u.push("base64"),(u.length>0||c&&c!==by)&&u.unshift(c),`data:${u.join(";")},${a?s.trim():s}${i?`#${i}`:""}`};function ky(e,t={}){if(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t},typeof t.defaultProtocol=="string"&&!t.defaultProtocol.endsWith(":")&&(t.defaultProtocol=`${t.defaultProtocol}:`),e=e.trim(),/^data:/i.test(e))return Ey(e,t);if(xy(e))return e;let n=e.startsWith("//");!n&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let s=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&s.protocol==="https:"&&(s.protocol="http:"),t.forceHttps&&s.protocol==="http:"&&(s.protocol="https:"),t.stripAuthentication&&(s.username="",s.password=""),t.stripHash?s.hash="":t.stripTextFragment&&(s.hash=s.hash.replace(/#?:~:text.*?$/i,"")),s.pathname){let o=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,c="";for(;;){let u=o.exec(s.pathname);if(!u)break;let h=u[0],f=u.index;c+=s.pathname.slice(a,f).replace(/\/{2,}/g,"/"),c+=h,a=f+h.length}c+=s.pathname.slice(a,s.pathname.length).replace(/\/{2,}/g,"/"),s.pathname=c}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let o=s.pathname.split("/"),a=o[o.length-1];go(a,t.removeDirectoryIndex)&&(o=o.slice(0,-1),s.pathname=o.slice(1).join("/")+"/")}if(s.hostname&&(s.hostname=s.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(s.hostname)&&(s.hostname=s.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let o of[...s.searchParams.keys()])go(o,t.removeQueryParameters)&&s.searchParams.delete(o);if(!Array.isArray(t.keepQueryParameters)&&t.removeQueryParameters===!0&&(s.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(let o of[...s.searchParams.keys()])go(o,t.keepQueryParameters)||s.searchParams.delete(o);if(t.sortQueryParameters){s.searchParams.sort();try{s.search=decodeURIComponent(s.search)}catch{}}t.removeTrailingSlash&&(s.pathname=s.pathname.replace(/\/$/,"")),t.removeExplicitPort&&s.port&&(s.port="");let i=e;return e=s.toString(),!t.removeSingleSlash&&s.pathname==="/"&&!i.endsWith("/")&&s.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||s.pathname==="/")&&s.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var Ty=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(e,t,n,r){super(e);this.errors=t,this.publishedToRelays=n,this.intendedRelaySet=r}get relayErrors(){let e=[];for(let[t,n]of this.errors)e.push(`${t.url}: ${n}`);return e.join(`
`)}},ne=class ku{relays;debug;ndk;pool;constructor(t,n,r){this.relays=t,this.ndk=n,this.pool=r??n.pool,this.debug=n.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map(t=>t.url)}static fromRelayUrls(t,n,r=!0,s){if(s=s??n.pool,!s)throw new Error("No pool provided");let i=new Set;for(let o of t){let a=s.relays.get(ee(o));if(a)a.status<5&&r&&a.connect(),i.add(a);else{let c=new Oe(ee(o),n?.relayAuthDefaultPolicy,n);s.useTemporaryRelay(c,void 0,"requested from fromRelayUrls "+t),i.add(c)}}return new ku(new Set(i),n,s)}async publish(t,n,r=1){let s=new Set,i=new Map,o=t.isEphemeral();t.publishStatus="pending";let a=Array.from(this.relays).map(c=>new Promise(l=>{c.publish(t,n).then(u=>{s.add(c),l()}).catch(u=>{o||i.set(c,u),l()})}));if(await Promise.all(a),s.size<r){if(!o){let c=new Ty("Not enough relays received the event",i,s,this);throw t.publishStatus="error",t.publishError=c,this.ndk.emit("event:publish-failed",t,c,this.relayUrls),c}}else t.emit("published",{relaySet:this,publishedToRelays:s});return s}get size(){return this.relays.size}},yo=(0,Tu.default)("ndk:outbox:calculate");async function Ay(e,t){let n=new Set,r=await py(e,t.pubkey);r&&r.forEach(o=>{let a=e.pool?.getRelay(o);a&&n.add(a)});let s=t.tags.filter(o=>["a","e"].includes(o[0])).map(o=>o[2]).filter(o=>o&&o.startsWith("wss://")).filter(o=>{try{return new URL(o),!0}catch{return!1}}).map(o=>ee(o));s=Array.from(new Set(s)).slice(0,5),s.forEach(o=>{let a=e.pool?.getRelay(o,!0,!0);a&&(yo("Adding relay hint %s",o),n.add(a))});let i=t.getMatchingTags("p").map(o=>o[1]);return i.length<5?Array.from(vu(e,i,"read",{preferredRelays:new Set(r)}).keys()).forEach(a=>{let c=e.pool?.getRelay(a,!1,!0);c&&(yo("Adding p-tagged relay %s",a),n.add(c))}):yo("Too many p-tags to consider %d",i.length),e.pool?.permanentAndConnectedRelays().forEach(o=>n.add(o)),new ne(n,e)}function _y(e,t,n){let r=new Map,s=new Set;if(t.forEach(i=>{i.authors&&i.authors.forEach(o=>s.add(o))}),s.size>0){let i=my(e,Array.from(s));for(let o of i.keys())r.set(o,[]);for(let o of t)if(o.authors)for(let[a,c]of i.entries()){let l=o.authors.filter(u=>c.includes(u));r.set(a,[...r.get(a),{...o,authors:l}])}else for(let a of i.keys())r.set(a,[...r.get(a),o])}else e.explicitRelayUrls&&e.explicitRelayUrls.forEach(i=>{r.set(i,t)});return r.size===0&&n.permanentAndConnectedRelays().slice(0,5).forEach(i=>{r.set(i.url,t)}),r}function mo(e,t,n){return _y(e,t,n)}function Sy(e,t){let n=new Map,r=o=>o.join(","),s=(o,a)=>o.every((c,l)=>c===a[l]),i=o=>{for(let[a,c]of n)if(s(c,o)||s(o,c)){o.length>=c.length&&n.set(a,o);return}n.set(r(o),o)};return e.concat(t).forEach(i),Array.from(n.values())}async function Ry(e,t=[]){let n=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,r=/(?<=\s|^)(#[^\s!@#$%^&*()=+./,[{\]};:'"?><]+)/g,s=[],i=o=>{t.find(a=>["q",o[0]].includes(a[0])&&a[1]===o[1])||t.push(o)};return e=e.replace(n,o=>{try{let a=o.split(/(@|nostr:)/)[2],{type:c,data:l}=ot.decode(a),u;switch(c){case"npub":u=["p",l];break;case"nprofile":u=["p",l.pubkey];break;case"note":s.push(new Promise(async h=>{i(["e",l,await bo(a),"mention"]),h()}));break;case"nevent":s.push(new Promise(async h=>{let{id:f,author:g}=l,{relays:y}=l;(!y||y.length===0)&&(y=[await bo(a)]),i(["e",f,y[0],"mention"]),g&&i(["p",g]),h()}));break;case"naddr":s.push(new Promise(async h=>{let f=[l.kind,l.pubkey,l.identifier].join(":"),g=l.relays??[];g.length===0&&(g=[await bo(a)]),i(["a",f,g[0],"mention"]),i(["p",l.pubkey]),h()}));break;default:return o}return u&&i(u),`nostr:${a}`}catch{return o}}),await Promise.all(s),e=e.replace(r,(o,a)=>{let c=["t",a.slice(1)];return t.find(l=>l[0]===c[0]&&l[1]===c[1])||t.push(c),o}),{content:e,tags:t}}async function bo(e){return""}function Cy(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function Iy(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function Ly(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var Bn=(e=>(e[e.Metadata=0]="Metadata",e[e.Text=1]="Text",e[e.RecommendRelay=2]="RecommendRelay",e[e.Contacts=3]="Contacts",e[e.EncryptedDirectMessage=4]="EncryptedDirectMessage",e[e.EventDeletion=5]="EventDeletion",e[e.Repost=6]="Repost",e[e.Reaction=7]="Reaction",e[e.BadgeAward=8]="BadgeAward",e[e.GroupChat=9]="GroupChat",e[e.GroupNote=11]="GroupNote",e[e.GroupReply=12]="GroupReply",e[e.Image=20]="Image",e[e.GenericRespose=22]="GenericRespose",e[e.GenericRepost=16]="GenericRepost",e[e.ChannelCreation=40]="ChannelCreation",e[e.ChannelMetadata=41]="ChannelMetadata",e[e.ChannelMessage=42]="ChannelMessage",e[e.ChannelHideMessage=43]="ChannelHideMessage",e[e.ChannelMuteUser=44]="ChannelMuteUser",e[e.GenericReply=1111]="GenericReply",e[e.Media=1063]="Media",e[e.Report=1984]="Report",e[e.Label=1985]="Label",e[e.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",e[e.DVMReqTextSummarization=5001]="DVMReqTextSummarization",e[e.DVMReqTextTranslation=5002]="DVMReqTextTranslation",e[e.DVMReqTextGeneration=5050]="DVMReqTextGeneration",e[e.DVMReqImageGeneration=5100]="DVMReqImageGeneration",e[e.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",e[e.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",e[e.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",e[e.DVMReqTimestamping=5900]="DVMReqTimestamping",e[e.DVMEventSchedule=5905]="DVMEventSchedule",e[e.DVMJobFeedback=7e3]="DVMJobFeedback",e[e.Subscribe=7001]="Subscribe",e[e.Unsubscribe=7002]="Unsubscribe",e[e.SubscriptionReceipt=7003]="SubscriptionReceipt",e[e.CashuReserve=7373]="CashuReserve",e[e.CashuQuote=7374]="CashuQuote",e[e.CashuToken=7375]="CashuToken",e[e.WalletChange=7376]="WalletChange",e[e.GroupAdminAddUser=9e3]="GroupAdminAddUser",e[e.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",e[e.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",e[e.GroupAdminEditStatus=9006]="GroupAdminEditStatus",e[e.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",e[e.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",e[e.MuteList=1e4]="MuteList",e[e.PinList=10001]="PinList",e[e.RelayList=10002]="RelayList",e[e.BookmarkList=10003]="BookmarkList",e[e.CommunityList=10004]="CommunityList",e[e.PublicChatList=10005]="PublicChatList",e[e.BlockRelayList=10006]="BlockRelayList",e[e.SearchRelayList=10007]="SearchRelayList",e[e.SimpleGroupList=10009]="SimpleGroupList",e[e.InterestList=10015]="InterestList",e[e.CashuMintList=10019]="CashuMintList",e[e.EmojiList=10030]="EmojiList",e[e.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",e[e.BlossomList=10063]="BlossomList",e[e.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",e[e.TierList=17e3]="TierList",e[e.FollowSet=3e4]="FollowSet",e[e.CategorizedPeopleList=3e4]="CategorizedPeopleList",e[e.CategorizedBookmarkList=30001]="CategorizedBookmarkList",e[e.RelaySet=30002]="RelaySet",e[e.CategorizedRelayList=30002]="CategorizedRelayList",e[e.BookmarkSet=30003]="BookmarkSet",e[e.CurationSet=30004]="CurationSet",e[e.ArticleCurationSet=30004]="ArticleCurationSet",e[e.VideoCurationSet=30005]="VideoCurationSet",e[e.ImageCurationSet=30006]="ImageCurationSet",e[e.InterestSet=30015]="InterestSet",e[e.InterestsList=30015]="InterestsList",e[e.EmojiSet=30030]="EmojiSet",e[e.ModularArticle=30040]="ModularArticle",e[e.ModularArticleItem=30041]="ModularArticleItem",e[e.Wiki=30818]="Wiki",e[e.Draft=31234]="Draft",e[e.SubscriptionTier=37001]="SubscriptionTier",e[e.EcashMintRecommendation=38e3]="EcashMintRecommendation",e[e.HighlightSet=39802]="HighlightSet",e[e.CategorizedHighlightList=39802]="CategorizedHighlightList",e[e.Nutzap=9321]="Nutzap",e[e.ZapRequest=9734]="ZapRequest",e[e.Zap=9735]="Zap",e[e.Highlight=9802]="Highlight",e[e.ClientAuth=22242]="ClientAuth",e[e.NostrWalletConnectReq=23194]="NostrWalletConnectReq",e[e.NostrWalletConnectRes=23195]="NostrWalletConnectRes",e[e.NostrConnect=24133]="NostrConnect",e[e.BlossomUpload=24242]="BlossomUpload",e[e.HttpAuth=27235]="HttpAuth",e[e.ProfileBadge=30008]="ProfileBadge",e[e.BadgeDefinition=30009]="BadgeDefinition",e[e.MarketStall=30017]="MarketStall",e[e.MarketProduct=30018]="MarketProduct",e[e.Article=30023]="Article",e[e.AppSpecificData=30078]="AppSpecificData",e[e.Classified=30402]="Classified",e[e.HorizontalVideo=34235]="HorizontalVideo",e[e.VerticalVideo=34236]="VerticalVideo",e[e.CashuWallet=37375]="CashuWallet",e[e.GroupMetadata=39e3]="GroupMetadata",e[e.GroupAdmins=39001]="GroupAdmins",e[e.GroupMembers=39002]="GroupMembers",e[e.AppRecommendation=31989]="AppRecommendation",e[e.AppHandler=31990]="AppHandler",e))(Bn||{});var wo="nip44";async function By(e,t,n=wo){if(!this.ndk)throw new Error("No NDK instance found!");if(t||(await this.ndk.assertSigner(),t=this.ndk.signer),!e){let r=this.getMatchingTags("p");if(r.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");e=this.ndk.getUser({pubkey:r[0][1]})}this.content=await t?.encrypt(e,this.content,n)}async function Uy(e,t,n){if(!this.ndk)throw new Error("No NDK instance found!");t||(await this.ndk.assertSigner(),t=this.ndk.signer),e||(e=this.author),n||(n=this.content.match(/\?iv=/)?"nip04":"nip44"),this.content=await t?.decrypt(e,this.content,n)}var Py=2;function My(e=Py){let t=[];return this.onRelays.length>0?t=this.onRelays.map(n=>n.url):this.relay&&(t=[this.relay.url]),t.length>e&&(t=t.slice(0,e)),this.isParamReplaceable()?ot.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?ot.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):ot.noteEncode(this.tagId())}async function Ny(e=!0,t){if(!t&&e){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}let n=new J(this.ndk,{kind:Oy(this)});return n.content=JSON.stringify(this.rawEvent()),n.tag(this),this.kind!==1&&n.tags.push(["k",`${this.kind}`]),t&&await n.sign(t),e&&await n.publish(),n}function Oy(e){return e.kind===1?6:16}function Au(e){return e.getMatchingTags("e").some(t=>t[3])}function $y(e,t){t??=e.tagType();let n=e.tags.find(r=>r[3]==="root");if(!n){if(Au(e))return;let r=e.getMatchingTags(t);if(r.length<3)return r[0]}return n}function Hy(e,t){t??=e.tagType();let n=e.tags.find(r=>r[3]==="reply");if(n)return n;if(n||(n=e.tags.find(r=>r[3]==="root")),!n){if(Au(e))return;let r=e.getMatchingTags(t);if(r.length===1)return r[0];if(r.length===2)return r[1]}}async function qy(e,t){if(!this.ndk)throw new Error("NDK instance not found");let n=this.getMatchingTags(e,t);if(n.length===0)return;let[r,s,i]=n[0],o;return await this.ndk.fetchEvent(s,{},o)}async function zy(e){if(!this.ndk)throw new Error("NDK instance not found");let t=$y(this);if(!!t)return this.ndk.fetchEventFromTag(t,this,e)}async function Vy(e){if(!this.ndk)throw new Error("NDK instance not found");let t=Hy(this);if(!!t)return this.ndk.fetchEventFromTag(t,this,e)}function Dy(e=!1,t=!1){let n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return e&&n.push(this.sig),t&&n.push(this.id),JSON.stringify(n)}function Fy(e){let t=JSON.parse(e),n={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};return t.length>=7&&(n.sig=t[6]),t.length>=8&&(n.id=t[7]),n}var vo,sr={};function jy(e){vo=e,vo.onmessage=t=>{let[n,r]=t.data,s=sr[n];if(!s){console.error("No record found for event",n);return}delete sr[n];for(let i of s.resolves)i(r)}}async function Wy(e,t){return new Promise(r=>{let s=e.serialize(),i=!1;sr[e.id]||(sr[e.id]={event:e,resolves:[]},i=!0),sr[e.id].resolves.push(r),!!i&&vo.postMessage({serialized:s,id:e.id,sig:e.sig,pubkey:e.pubkey})})}var Gy=/^[a-f0-9]{64}$/;function Zy(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(Gy)||!Array.isArray(this.tags))return!1;for(let e=0;e<this.tags.length;e++){let t=this.tags[e];if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(typeof t[n]=="object")return!1}return!0}var Un=new _u.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function Yy(e){if(typeof this.signatureVerified=="boolean")return this.signatureVerified;let t=Un.get(this.id);if(t!==null)return this.signatureVerified=!!t;try{if(this.ndk?.asyncSigVerification)Wy(this,e).then(n=>{e&&(this.signatureVerified=n,n&&Un.set(this.id,this.sig)),n||(this.ndk.emit("event:invalid-sig",this),Un.set(this.id,!1))});else{let n=Qe(new TextEncoder().encode(this.serialize())),r=Pl.verify(this.sig,n,this.pubkey);return r?Un.set(this.id,this.sig):Un.set(this.id,!1),this.signatureVerified=r}}catch{return this.signatureVerified=!1}}function Jy(){return Qy(this.serialize())}function Qy(e){let t=Qe(new TextEncoder().encode(e));return Wr(t)}var Xy=[3],J=class sn extends wu.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(t,n){super();this.ndk=t,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof sn&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(t,n){return new sn(t,Fy(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");let t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,n,r){let s=["i"],i=["k"];switch(n){case"url":let o=new URL(t);o.hash="",s.push(o.toString()),i.push(`${o.protocol}//${o.host}`);break;case"hashtag":s.push(`#${t.toLowerCase()}`),i.push("#");break;case"geohash":s.push(`geo:${t.toLowerCase()}`),i.push("geo");break;case"isbn":s.push(`isbn:${t.replace(/-/g,"")}`),i.push("isbn");break;case"podcast:guid":s.push(`podcast:guid:${t}`),i.push("podcast:guid");break;case"podcast:item:guid":s.push(`podcast:item:guid:${t}`),i.push("podcast:item:guid");break;case"podcast:publisher:guid":s.push(`podcast:publisher:guid:${t}`),i.push("podcast:publisher:guid");break;case"isan":s.push(`isan:${t.split("-").slice(0,4).join("-")}`),i.push("isan");break;case"doi":s.push(`doi:${t.toLowerCase()}`),i.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${n}`)}r&&s.push(r),this.tags.push(s),this.tags.push(i)}tag(t,n,r,s){let i=[];if(t.fetchProfile!==void 0){s??="p";let a=[s,t.pubkey];n&&a.push("",n),i.push(a)}else if(t instanceof sn){let a=t;r??=a?.pubkey===this.pubkey,i=a.referenceTags(n,r,s);for(let c of a.getMatchingTags("p"))c[1]!==this.pubkey&&(this.tags.find(l=>l[0]==="p"&&l[1]===c[1])||this.tags.push(["p",c[1]]))}else if(Array.isArray(t))i=[t];else throw new Error("Invalid argument",t);this.tags=Sy(this.tags,i)}async toNostrEvent(t){if(!t&&this.pubkey===""){let s=await this.ndk?.signer?.user();this.pubkey=s?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));let{content:n,tags:r}=await this.generateTags();this.content=n||"",this.tags=r;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}serialize=Dy.bind(this);getEventHash=Jy.bind(this);validate=Zy.bind(this);verifySignature=Yy.bind(this);isReplaceable=Cy.bind(this);isEphemeral=Iy.bind(this);isParamReplaceable=Ly.bind(this);encode=My.bind(this);encrypt=By.bind(this);decrypt=Uy.bind(this);getMatchingTags(t,n){let r=this.tags.filter(s=>s[0]===t);return n===void 0?r:r.filter(s=>s[3]===n)}hasTag(t,n){return this.tags.some(r=>r[0]===t&&(!n||r[3]===n))}tagValue(t){let n=this.getMatchingTags(t);if(n.length!==0)return n[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t){let n=Array.isArray(t)?t:[t];this.tags=this.tags.filter(r=>!n.includes(r[0]))}async sign(t){t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk.signer);let n=await this.toNostrEvent();return this.sig=await t.sign(n),this.sig}async publishReplaceable(t,n,r){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,n,r)}async publish(t,n,r){if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if(t||(t=this.ndk.devWriteRelaySet||await Ay(this.ndk,this)),this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds){let o=this.getMatchingTags("e").map(a=>a[1]);this.ndk.cacheAdapter.deleteEventIds(o)}let s=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent)try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(o){console.error("Error adding unpublished event to cache",o)}this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(o=>o[1])),this.ndk.subManager.dispatchEvent(s,void 0,!0);let i=await t.publish(this,n,r);return i.forEach(o=>this.ndk?.subManager.seenEvent(this.id,o)),i}async generateTags(){let t=[],n=await Ry(this.content,this.tags),r=n.content;if(t=n.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){let i=this.tagValue("title"),a=[...Array(i?6:16)].map(()=>Math.random().toString(36)[2]).join("");i&&i.length>0&&(a=i.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+a),t.push(["d",a])}if(this.shouldAddClientTag){let s=["client",this.ndk.clientName??""];this.ndk.clientNip89&&s.push(this.ndk.clientNip89),t.push(s)}else t=t.filter(s=>s[0]!=="client");return{content:r||"",tags:t}}get shouldAddClientTag(){return!(!this.ndk?.clientName&&!this.ndk?.clientNip89||Xy.includes(this.kind)||this.isEphemeral()||this.hasTag("client"))}muted(){let t=this.ndk?.mutedIds.get(this.pubkey);if(t&&t==="p")return"author";let n=this.tagReference(),r=this.ndk?.mutedIds.get(n[1]);return r&&r===n[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){let t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");let t=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${t}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let n;return this.isParamReplaceable()?n=["a",this.tagAddress()]:n=["e",this.tagId()],this.relay?n.push(this.relay.url):n.push(""),n.push(t??""),this.isParamReplaceable()||n.push(this.pubkey),n}referenceTags(t,n,r){let s=[];return this.isParamReplaceable()?s=[[r??"a",this.tagAddress()],[r??"e",this.id]]:s=[[r??"e",this.id]],s=s.map(i=>(i[0]==="e"||t?i.push(this.relay?.url??""):this.relay?.url&&i.push(this.relay?.url),i)),s.forEach(i=>{i[0]==="e"?(i.push(t??""),i.push(this.pubkey)):t&&i.push(t)}),s=[...s,...this.getMatchingTags("h")],n||s.push(...this.author.referenceTags()),s}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async delete(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();let r=new sn(this.ndk,{kind:5,content:t||""});return r.tag(this,void 0,!0),r.tags.push(["k",this.kind.toString()]),n&&(this.emit("deleted"),await r.publish()),r}fetchTaggedEvent=qy.bind(this);fetchRootEvent=zy.bind(this);fetchReplyEvent=Vy.bind(this);repost=Ny.bind(this);async react(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();let r=new sn(this.ndk,{kind:7,content:t});return r.tag(this),n?await r.publish():await r.sign(),r}get isValid(){return this.validate()}reply(){let t=new sn(this.ndk);if(this.kind===1)t.kind=1,this.hasTag("e")?t.tags=[...t.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply")]:t.tag(this,"root");else{t.kind=1111;let n=["A","E","I","P"],r=this.tags.filter(s=>n.includes(s[0]));if(r.length>0){let s=this.tagValue("K");t.tags.push(...r),s&&t.tags.push(["K",s]);let[i,o,a,...c]=this.tagReference(),l=[i,o,...c];t.tags.push(l)}else{let[s,i,o,a]=this.tagReference(),c=[s,i,a??""];s==="e"&&c.push(this.pubkey),t.tags.push(c);let l=[...c];l[0]=l[0].toUpperCase(),t.tags.push(l),t.tags.push(["K",this.kind.toString()]),t.tags.push(["P",this.pubkey])}t.tags.push(["k",this.kind.toString()]),t.tags.push(...this.getMatchingTags("p")),t.tags.push(["p",this.pubkey])}return t}},Ky=5,tm=1e3,em=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;serial=0;baseEoseTimeout=4400;constructor(e,t){this.ndkRelay=e,this._status=1;let n=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend("connectivity"+n),this.ndk=t}async connect(e,t=!0){if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),e??=this.timeoutMs,!this.timeoutMs&&e&&(this.timeoutMs=e),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(t),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(n){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,n),this._status=1,t?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),n}}disconnect(){this._status=0;try{this.ws?.close()}catch(e){this.debug("Failed to disconnect",e),this._status=1}}onConnectionError(e){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),e&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(e){this.netDebug?.(e.data,this.ndkRelay,"recv");try{let t=JSON.parse(e.data),[n,r,...s]=t;switch(n){case"EVENT":{let i=this.openSubs.get(r),o=t[2];if(!i){this.debug(`Received event for unknown subscription ${r}`);return}i.onevent(o);return}case"COUNT":{let i=t[2],o=this.openCountRequests.get(r);o&&(o.resolve(i.count),this.openCountRequests.delete(r));return}case"EOSE":{let i=this.openSubs.get(r);if(!i)return;i.oneose(r);return}case"OK":{let i=t[2],o=t[3],a=this.openEventPublishes.get(r),c=a?.pop();if(!a||!c){this.debug("Received OK for unknown event publish",r);return}i?c.resolve(o):c.reject(new Error(o)),a.length===0?this.openEventPublishes.delete(r):this.openEventPublishes.set(r,a);return}case"CLOSED":{let i=this.openSubs.get(r);if(!i)return;i.onclosed(t[2]);return}case"NOTICE":this.onNotice(t[1]);return;case"AUTH":{this.onAuthRequested(t[1]);return}}}catch(t){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t?.stack);return}}async onAuthRequested(e){let t=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!t}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,t){if(this._status>=5){this._status=7;let n;try{n=await t(this.ndkRelay,e)}catch(r){this.debug("Authentication policy threw an error",r),n=!1}if(this.debug("Authentication policy returned",!!n),n instanceof J||n===!0){n instanceof J&&await this.auth(n);let r=async()=>{if(this._status>=5&&this._status<8){let s=new J(this.ndk);s.kind=22242,s.tags=[["relay",this.ndkRelay.url],["challenge",e]],await s.sign(),this.auth(s).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(i=>{this._status=6,this.ndkRelay.emit("auth:failed",i),this.debug("Authentication failed",i)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};n===!0&&(this.ndk?.signer?r().catch(s=>{console.error("Error authenticating",s)}):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",r))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",e)}onError(e){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,e)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){let e=this._connectionStats.durations;if(e.length%3!==0)return!1;let n=e.reduce((o,a)=>o+a,0)/e.length,r=e.map(o=>Math.pow(o-n,2)).reduce((o,a)=>o+a,0)/e.length;return Math.sqrt(r)<tm}async onNotice(e){this.ndkRelay.emit("notice",e)}handleReconnection(e=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let t=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(n=>{e<Ky?setTimeout(()=>{this.handleReconnection(e+1)},1e3*(e+1)^4):this.debug("Reconnect failed")})},t),this.ndkRelay.emit("delayed-connect",t),this.debug("Reconnecting in",t),this._connectionStats.nextReconnectAt=Date.now()+t}async send(e){this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(e),this.netDebug?.(e,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${e}`,this._status)}async auth(e){let t=new Promise((n,r)=>{let s=this.openEventPublishes.get(e.id)??[];s.push({resolve:n,reject:r}),this.openEventPublishes.set(e.id,s)});return this.send('["AUTH",'+JSON.stringify(e.rawEvent())+"]"),t}async publish(e){let t=new Promise((n,r)=>{let s=this.openEventPublishes.get(e.id)??[];s.length>0&&console.warn("Duplicate event publishing detected, you are publishing event "+e.id+" twice"),s.push({resolve:n,reject:r}),this.openEventPublishes.set(e.id,s)});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let n=t?.id||"count:"+this.serial,r=new Promise((s,i)=>{this.openCountRequests.set(n,{resolve:s,reject:i})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}close(e,t){this.send('["CLOSE","'+e+'"]');let n=this.openSubs.get(e);this.openSubs.delete(e),n&&n.onclose(t)}req(e){this.send('["REQ","'+e.subId+'",'+JSON.stringify(e.executeFilters).substring(1))+"",this.openSubs.set(e.subId,e)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}},nm=class{ndkRelay;debug;constructor(e){this.ndkRelay=e,this.debug=e.debug.extend("publisher")}async publish(e,t=2500){let n,r=()=>new Promise((u,h)=>{try{this.publishEvent(e).then(f=>{this.ndkRelay.emit("published",e),e.emit("relay:published",this.ndkRelay),u(!0)}).catch(h)}catch(f){h(f)}}),s=new Promise((u,h)=>{n=setTimeout(()=>{n=void 0,h(new Error("Timeout: "+t+"ms"))},t)}),i=()=>{r().then(u=>o(u)).catch(u=>a(u))},o,a,c=u=>{throw this.ndkRelay.debug("Publish failed",u,e.id),this.ndkRelay.emit("publish:failed",e,u),e.emit("relay:publish:failed",this.ndkRelay,u),u},l=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",i)};return this.ndkRelay.status>=5?Promise.race([r(),s]).catch(c).finally(l):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((u,h)=>{o=u,a=h,this.ndkRelay.once("connect",i)}),s]).catch(c).finally(l))}async publishEvent(e){return this.ndkRelay.connectivity.publish(e.rawEvent())}};function rm(e,t){let n=[];for(let s of e){let i=Object.entries(s||{}).map(([o,a])=>["since","until"].includes(o)?o+":"+a:o).sort().join("-");n.push(i)}let r=t?"+":"";return r+=n.join("|"),r}function sm(e){let t=[],n={};return e.filter(r=>!!r.limit).forEach(r=>t.push(r)),e=e.filter(r=>!r.limit),e.length===0?t:(e.forEach(r=>{Object.entries(r).forEach(([s,i])=>{Array.isArray(i)?n[s]===void 0?n[s]=[...i]:n[s]=Array.from(new Set([...n[s],...i])):n[s]=i})}),[...t,n])}var im=class{fingerprint;items=new Map;topSubManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(e,t,n){this.relay=e,this.topSubManager=n,this.debug=e.debug.extend("subscription-"+this.id),this.fingerprint=t||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}subIdParts=new Set;addSubIdPart(e){this.subIdParts.add(e)}addItem(e,t){if(this.debug("Adding item",{filters:t,internalId:e.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,items:this.items,itemsSize:this.items.size}),!this.items.has(e.internalId))switch(e.on("close",this.removeItem.bind(this,e)),this.items.set(e.internalId,{subscription:e,filters:t}),this.status!==3&&e.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(e.subId),this.status){case 0:this.evaluateExecutionPlan(e);break;case 3:console.log("BUG: This should not happen: This subscription needs to catch up with a subscription that was already running",t);break;case 1:this.evaluateExecutionPlan(e);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",e,t),new Error("Cannot add new items to a closed subscription")}}removeItem(e){if(this.items.delete(e.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;let e=this.status;if(this.status=4,e===3)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:e,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(e){if(!e.isGroupable()){this.status=1,this.execute();return}if(e.filters.find(r=>!!r.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}let t=e.groupableDelay,n=e.groupableDelayType;if(!t)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(t,n);else{let r=this.delayType,s=this.fireTime-Date.now();if(r==="at-least"&&n==="at-least")s<t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(r==="at-least"&&n==="at-most")s>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(r==="at-most"&&n==="at-most")s>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(r==="at-most"&&n==="at-least")s>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else throw new Error("Unknown delay type combination "+r+" "+n)}}schedule(e,t){this.status=1;let n=Date.now();this.fireTime=n+e,this.delayType=t;let r=setTimeout(this.execute.bind(this),e);t==="at-least"&&(this.executionTimer=r)}executeOnRelayReady=()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.status=1,this.execute()}};finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+="-"+Math.random().toString(36).substring(2,7)}reExecuteAfterAuth=(()=>{let e=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:e}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s \u{1F449} %s",e,this.subId)}).bind(this);execute(){if(this.status===1){if(this.relay.connected)this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth);else{this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(e){this.topSubManager.dispatchEvent(e,this.relay)}oneose(e){if(this.eosed=!0,e!==this.subId){this.debug("Received EOSE for an abandoned subscription",e,this.subId),this.relay.close(e);return}this.items.size===0&&this.close();for(let{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:t.filters,internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.removeItem(t))}onclose(e){this.status=4}onclosed(e){if(!!e)for(let{subscription:t}of this.items.values())t.closedReceived(this.relay,e)}compileFilters(){let e=[],t=Array.from(this.items.values()).map(r=>r.filters);if(!t[0])return this.debug("\u{1F440} No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];let n=t[0].length;for(let r=0;r<n;r++){let s=t.map(i=>i[r]);e.push(...sm(s))}return e}},om=class{relay;subscriptions;generalSubManager;constructor(e,t){this.relay=e,this.subscriptions=new Map,this.generalSubManager=t}addSubscription(e,t){let n;if(!e.isGroupable())n=this.createSubscription(e,t);else{let r=rm(t,e.closeOnEose);r&&(n=(this.subscriptions.get(r)||[]).find(i=>i.status<3)),n??=this.createSubscription(e,t,r)}n.addItem(e,t)}createSubscription(e,t,n){let r=new im(this.relay,n||null,this.generalSubManager);r.onClose=this.onRelaySubscriptionClose.bind(this);let s=this.subscriptions.get(r.fingerprint)??[];return this.subscriptions.set(r.fingerprint,[...s,r]),r}onRelaySubscriptionClose(e){let t=this.subscriptions.get(e.fingerprint)??[];t?t.length===1?this.subscriptions.delete(e.fingerprint):(t=t.filter(n=>n.id!==e.id),this.subscriptions.set(e.fingerprint,t)):console.warn("Unexpectedly did not find a subscription with fingerprint",e.fingerprint)}};var Pn,Oe=(Pn=class extends bu.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;constructor(t,n,r){super();this.url=ee(t),this.scores=new Map,this.debug=(0,mu.default)(`ndk:relay:${t}`),this.connectivity=new em(this,r),this.connectivity.netDebug=r?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new om(this,r.subManager),this.publisher=new nm(this),this.authPolicy=n,this.targetValidationRatio=r?.initialValidationRatio,this.lowestValidationRatio=r?.lowestValidationRatio,this.validationRatioFn=(r?.validationRatioFn??Pn.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),r||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,n=!0){return this.connectivity.connect(t,n)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(t,n){this.subs.addSubscription(t,n)}async publish(t,n=2500){return this.publisher.publish(t,n)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0?!0:this.validationRatio<this.targetValidationRatio}get connected(){return this.connectivity.connected}req;close},et(Pn,"defaultValidationRatioUpdateFn",(t,n,r)=>{if(t.lowestValidationRatio===void 0||t.targetValidationRatio===void 0)return 1;let s=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){let i=n/100;s=Math.max(t.lowestValidationRatio,t.validationRatio-i)}return s<t.validationRatio?s:t.validationRatio}),Pn),xo=class extends yu.EventEmitter{_relays=new Map;autoConnectRelays=new Set;blacklistRelayUrls;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;constructor(e=[],t=[],n,r){super();this.debug=r??n.debug.extend("pool"),this.ndk=n,this.relayUrls=e,this.blacklistRelayUrls=new Set(t)}get relays(){return this._relays}set relayUrls(e){this._relays.clear();for(let t of e){let n=new Oe(t,void 0,this.ndk);n.connectivity.netDebug=this.ndk.netDebug,this.addRelay(n,!1)}}set name(e){this.debug=this.debug.extend(e)}useTemporaryRelay(e,t=3e4,n){let r=this.relays.has(e.url);r||(this.addRelay(e),this.debug("Adding temporary relay %s for filters %o",e.url,n));let s=this.temporaryRelayTimers.get(e.url);if(s&&clearTimeout(s),!r||s){let i=setTimeout(()=>{this.ndk.explicitRelayUrls?.includes(e.url)||this.removeRelay(e.url)},t);this.temporaryRelayTimers.set(e.url,i)}}addRelay(e,t=!0){let n=this.relays.has(e.url),r=this.blacklistRelayUrls?.has(e.url),s=e.url.includes("/npub1"),i=!0,o=e.url;if(n)return;if(r){this.debug(`Refusing to add relay ${o}: blacklisted`);return}if(s){this.debug(`Refusing to add relay ${o}: is a filter relay`);return}if(this.ndk.cacheAdapter?.getRelayStatus){let y=this.ndk.cacheAdapter.getRelayStatus(o);if(y&&y.dontConnectBefore)if(y.dontConnectBefore>Date.now()){let p=y.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${o}: delayed connect for ${p}ms`),setTimeout(()=>{this.addRelay(e,t)},p);return}else i=!1}let a=y=>this.emit("notice",e,y),c=()=>this.handleRelayConnect(o),l=()=>this.handleRelayReady(e),u=()=>this.emit("relay:disconnect",e),h=()=>this.handleFlapping(e),f=y=>this.emit("relay:auth",e,y),g=()=>this.emit("relay:authed",e);e.off("notice",a),e.off("connect",c),e.off("ready",l),e.off("disconnect",u),e.off("flapping",h),e.off("auth",f),e.off("authed",g),e.on("notice",a),e.on("connect",c),e.on("ready",l),e.on("disconnect",u),e.on("flapping",h),e.on("auth",f),e.on("authed",g),e.on("delayed-connect",y=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(e.url,{dontConnectBefore:Date.now()+y})}),this.relays.set(o,e),t&&this.autoConnectRelays.add(o),t&&(this.emit("relay:connecting",e),e.connect(void 0,i).catch(y=>{this.debug(`Failed to connect to relay ${o}`,y)}))}removeRelay(e){let t=this.relays.get(e);if(t)return t.disconnect(),this.relays.delete(e),this.autoConnectRelays.delete(e),this.emit("relay:disconnect",t),!0;let n=this.temporaryRelayTimers.get(e);return n&&(clearTimeout(n),this.temporaryRelayTimers.delete(e)),!1}isRelayConnected(e){let t=ee(e),n=this.relays.get(t);return n?n.status===5:!1}getRelay(e,t=!0,n=!1,r){let s=this.relays.get(ee(e));return s||(s=new Oe(e,void 0,this.ndk),s.connectivity.netDebug=this.ndk.netDebug,n?this.useTemporaryRelay(s,3e4,r):this.addRelay(s,t)),s}handleRelayConnect(e){let t=this.relays.get(e);if(!t){console.error("NDK BUG: relay not found in pool",{relayUrl:e});return}this.emit("relay:connect",t),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(e){this.emit("relay:ready",e)}async connect(e){let t=[];this.debug(`Connecting to ${this.relays.size} relays${e?`, timeout ${e}...`:""}`);let n=new Set(this.autoConnectRelays.keys());this.ndk.explicitRelayUrls?.forEach(r=>{let s=ee(r);n.add(s)});for(let r of n){let s=this.relays.get(r);if(!s)continue;let i=new Promise((o,a)=>(this.emit("relay:connecting",s),s.connect(e).then(o).catch(a)));if(e){let o=new Promise((a,c)=>{setTimeout(()=>c(`Timed out after ${e}ms`),e)});t.push(Promise.race([i,o]).catch(a=>{this.debug(`Failed to connect to relay ${s.url}: ${a??"No reason specified"}`)}))}else t.push(i)}e&&setTimeout(()=>{let r=this.stats().connected===this.relays.size,s=this.stats().connected>0;!r&&s&&this.emit("connect")},e),await Promise.all(t)}checkOnFlappingRelays(){let e=this.flappingRelays.size,t=this.relays.size;if(e/t>=.8)for(let n of this.flappingRelays)this.backoffTimes.set(n,0)}handleFlapping(e){this.debug(`Relay ${e.url} is flapping`);let t=this.backoffTimes.get(e.url)||5e3;t=t*2,this.backoffTimes.set(e.url,t),this.debug(`Backoff time for ${e.url} is ${t}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${e.url}`),this.emit("relay:connecting",e),e.connect(),this.checkOnFlappingRelays()},t),e.disconnect(),this.emit("flapping",e)}size(){return this.relays.size}stats(){let e={total:0,connected:0,disconnected:0,connecting:0};for(let t of this.relays.values())e.total++,t.status===5?e.connected++:t.status===1?e.disconnected++:t.status===4&&e.connecting++;return e}connectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5&&!this.temporaryRelayTimers.has(e.url))}urls(){return Array.from(this.relays.keys())}};function Ru(e){return!!(am(e.filter)&&cm(e))}function am(e){return!!e.ids}function cm(e){let t=e.filter.ids;return!!t&&t.length===e.eventFirstSeen.size}function lm(e){let t;if(e.match(Cu)){let[n,r,s]=e.split(":"),i={authors:[r],kinds:[parseInt(n)]};return s&&(i["#d"]=[s]),i}if(e.match(hm))try{switch(t=ot.decode(e),t.type){case"nevent":{let r={ids:[t.data.id]};return t.data.author&&(r.authors=[t.data.author]),t.data.kind&&(r.kinds=[t.data.kind]),r}case"note":return{ids:[t.data]};case"naddr":let n={authors:[t.data.pubkey],kinds:[t.data.kind]};return t.data.identifier&&(n["#d"]=[t.data.identifier]),n}}catch(n){console.error("Error decoding",e,n)}return{ids:[e]}}function um(e){return e.match(Cu)!==null}var Cu=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,hm=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function fm(e,t){try{let n=ot.decode(e);if(["naddr","nevent"].includes(n?.type)){let r=n.data;if(r?.relays)return r.relays.map(s=>new Oe(s,t.relayAuthDefaultPolicy,t))}}catch{}return[]}var dm={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},pm=class extends Su.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;internalId;closeOnEose;poolMonitor;skipOptimisticPublishEvent=!1;constructor(e,t,n,r,s){super();if(this.ndk=e,this.pool=n?.pool||e.pool,this.opts={...dm,...n||{}},this.filters=t instanceof Array?t:[t],this.subId=s||n?.subId,this.internalId=Math.random().toString(36).substring(7),this.relaySet=r,this.debug=e.debug.extend(`subscription[${n?.subId??this.internalId}]`),this.skipVerification=n?.skipVerification||!1,this.skipValidation=n?.skipValidation||!1,this.closeOnEose=n?.closeOnEose||!1,this.skipOptimisticPublishEvent=n?.skipOptimisticPublishEvent||!1,this.opts.cacheUsage==="ONLY_CACHE"&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters.keys()).filter(t=>!this.eosesSeen.has(this.pool.getRelay(t,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){if(!!this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return this.opts?.cacheUsage!=="ONLY_RELAY"}shouldQueryRelays(){return this.opts?.cacheUsage!=="ONLY_CACHE"}shouldWaitForCache(){return this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&this.opts.cacheUsage!=="PARALLEL"}async start(){let e;if(this.shouldQueryCache()&&(e=this.startWithCache(),this.shouldWaitForCache()&&(await e,Ru(this)))){this.emit("eose",this);return}this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)}startPoolMonitor(){let e=this.debug.extend("pool-monitor");this.poolMonitor=t=>{if(this.relayFilters?.has(t.url))return;mo(this.ndk,this.filters,this.pool).get(t.url)&&(this.relayFilters?.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}onStopped;stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.removeAllListeners(),this.onStopped?.()}hasAuthorsFilter(){return this.filters.some(e=>e.authors?.length)}async startWithCache(){if(this.ndk.cacheAdapter?.query){let e=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await e}}startWithRelays(){if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=mo(this.ndk,this.filters,this.pool);else{this.relayFilters=new Map;for(let e of this.relaySet.relays)this.relayFilters.set(e.url,this.filters)}if(!(!this.relayFilters||this.relayFilters.size===0))for(let[e,t]of this.relayFilters)this.pool.getRelay(e,!0,!0,t).subscribe(this,t)}eventReceived(e,t,n=!1,r=!1){let s=e.id,i=this.eventFirstSeen.has(s),o;if(e instanceof J&&(o=e),i){let a=Date.now()-(this.eventFirstSeen.get(s)||0);if(this.emit("event:dup",s,t,a,this),t){let c=Un.get(s);c&&typeof c=="string"&&e.sig===c&&t.addValidatedEvent()}}else{if(o??=new J(this.ndk,e),o.ndk=this.ndk,o.relay=t,!n&&!r){if(!this.skipValidation&&!o.isValid){this.debug("Event failed validation %s from relay %s",s,t?.url);return}if(t)if(t?.shouldValidateEvent()!==!1){if(!this.skipVerification)if(!o.verifySignature(!0)&&!this.ndk.asyncSigVerification){this.debug("Event failed signature validation",e);return}else t&&t.addValidatedEvent()}else t.addNonValidatedEvent();this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(o,this.filters,t)}!n&&t&&this.ndk.emit("event",o,t),(!r||this.skipOptimisticPublishEvent!==!0)&&(this.emit("event",o,t,this),this.eventFirstSeen.set(s,Date.now()))}this.lastEventReceivedAt=Date.now()}closedReceived(e,t){this.emit("closed",e,t)}eoseTimeout;eosed=!1;eoseReceived(e){this.debug("EOSE received from %s",e.url),this.eosesSeen.add(e);let t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,n=this.eosesSeen.size===this.relayFilters?.size,r=Ru(this),s=i=>{this.debug("Performing EOSE: %s %d",i,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0)};if(r||n)s("query filled or seen all");else if(this.relayFilters){let i=1e3,o=new Set(this.pool.connectedRelays().map(l=>l.url)),a=Array.from(this.relayFilters.keys()).filter(l=>o.has(l));if(a.length===0)return;let c=this.eosesSeen.size/a.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:c,seen:this.eosesSeen.size,total:a.length}),this.eosesSeen.size>=2&&c>=.5){if(i=i*(1-c),i===0){s("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);let l=()=>{t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,t!==void 0&&t<20?this.eoseTimeout=setTimeout(l,i):s("send eose timeout: "+i)};this.eoseTimeout=setTimeout(l,i)}}}};async function gm(e,t,n=3){if(!this.ndk)throw new Error("NDK not set");let r=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},e||{groupable:!1});if(r){let s=new Set;return r.tags.forEach(i=>{i[0]==="p"&&s.add(i[1])}),t&&this.ndk?.outboxTracker?.trackUsers(Array.from(s)),[...s].reduce((i,o)=>{let a=new bt({pubkey:o});return a.ndk=this.ndk,i.add(a),i},new Set)}return new Set}function Iu(e){let t={},n;try{n=JSON.parse(e.content)}catch(r){throw new Error(`Failed to parse profile event: ${r}`)}return t.created_at=e.created_at,t.profileEvent=JSON.stringify(e.rawEvent()),Object.keys(n).forEach(r=>{switch(r){case"name":t.name=n.name;break;case"display_name":t.displayName=n.display_name;break;case"image":case"picture":t.image=n.picture||n.image;break;case"banner":t.banner=n.banner;break;case"bio":t.bio=n.bio;break;case"nip05":t.nip05=n.nip05;break;case"lud06":t.lud06=n.lud06;break;case"lud16":t.lud16=n.lud16;break;case"about":t.about=n.about;break;case"zapService":t.zapService=n.zapService;break;case"website":t.website=n.website;break;default:t[r]=n[r];break}}),t}function ym(e){let t={};for(let[n,r]of Object.entries(e))switch(n){case"username":case"name":t.name=r;break;case"displayName":t.display_name=r;break;case"image":case"picture":t.picture=r;break;case"bio":case"about":t.about=r;break;default:t[n]=r;break}return JSON.stringify(t)}var mm=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function Lu(e,t,n=fetch,r={}){return await e.queuesNip05.add({id:t,func:async()=>{if(e.cacheAdapter&&e.cacheAdapter.loadNip05){let c=await e.cacheAdapter.loadNip05(t);if(c!=="missing"){if(c){let l=new bt({pubkey:c.pubkey,relayUrls:c.relays,nip46Urls:c.nip46});return l.ndk=e,l}else if(r.cache!=="no-cache")return null}}let s=t.match(mm);if(!s)return null;let[i,o="_",a]=s;try{let c=await n(`https://${a}/.well-known/nostr.json?name=${o}`,r),{names:l,relays:u,nip46:h}=bm(await c.json()),f=l[o.toLowerCase()],g=null;return f&&(g={pubkey:f,relays:u?.[f],nip46:h?.[f]}),e?.cacheAdapter&&e.cacheAdapter.saveNip05&&e.cacheAdapter.saveNip05(t,g),g}catch(c){return e?.cacheAdapter&&e.cacheAdapter.saveNip05&&e?.cacheAdapter.saveNip05(t,null),console.error("Failed to fetch NIP05 for",t,c),null}}})}function bm(e){let t={names:{}};for(let[n,r]of Object.entries(e.names))typeof n=="string"&&typeof r=="string"&&(t.names[n.toLowerCase()]=r);if(e.relays){t.relays={};for(let[n,r]of Object.entries(e.relays))typeof n=="string"&&Array.isArray(r)&&(t.relays[n]=r.filter(s=>typeof s=="string"))}if(e.nip46){t.nip46={};for(let[n,r]of Object.entries(e.nip46))typeof n=="string"&&Array.isArray(r)&&(t.nip46[n]=r.filter(s=>typeof s=="string"))}return t}var on,wm=(on=class extends J{_p2pk;constructor(t,n){super(t,n);this.kind??=10019}static from(t){return new on(t.ndk,t)}set relays(t){this.tags=this.tags.filter(n=>n[0]!=="relay");for(let n of t)this.tags.push(["relay",n])}get relays(){let t=[];for(let n of this.tags)n[0]==="relay"&&t.push(n[1]);return t}set mints(t){this.tags=this.tags.filter(n=>n[0]!=="mint");for(let n of t)this.tags.push(["mint",n])}get mints(){let t=[];for(let n of this.tags)n[0]==="mint"&&t.push(n[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return ne.fromRelayUrls(this.relays,this.ndk)}},et(on,"kind",10019),et(on,"kinds",[10019]),on),vm=(0,Bu.default)("ndk:zapper:ln");async function Uu({lud06:e,lud16:t},n){let r;if(t&&!t.startsWith("LNURL")){let[s,i]=t.split("@");r=`https://${i}/.well-known/lnurlp/${s}`}else if(e){let{words:s}=lo.decode(e,1e3),i=lo.fromWords(s);r=new TextDecoder("utf-8").decode(i)}if(!r)throw vm("No zap endpoint found %o",{lud06:e,lud16:t}),new Error("No zap endpoint found");try{let i=await(n.httpFetch||fetch)(r);if(i.status!==200){let o=await i.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${o}`)}return await i.json()}catch(s){throw new Error(`Unable to fetch zap endpoint ${r}: ${s}`)}}var bt=class Pu{ndk;profile;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=ot.npubEncode(this.pubkey)}return this._npub}get nprofile(){return console.log("encoding with pubkey",this.pubkey),ot.nprofileEncode({pubkey:this.pubkey})}set npub(t){this._npub=t}get hexpubkey(){return this.pubkey}set hexpubkey(t){this._pubkey=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=ot.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}async getZapInfo(t=!0,n=["nip61","nip57"]){if(!this.ndk)throw new Error("No NDK instance found");let r=[];if(n.includes("nip61")&&r.push(10019),n.includes("nip57")&&r.push(0),r.length===0)return[];let s=await this.ndk.fetchEvents({kinds:r,authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",groupable:!1});s.size<n.length&&(s=await this.ndk.fetchEvents({kinds:r,authors:[this.pubkey]},{cacheUsage:"ONLY_RELAY"}));let i=[],o=Array.from(s).find(c=>c.kind===10019),a=Array.from(s).find(c=>c.kind===0);if(o){let c=wm.from(o);if(c.mints.length>0&&i.push({type:"nip61",data:{mints:c.mints,relays:c.relays,p2pk:c.p2pk}}),!t)return i}if(a){let c=Iu(a),{lud06:l,lud16:u}=c;try{let h=await Uu({lud06:l,lud16:u},this.ndk);h&&i.push({type:"nip57",data:h})}catch(h){console.error("Error getting NIP-57 zap spec",h)}}return i}async getZapConfiguration(t){if(t??=this.ndk,!t)throw new Error("No NDK instance found");let n=async()=>{if(this.ndk?.cacheAdapter?.loadUsersLNURLDoc){let s=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if(s!=="missing"){if(s===null)return;if(s)return s}}let r;try{if(await this.fetchProfile({groupable:!1}),this.profile){let{lud06:s,lud16:i}=this.profile;r=await Uu({lud06:s,lud16:i},t)}}catch{}if(this.ndk?.cacheAdapter?.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,r||null),!!r)return r};return await t.queuesZapConfig.add({id:this.pubkey,func:n})}async getZapperPubkey(){return(await this.getZapConfiguration())?.nostrPubkey}static async fromNip05(t,n,r=!1){if(!n)throw new Error("No NDK instance found");let s={};r&&(s.cache="no-cache");let i=await Lu(n,t,n?.httpFetch,s);if(i){let o=new Pu({pubkey:i.pubkey,relayUrls:i.relays,nip46Urls:i.nip46});return o.ndk=n,o}}async fetchProfile(t,n=!1){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let r=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&t?.cacheUsage!=="ONLY_RELAY"){let o=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(o)return this.profile=o,o}!t&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(r=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),t={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),(!r||r.size===0)&&(r=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},t));let s=Array.from(r).sort((o,a)=>o.created_at-a.created_at);if(s.length===0)return null;let i=s[0];return this.profile=Iu(i),n&&(this.profile.profileEvent=JSON.stringify(i)),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile}follows=gm.bind(this);async followSet(t,n,r=3){let s=await this.follows(t,n,r);return new Set(Array.from(s).map(i=>i.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(t){let n=[["p",this.pubkey]];return t&&n[0].push("",t),n}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new J(this.ndk,{kind:0,content:ym(this.profile)}).publish()}async follow(t,n,r=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,r)),n.has(t))return!1;n.add(t);let s=new J(this.ndk,{kind:r});for(let i of n)s.tag(i);return await s.publish(),!0}async unfollow(t,n,r=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,r));let s=new Set,i=!1;for(let a of n)a.pubkey!==t.pubkey?s.add(a):i=!0;if(!i)return!1;let o=new J(this.ndk,{kind:r});for(let a of s)o.tag(a);return await o.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");let n=await Lu(this.ndk,t);return n===null?null:n.pubkey===this.pubkey}},xm=class Mu extends J{_encryptedTags;encryptedTagsLength;constructor(t,n){super(t,n);this.kind??=30001}static from(t){return new Mu(t.ndk,t)}get title(){let t=this.tagValue("title")||this.tagValue("name");return t||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let n=await this.ndk.signer.user();try{if(this.content.length>0)try{let r=await this.ndk.signer.decrypt(n,this.content),s=JSON.parse(r);return s&&s[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=s):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{console.log(`error decrypting ${this.content}`)}}catch{}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter(n=>n[0]===t)}get items(){return this.tags.filter(t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0]))}async addItem(t,n=void 0,r=!1,s="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let i;if(t instanceof J)i=[t.tagReference(n)];else if(t instanceof bt)i=t.referenceTags();else if(t instanceof Oe)i=t.referenceTags();else if(Array.isArray(t))i=[t];else throw new Error("Invalid object type");if(n&&i[0].push(n),r){let o=await this.ndk.signer.user(),a=await this.encryptedTags();s==="top"?a.unshift(...i):a.push(...i),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)}else s==="top"?this.tags.unshift(...i):this.tags.push(...i);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,n=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let r=this.tags.findIndex(a=>a[1]===t);r>=0&&this.tags.splice(r,1);let s=await this.ndk.signer.user(),i=await this.encryptedTags(),o=i.findIndex(a=>a[1]===t);if(o>=0&&(i.splice(o,1),this._encryptedTags=i,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(i),await this.encrypt(s)),n)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,n){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(n){let r=await this.ndk.signer.user(),s=await this.encryptedTags();s.splice(t,1),this._encryptedTags=s,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(s),await this.encrypt(r)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some(n=>n[1]===t)}filterForItems(){let t=new Set,n=new Map,r=[];for(let s of this.items)if(s[0]==="e"&&s[1])t.add(s[1]);else if(s[0]==="a"&&s[1]){let[i,o,a]=s[1].split(":");if(!i||!o)continue;let c=`${i}:${o}`,l=n.get(c)||[];l.push(a||""),n.set(c,l)}if(t.size>0&&r.push({ids:Array.from(t)}),n.size>0)for(let[s,i]of n.entries()){let[o,a]=s.split(":");r.push({kinds:[parseInt(o)],authors:[a],"#d":i})}return r}},Nu=xm;var an,Eo=(an=class extends J{constructor(t,n){super(t,n);this.kind??=30023}static from(t){return new an(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){let t=this.tagValue("published_at");if(t){let n=parseInt(t);return n>1e12&&(n=Math.floor(n/1e3)),n}}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(t){t?this.tags.push(["url",t]):this.removeTag("url")}},et(an,"kind",30023),et(an,"kinds",[30023]),an),ms,Uv=(ms=class extends Eo{},et(ms,"kind",30818),et(ms,"kinds",[30818]),ms);var cn,Pv=(cn=class extends J{constructor(t,n){super(t,n);this.kind??=34235}static from(t){return new cn(t.ndk,t.rawEvent())}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get thumbnail(){return this.tagValue("thumb")}set thumbnail(t){this.removeTag("thumb"),t&&this.tags.push(["thumb",t])}get url(){return this.tagValue("url")}set url(t){this.removeTag("url"),t&&this.tags.push(["url",t])}get published_at(){let t=this.tagValue("published_at");if(t)return parseInt(t)}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get duration(){let t=this.tagValue("duration");if(t)return parseInt(t)}set duration(t){this.removeTag("duration"),t!==void 0&&this.tags.push(["duration",Math.floor(t).toString()])}},et(cn,"kind",34235),et(cn,"kinds",[34235,34236]),cn),ln,Nv=(ln=class extends J{_article;constructor(t,n){super(t,n);this.kind??=9802}static from(t){return new ln(t.ndk,t)}get url(){return this.tagValue("r")}set context(t){t===void 0?this.tags=this.tags.filter(([n,r])=>n!=="context"):(this.tags=this.tags.filter(([n,r])=>n!=="context"),this.tags.push(["context",t]))}get context(){return this.tags.find(([t,n])=>t==="context")?.[1]??void 0}get article(){return this._article}set article(t){this._article=t,typeof t=="string"?this.tags.push(["r",t]):this.tag(t)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){if(this._article!==void 0)return this._article;let t,n=this.getArticleTag();if(!!n){switch(n[0]){case"a":let[r,s,i]=n[1].split(":");t=ot.naddrEncode({kind:parseInt(r),pubkey:s,identifier:i});break;case"e":t=ot.noteEncode(n[1]);break;case"r":this._article=n[1];break}if(t){let r=await this.ndk?.fetchEvent(t);r&&(r.kind===30023&&(r=Eo.from(r)),this._article=r)}return this._article}}},et(ln,"kind",9802),et(ln,"kinds",[9802]),ln),Ou="read",$u="write",ko=class Hu extends J{constructor(t,n){super(t,n);this.kind??=10002}static from(t){return new Hu(t.ndk,t.rawEvent())}get readRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===Ou).map(t=>xu(t[1])).filter(t=>!!t)}set readRelayUrls(t){for(let n of t)this.tags.push(["r",n,Ou])}get writeRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===$u).map(t=>xu(t[1])).filter(t=>!!t)}set writeRelayUrls(t){for(let n of t)this.tags.push(["r",n,$u])}get bothRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]).map(t=>t[1])}set bothRelayUrls(t){for(let n of t)this.tags.push(["r",n])}get relays(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").map(t=>t[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new ne(new Set(this.relays.map(t=>this.ndk.pool.getRelay(t))),this.ndk)}};function qu(e,t){try{let n=JSON.parse(t.content),r=new ko(e),s=new Set,i=new Set;for(let[o,a]of Object.entries(n)){try{o=ee(o)}catch{continue}if(!a)s.add(o),i.add(o);else{let c=a;c.write&&i.add(o),c.read&&s.add(o)}}return r.readRelayUrls=Array.from(s),r.writeRelayUrls=Array.from(i),r}catch{}}var Em=["daily","weekly","monthly","quarterly","yearly"];function km(e,t,n){return["amount",e.toString(),t,n]}function Tm(e){let t=parseInt(e[1]);if(isNaN(t)||t===void 0||t===null||t<=0)return;let n=e[2];if(n===void 0||n==="")return;let r=e[3];if(r!==void 0&&!!Em.includes(r))return{amount:t,currency:n,term:r}}var un,Ov=(un=class extends Eo{constructor(t,n){let r=n?.kind??37001;super(t,n);this.kind=r}static from(t){return new un(t.ndk,t)}get perks(){return this.getMatchingTags("perk").map(t=>t[1]).filter(t=>t!==void 0)}addPerk(t){this.tags.push(["perk",t])}get amounts(){return this.getMatchingTags("amount").map(t=>Tm(t)).filter(t=>t!==void 0)}addAmount(t,n,r){this.tags.push(km(t,n,r))}set relayUrl(t){this.tags.push(["r",t])}get relayUrls(){return this.getMatchingTags("r").map(t=>t[1]).filter(t=>t!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(t){this.removeTag("p"),t&&this.tags.push(["p",t])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},et(un,"kind",37001),et(un,"kinds",[37001]),un);var hn,$v=(hn=class extends J{debug;_proofs=[];constructor(t,n){super(t,n);this.kind??=9321,this.debug=t?.debug.extend("nutzap")??(0,zu.default)("ndk:nutzap"),this.alt||(this.alt="This is a nutzap")}static from(t){let n=new this(t.ndk,t);try{let r=n.getMatchingTags("proof");r.length?n._proofs=r.map(s=>JSON.parse(s[1])):n._proofs=JSON.parse(n.content)}catch{return}if(!(!n._proofs||!n._proofs.length))return n}set comment(t){this.content=t??""}get comment(){let t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter(n=>n[0]!=="proof");for(let n of t)this.tags.push(["proof",JSON.stringify(n)]);this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()])}get proofs(){return this._proofs}get p2pk(){let t=this.proofs[0];try{let n=JSON.parse(t.secret),r={};if(typeof n=="string"?(r=JSON.parse(n),this.debug("stringified payload",t.secret)):typeof n=="object"&&(r=n),r[0]==="P2PK"&&r[1]?.data){let o=r[1].data.slice(2,-1);if(o)return o}}catch(n){this.debug("error parsing p2pk pubkey",n,this.proofs[0])}}get mint(){return this.tagValue("u")}set mint(t){this.removeTag("u"),this.tag(["u",t])}get unit(){return this.tagValue("unit")??"msat"}set unit(t){this.removeTag("unit"),t&&this.tag(["unit",t])}get amount(){return this.proofs.reduce((n,r)=>n+r.amount,0)*1e3}sender=this.author;set target(t){this.tags=this.tags.filter(n=>n[0]!=="p"),t instanceof J&&this.tags.push(t.tagReference())}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){let t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new bt({pubkey:t})}get isValid(){let t=0,n=0;for(let r of this.tags)r[0]==="p"&&t++,r[0]==="u"&&n++;return t===1&&n===1&&this.proofs.length>0}},et(hn,"kind",9321),et(hn,"kinds",[hn.kind]),hn),fn,Hv=(fn=class extends J{relaySet;memberSet=new Set;constructor(t,n){super(t,n);this.kind??=39002,this.memberSet=new Set(this.members)}static from(t){return new fn(t.ndk,t)}get members(){return this.getMatchingTags("p").map(t=>t[1])}hasMember(t){return this.memberSet.has(t)}async publish(t,n,r){return t??=this.relaySet,super.publishReplaceable(t,n,r)}},et(fn,"kind",39002),et(fn,"kinds",[39002]),fn),dn,qv=(dn=class extends J{constructor(t,n){super(t,n);this.kind??=39e3}static from(t){return new dn(t.ndk,t)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(t){this.removeTag("public"),this.removeTag("private"),t==="public"?this.tags.push(["public",""]):t==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(t){this.removeTag("open"),this.removeTag("closed"),t==="open"?this.tags.push(["open",""]):t==="closed"&&this.tags.push(["closed",""])}},et(dn,"kind",39e3),et(dn,"kinds",[39e3]),dn);function Sm(e,t){return t??=(0,To.default)("ndk:relay:auth-policies:disconnect"),async n=>{t(`Relay ${n.url} requested authentication, disconnecting`),e.removeRelay(n.url)}}async function Vu(e,t,n,r,s,i){try{await e.sign(n),s(e)}catch(o){r(`Failed to publish auth event to relay ${t.url}`,o),i(e)}}function Rm({ndk:e,signer:t,debug:n}={}){return n??=(0,To.default)("ndk:auth-policies:signIn"),async(r,s)=>{n(`Relay ${r.url} requested authentication, signing in`);let i=new J(e);return i.kind=22242,i.tags=[["relay",r.url],["challenge",s]],t??=e?.signer,new Promise(async(o,a)=>{t?await Vu(i,r,t,n,o,a):e?.once("signer:ready",async c=>{await Vu(i,r,c,n,o,a)})})}}var Cm={disconnect:Sm,signIn:Rm};var Ao=class Du{_user;_privateKey;constructor(t){if(t){if(typeof t=="string")if(t.startsWith("nsec1")){let{type:n,data:r}=ot.decode(t);n==="nsec"&&(this._privateKey=r)}else if(t.length===64)this._privateKey=Gr(t);else throw new Error("Invalid private key provided.");else this._privateKey=t;this._privateKey&&(this._user=new bt({pubkey:Or(this._privateKey)}))}}get privateKey(){if(!!this._privateKey)return Wr(this._privateKey)}static generate(){let t=fi();return new Du(t)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return Ut(t,this._privateKey).sig}getConversationKey(t){if(!this._privateKey)throw Error("Attempted to get conversation key without a private key");let n=t.pubkey;return Wn.getConversationKey(this._privateKey,n)}async nip44Encrypt(t,n){let r=this.getConversationKey(t);return await Wn.encrypt(n,r)}async nip44Decrypt(t,n){let r=this.getConversationKey(t);return await Wn.decrypt(n,r)}async encrypt(t,n,r=wo){return r==="nip44"?this.nip44Encrypt(t,n):this.nip04Encrypt(t,n)}async decrypt(t,n,r=wo){return r==="nip44"?this.nip44Decrypt(t,n):this.nip04Decrypt(t,n)}async nip04Encrypt(t,n){if(!this._privateKey)throw Error("Attempted to encrypt without a private key");let r=t.pubkey;return await Vr.encrypt(this._privateKey,r,n)}async nip04Decrypt(t,n){if(!this._privateKey)throw Error("Attempted to decrypt without a private key");let r=t.pubkey;return await Vr.decrypt(this._privateKey,r,n)}},Lm=class extends Fu.EventEmitter{ndk;signer;relaySet;debug;encryptionType="nip04";pool;constructor(e,t,n,r){super();if(this.ndk=e,this.signer=t,r){this.pool=new xo(r,Array.from(e.pool.blacklistRelayUrls),e,n.extend("rpc-pool")),this.pool.name="nostr-rpc",this.relaySet=new ne(new Set,e,this.pool);for(let s of r){let i=this.pool.getRelay(s,!1,!1);i.authPolicy=Cm.signIn({ndk:e,signer:t,debug:n}),this.relaySet.addRelay(i),i.connect()}}this.debug=n.extend("rpc")}subscribe(e){let t=this.ndk.subscribe(e,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool},this.relaySet,!1);return t.on("event",async n=>{try{let r=await this.parseEvent(n);r.method?this.emit("request",r):this.emit(`response-${r.id}`,r)}catch(r){this.debug("error parsing event",r,n.rawEvent())}}),new Promise(n=>{t.on("eose",()=>{this.debug("eosed"),n(t)}),t.start()})}async parseEvent(e){this.encryptionType==="nip44"&&e.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!e.content.includes("?iv=")&&(this.encryptionType="nip44");let t=this.ndk.getUser({pubkey:e.pubkey});t.ndk=this.ndk;let n;try{n=await this.signer.decrypt(t,e.content,this.encryptionType)}catch{let u=this.encryptionType==="nip04"?"nip44":"nip04";n=await this.signer.decrypt(t,e.content,u),this.encryptionType=u}let r=JSON.parse(n),{id:s,method:i,params:o,result:a,error:c}=r;return i?{id:s,pubkey:e.pubkey,method:i,params:o,event:e}:{id:s,result:a,error:c,event:e}}async sendResponse(e,t,n,r=24133,s){let i={id:e,result:n};s&&(i.error=s);let o=await this.signer.user(),a=this.ndk.getUser({pubkey:t}),c=new J(this.ndk,{kind:r,content:JSON.stringify(i),tags:[["p",t]],pubkey:o.pubkey});c.content=await this.signer.encrypt(a,c.content,this.encryptionType),await c.sign(this.signer),await c.publish(this.relaySet)}async sendRequest(e,t,n=[],r=24133,s){let i=Math.random().toString(36).substring(7),o=await this.signer.user(),a=this.ndk.getUser({pubkey:e}),c={id:i,method:t,params:n},l=new Promise(()=>{let h=f=>{f.result==="auth_url"?(this.once(`response-${i}`,h),this.emit("authUrl",f.error)):s&&s(f)};this.once(`response-${i}`,h)}),u=new J(this.ndk,{kind:r,content:JSON.stringify(c),tags:[["p",e]],pubkey:o.pubkey});return u.content=await this.signer.encrypt(a,u.content,this.encryptionType),await u.sign(this.signer),await u.publish(this.relaySet),l}},Bm=class{async handle(e,t,n,r){let s=e.debug.extend("ping");if(s(`ping request from ${n}`),await e.pubkeyAllowed({id:t,pubkey:n,method:"ping"}))return s(`connection request from ${n} allowed`),"pong";s(`connection request from ${n} rejected`)}},Um=class{async handle(e,t,n,r){let[s,i]=r,o=e.debug.extend("connect");if(o(`connection request from ${n}`),i&&e.applyToken&&(o("applying token"),await e.applyToken(n,i)),await e.pubkeyAllowed({id:t,pubkey:n,method:"connect",params:i}))return o(`connection request from ${n} allowed`),"ack";o(`connection request from ${n} rejected`)}},Pm=class{async handle(e,t,n,r){return e.localUser?.pubkey}},Mm=class{async handle(e,t,n,r){let[s,i]=r,o=new bt({pubkey:s});return await Nm(e,t,n,o,i)}};async function Nm(e,t,n,r,s){if(!await e.pubkeyAllowed({id:t,pubkey:n,method:"nip04_decrypt",params:s})){e.debug(`decrypt request from ${n} rejected`);return}return await e.signer.decrypt(r,s,"nip04")}var Om=class{async handle(e,t,n,r){let[s,i]=r,o=new bt({pubkey:s});return await $m(e,t,n,o,i)}};async function $m(e,t,n,r,s){if(!await e.pubkeyAllowed({id:t,pubkey:n,method:"nip04_encrypt",params:s})){e.debug(`encrypt request from ${n} rejected`);return}return await e.signer.encrypt(r,s,"nip04")}var Hm=class{async handle(e,t,n,r){let s=await qm(e,t,n,r);if(!!s)return JSON.stringify(await s.toNostrEvent())}};async function qm(e,t,n,r){let[s]=r;e.debug(`sign event request from ${n}`);let i=new J(e.ndk,JSON.parse(s));if(e.debug("event to sign",i.rawEvent()),!await e.pubkeyAllowed({id:t,pubkey:n,method:"sign_event",params:i})){e.debug(`sign event request from ${n} rejected`);return}return e.debug(`sign event request from ${n} allowed`),await i.sign(e.signer),i}var zm=class{async handle(e,t,n,r){let[s,i]=r,o=new bt({pubkey:s});return await Vm(e,t,n,o,i)}};async function Vm(e,t,n,r,s){if(!await e.pubkeyAllowed({id:t,pubkey:n,method:"nip44_encrypt",params:s})){e.debug(`encrypt request from ${n} rejected`);return}return await e.signer.encrypt(r,s,"nip44")}var Dm=class{async handle(e,t,n,r){let[s,i]=r,o=new bt({pubkey:s});return await Fm(e,t,n,o,i)}};async function Fm(e,t,n,r,s){if(!await e.pubkeyAllowed({id:t,pubkey:n,method:"nip44_decrypt",params:s})){e.debug(`decrypt request from ${n} rejected`);return}return await e.signer.decrypt(r,s,"nip44")}var jv=class{ndk;signer;localUser;debug;rpc;permitCallback;relayUrls;constructor(e,t,n,r){if(this.ndk=e,t instanceof Uint8Array)this.signer=new Ao(t);else if(t instanceof String)this.signer=new Ao(Gr(t));else if(t instanceof Ao)this.signer=t;else throw new Error("Invalid signer");this.debug=e.debug.extend("nip46:backend"),this.relayUrls=r??Array.from(e.pool.relays.keys()),this.rpc=new Lm(e,this.signer,this.debug,this.relayUrls),this.permitCallback=n}async start(){this.localUser=await this.signer.user(),this.ndk.subscribe({kinds:[24133],"#p":[this.localUser.pubkey]},{closeOnEose:!1}).on("event",t=>this.handleIncomingEvent(t))}handlers={connect:new Um,sign_event:new Hm,nip04_encrypt:new Om,nip04_decrypt:new Mm,nip44_encrypt:new zm,nip44_decrypt:new Dm,get_public_key:new Pm,ping:new Bm};setStrategy(e,t){this.handlers[e]=t}async applyToken(e,t){throw new Error("connection token not supported")}async handleIncomingEvent(e){let{id:t,method:n,params:r}=await this.rpc.parseEvent(e),s=e.pubkey,i;if(this.debug("incoming event",{id:t,method:n,params:r}),!e.verifySignature(!1)){this.debug("invalid signature",e.rawEvent());return}let o=this.handlers[n];if(o)try{i=await o.handle(this,t,s,r)}catch(a){this.debug("error handling event",a,{id:t,method:n,params:r}),this.rpc.sendResponse(t,s,"error",void 0,a.message)}else this.debug("unsupported method",{method:n,params:r});i?(this.debug(`sending response to ${s}`,i),this.rpc.sendResponse(t,s,i)):this.rpc.sendResponse(t,s,"error",void 0,"Not authorized")}async pubkeyAllowed(e){return this.permitCallback(e)}};function Wm(e,t){return e.created_at>t.created_at?e:t}async function Gm(e,t){return(await Yu([e],t)).get(e)}async function Yu(e,t,n=!1){let r=t.outboxPool||t.pool,s=new Set;for(let u of r.relays.values())s.add(u);let i=new Map,o=new Map,a=new ne(s,t);if(t.cacheAdapter?.locking&&!n){let u=await t.fetchEvents({kinds:[3,10002],authors:e},{cacheUsage:"ONLY_CACHE"});for(let h of u)h.kind===10002&&i.set(h.pubkey,ko.from(h));for(let h of u)if(h.kind===3){if(i.has(h.pubkey))continue;let f=qu(t,h);f&&o.set(h.pubkey,f)}e=e.filter(h=>!i.has(h)&&!o.has(h))}if(e.length===0)return i;let c=new Map,l=new Map;return new Promise(async u=>{let h=t.subscribe({kinds:[3,10002],authors:e},{closeOnEose:!0,pool:r,groupable:!0,cacheUsage:"ONLY_RELAY",subId:"ndk-relay-list-fetch"},a,!1);h.on("event",f=>{if(f.kind===10002){let g=c.get(f.pubkey);if(g&&g.created_at>f.created_at)return;c.set(f.pubkey,f)}else if(f.kind===3){let g=l.get(f.pubkey);if(g&&g.created_at>f.created_at)return;l.set(f.pubkey,f)}}),h.on("eose",()=>{for(let f of c.values())i.set(f.pubkey,ko.from(f));for(let f of e){if(i.has(f))continue;let g=l.get(f);if(!g)continue;let y=qu(t,g);y&&i.set(f,y)}u(i)}),h.start()})}var _o=class{type;relayUrlScores;readRelays;writeRelays;constructor(e){this.type=e,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},Zm=class extends Gu.EventEmitter{data;ndk;debug;constructor(e){super();this.ndk=e,this.debug=e.debug.extend("outbox-tracker"),this.data=new Zu.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(e,t=!1){let n=[];for(let r=0;r<e.length;r+=400){let i=e.slice(r,r+400).map(o=>Ju(o)).filter(o=>!this.data.has(o));if(i.length!==0){for(let o of i)this.data.set(o,new _o("user"));n.push(new Promise(o=>{Yu(i,this.ndk,t).then(a=>{for(let[c,l]of a){let u=this.data.get(c);if(u??=new _o("user"),l){u.readRelays=new Set(Eu(l.readRelayUrls)),u.writeRelays=new Set(Eu(l.writeRelayUrls));for(let h of u.readRelays)this.ndk.pool.blacklistRelayUrls.has(h)&&u.readRelays.delete(h);for(let h of u.writeRelays)this.ndk.pool.blacklistRelayUrls.has(h)&&u.writeRelays.delete(h);this.data.set(c,u)}}}).finally(o)}))}}return Promise.all(n)}track(e,t,n=!0){let r=Ju(e);t??=Ym(e);let s=this.data.get(r);return s||(s=new _o(t),e instanceof bt&&this.trackUsers([e])),s}};function Ju(e){return e instanceof bt?e.pubkey:e}function Ym(e){return e instanceof bt?"user":"kind"}function Jm(e,t){let n=t.connectedRelays();if(!Array.from(e.relays).some(s=>n.map(i=>i.url).includes(s.url)))for(let s of n)e.addRelay(s);if(n.length===0)for(let s of t.relays.values())e.addRelay(s);return e}function Qu(e){if(!e||e==="")return!1;try{return new URL(e),!0}catch{return!1}}async function Qm(e,t,n,r={type:"timeout"}){let s=this.debug.extend("fetch-event-from-tag"),[i,o,a]=e;n={},s("fetching event from tag",e,n,r);let c=ys(this,t.pubkey);if(c&&c.size>0){s("fetching event from author relays %o",Array.from(c));let p=ne.fromRelayUrls(Array.from(c),this),d=await this.fetchEvent(o,n,p);if(d)return d}else s("no author relays found for %s",t.pubkey,t);let l=mo(this,[{ids:[o]}],this.pool);s("fetching event without relay hint",l);let u=await this.fetchEvent(o,n);if(u)return u;if(a&&a!==""){let p=await this.fetchEvent(o,n,this.pool.getRelay(a,!0,!0,[{ids:[o]}]));if(p)return p}let h,f=Qu(a)?this.pool.getRelay(a,!1,!0,[{ids:[o]}]):void 0,g=new Promise(p=>{this.fetchEvent(o,n,f).then(p)});if(!Qu(a)||r.type==="none")return g;let y=new Promise(async p=>{let d=r.relaySet,m=r.timeout??1500,v=new Promise(E=>setTimeout(E,m));if(r.type==="timeout"&&await v,h)p(h);else{s("fallback fetch triggered");let E=await this.fetchEvent(o,n,d);p(E)}});switch(r.type){case"timeout":return Promise.race([g,y]);case"eose":return h=await g,h||y}}var Xm="/.well-known/nostr/nip96.json",Km=class{ndk;spec;url;nip98Required=!1;constructor(e,t){this.url=`https://${e}${Xm}`,this.ndk=t}async prepareUpload(e,t="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let n={};return this.nip98Required&&(n={Authorization:await this.generateNip98Header(this.spec.api_url,t,e)}),{url:this.spec.api_url,headers:n}}async xhrUpload(e,t){let n="POST",{url:r,headers:s}=await this.prepareUpload(t,n);e.open(n,r,!0),s.Authorization&&e.setRequestHeader("Authorization",s.Authorization);let i=new FormData;return i.append("file",t),new Promise((o,a)=>{e.onload=function(){e.status>=200&&e.status<300?o(JSON.parse(e.responseText)):a(new Error(e.statusText))},e.onerror=function(){a(new Error("Network Error"))},e.send(i)})}async upload(e){let t="POST",{url:n,headers:r}=await this.prepareUpload(e,t),s=new FormData;s.append("file",e);let i=await this.ndk.httpFetch(this.spec.api_url,{method:t,headers:r,body:s});if(i.status!==200)throw new Error(`Failed to upload file to ${n}`);let o=await i.json();if(o.status!=="success")throw new Error(o.message);return o}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();let e=await this.ndk.httpFetch(this.url);if(e.status!==200)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);let t=await e.json();if(!t)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=t,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(e,t,n){let r=new J(this.ndk,{kind:27235,tags:[["u",e],["method",t]]});if(["POST","PUT","PATCH"].includes(t)){let i=await this.calculateSha256(n);r.tags.push(["payload",i])}return await r.sign(),`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(e){let t=await e.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}},Xu=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(e,t){this.maxConcurrency=t}add(e){if(this.promises.has(e.id))return this.promises.get(e.id);let t=new Promise((n,r)=>{this.queue.push({...e,func:()=>e.func().then(s=>(n(s),s),s=>{throw r(s),s})}),this.process()});return this.promises.set(e.id,t),t.finally(()=>{this.promises.delete(e.id),this.processing.delete(e.id),this.process()}),t}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;let e=this.queue.shift();!e||this.processing.has(e.id)||(this.processing.add(e.id),e.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},tb=class{subscriptions;seenEvents=new Map;debug;constructor(e){this.subscriptions=new Map,this.debug=e.extend("sub-manager")}add(e){this.subscriptions.set(e.internalId,e),e.onStopped&&console.log("SUB-MANAGER BUG: Subscription already had onStopped! \u{1F914}",e.internalId),e.onStopped=()=>{this.subscriptions.delete(e.internalId)},e.on("close",()=>{this.subscriptions.delete(e.internalId)})}seenEvent(e,t){let n=this.seenEvents.get(e)||[];n.push(t),this.seenEvents.set(e,n)}filterMatchingTime=0;filterMatchingCount=0;dispatchEvent(e,t,n=!1){t&&this.seenEvent(e.id,t);let r=this.subscriptions.values(),s=[],i=Date.now();for(let o of r)mi(o.filters,e)&&s.push(o);this.filterMatchingTime+=Date.now()-i,this.filterMatchingCount+=s.length;for(let o of s)o.eventReceived(e,void 0,!1,n)}},th=(0,Ku.default)("ndk:active-user");async function eb(e){if(!this.autoConnectUserRelays)return;let t=await Gm(e.pubkey,this);if(!!t){for(let n of t.relays){let r=this.pool.relays.get(n);r||(r=new Oe(n,this.relayAuthDefaultPolicy,this),this.pool.addRelay(r))}return t}}async function nb(e){let t=this.outboxPool||this.pool;t.connectedRelays.length>0?eh.call(this,e):t.once("connect",()=>{eh.call(this,e)})}async function eh(e){let t=await eb.call(this,e),n=[{kinds:[10006],authors:[e.pubkey]}];this.autoFetchUserMutelist&&n[0].kinds.push(1e4);let r=t?t.relaySet:void 0,s=this.subscribe(n,{subId:"active-user-settings",closeOnEose:!0},r,!1),i=new Map;s.on("event",o=>{let a=i.get(o.kind);a&&a.created_at>=o.created_at||i.set(o.kind,o)}),s.on("eose",()=>{for(let o of i.values())rb.call(this,o)}),s.start()}async function rb(e){e.kind===10006?sb.call(this,e):e.kind===1e4&&ib.call(this,e)}function sb(e){let t=Nu.from(e);for(let n of t.items)this.pool.blacklistRelayUrls.add(n[0]);th("Added %d relays to relay blacklist",t.items.length)}function ib(e){let t=Nu.from(e);for(let n of t.items)this.mutedIds.set(n[1],n[0]);th("Added %d users to mute list",t.items.length)}var ob=["wss://purplepag.es/","wss://nos.lol/"],nh=["wss://brb.io/","wss://nostr.mutinywallet.com/"],So=class extends Wu.EventEmitter{_explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;mutedIds;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=1;validationRatioFn;subManager;publishingFailureHandled=!1;relayAuthDefaultPolicy;httpFetch;netDebug;autoConnectUserRelays=!0;autoFetchUserMutelist=!0;walletConfig;constructor(e={}){super();this.debug=e.debug||(0,ju.default)("ndk"),this.netDebug=e.netDebug,this._explicitRelayUrls=e.explicitRelayUrls||[],this.subManager=new tb(this.debug),this.pool=new xo(e.explicitRelayUrls||[],e.blacklistRelayUrls||nh,this),this.pool.name="main",this.pool.on("relay:auth",async(t,n)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,n)}),this.autoConnectUserRelays=e.autoConnectUserRelays??!0,this.autoFetchUserMutelist=e.autoFetchUserMutelist??!0,this.clientName=e.clientName,this.clientNip89=e.clientNip89,this.relayAuthDefaultPolicy=e.relayAuthDefaultPolicy,e.enableOutboxModel&&(this.outboxPool=new xo(e.outboxRelayUrls||ob,e.blacklistRelayUrls||nh,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new Zm(this)),this.signer=e.signer,this.cacheAdapter=e.cacheAdapter,this.mutedIds=e.mutedIds||new Map,e.devWriteRelayUrls&&(this.devWriteRelaySet=ne.fromRelayUrls(e.devWriteRelayUrls,this)),this.queuesZapConfig=new Xu("zaps",3),this.queuesNip05=new Xu("nip05",10),this.signatureVerificationWorker=e.signatureVerificationWorker,this.initialValidationRatio=e.initialValidationRatio||1,this.lowestValidationRatio=e.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(e){this._explicitRelayUrls=e,this.pool.relayUrls=e}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(e){this.asyncSigVerification=!!e,e&&jy(e)}addExplicitRelay(e,t,n=!0){let r;return typeof e=="string"?r=new Oe(e,t,this):r=e,this.pool.addRelay(r,n),this.explicitRelayUrls.push(r.url),r}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(e){let t=this._activeUser?.pubkey!==e?.pubkey;this._activeUser=e,e&&t?nb.call(this,e):e||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(e){this._signer=e,e&&this.emit("signer:ready",e),e?.user().then(t=>{t.ndk=this,this.activeUser=t})}async connect(e){this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await this._signer.relays?.(this)),this._signer.relays&&(await this._signer.relays(this)).forEach(r=>this.pool.addRelay(r)));let t=[this.pool.connect(e)];return this.outboxPool&&t.push(this.outboxPool.connect(e)),this.debug("Connecting to relays %o",{timeoutMs:e}),Promise.allSettled(t).then(()=>{})}getUser(e){let t=new bt(e);return t.ndk=this,t}async getUserFromNip05(e,t=!1){return bt.fromNip05(e,this,t)}subscribe(e,t,n,r=!0){let s=new pm(this,e,t,n);this.subManager.add(s);let i=t?.pool??this.pool;if(n)for(let o of n.relays)i.useTemporaryRelay(o,void 0,s.filters);if(this.outboxPool&&s.hasAuthorsFilter()){let o=s.filters.filter(a=>a.authors&&a.authors?.length>0).map(a=>a.authors).flat();this.outboxTracker?.trackUsers(o)}return r&&setTimeout(()=>s.start(),0),s}async publish(e,t,n){return this.debug("Deprecated: Use `event.publish()` instead"),e.publish(t,n)}fetchEventFromTag=Qm.bind(this);async fetchEvent(e,t,n){let r,s;if(n instanceof Oe?s=new ne(new Set([n]),this):n instanceof ne&&(s=n),!n&&typeof e=="string"&&!um(e)){let i=fm(e,this);i.length>0&&(s=new ne(new Set(i),this),s=Jm(s,this.pool))}if(typeof e=="string"?r=[lm(e)]:Array.isArray(e)?r=e:r=[e],r.length===0)throw new Error(`Invalid filter: ${JSON.stringify(e)}`);return new Promise(i=>{let o=null,a=this.subscribe(r,{...t||{},closeOnEose:!0},s,!1),c=setTimeout(()=>{a.stop(),i(o)},1e4);a.on("event",l=>{l.ndk=this,l.isReplaceable()?(!o||o.created_at<l.created_at)&&(o=l):(clearTimeout(c),i(l))}),a.on("eose",()=>{clearTimeout(c),i(o)}),a.start()})}async fetchEvents(e,t,n){return new Promise(r=>{let s=new Map,i=this.subscribe(e,{...t||{},closeOnEose:!0},n,!1),o=a=>{a instanceof J||(a=new J(void 0,a));let c=a.deduplicationKey(),l=s.get(c);l&&(a=Wm(l,a)),a.ndk=this,s.set(c,a)};i.on("event",o),i.on("eose",()=>{r(new Set(s.values()))}),i.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(e){return new Km(e,this)}set wallet(e){if(console.log("setting wallet",{lnPay:e?.lnPay,cashuPay:e?.cashuPay}),!e){this.walletConfig=void 0;return}this.walletConfig??={},this.walletConfig.lnPay=e?.lnPay?.bind(e),this.walletConfig.cashuPay=e?.cashuPay?.bind(e)}};var Gv=(0,rh.default)("ndk:zapper");var sh=["wss://relay.damus.io","wss://nostr.wine","wss://relay.nostr.net","wss://relay.nostr.band","wss://nos.lol","wss://njump.me","wss://relay.getalby.com","wss://relay.primal.net"];function ih(e="",t=3){let n=e.length;if(n!==63)return"Invalid nPub";let r="npub1";for(let i=5;i<t+5;i++)r+=e[i];r+="...";let s="";for(let i=n-1;i>=n-t;i--)s=e[i]+s;return r+=s,r}var Io=Q(oh(),1),Lo=class extends HTMLElement{constructor(){super(...arguments);this.rendered=!1;this.ndk=new So;this.userProfile={name:"",image:"",nip05:""};this.theme="light";this.isLoading=!0;this.isStatsLoading=!0;this.isStatsFollowsLoading=!0;this.isStatsFollowersLoading=!0;this.isStatsNotesLoading=!0;this.isStatsRepliesLoading=!0;this.isStatsZapsLoading=!0;this.isStatsRelaysLoading=!0;this.isError=!1;this.isStatsError=!1;this.stats={follows:0,followers:0,notes:0,replies:0,zaps:0,relays:0};this.onClick=null;this.showRecentPosts=!1;this.recentPosts=[];this.isRecentPostsLoading=!0;this.connectToNostr=async()=>{await this.ndk.connect()};this.getRelays=()=>{let t=this.getAttribute("relays");return t?t.split(","):sh};this.getNDKUser=async()=>{let t=this.getAttribute("npub"),n=this.getAttribute("nip05"),r=this.getAttribute("pubkey");return t?this.ndk.getUser({npub:t}):n?this.ndk.getUserFromNip05(n):r?this.ndk.getUser({pubkey:r}):null};this.getUserProfile=async()=>{try{this.isLoading=!0,this.render();let t=await this.getNDKUser();if(t?.npub)this.ndkUser=t,await t.fetchProfile(),this.userProfile=t.profile,this.userProfile&&(this.getProfileStats().then(n=>{this.isStatsError=!1,this.stats=n}).catch(n=>{console.log(n),this.isStatsError=!0}).finally(()=>{this.isStatsLoading=!1,this.render()}),this.showRecentPosts&&this.fetchRecentPosts()),this.userProfile.image||(this.userProfile.image="./assets/default_dp.png"),this.isError=!1;else throw new Error("Either npub or nip05 should be provided")}catch(t){throw this.isError=!0,t}finally{this.isLoading=!1,this.render()}};this.getProfileStats=async()=>{try{this.isStatsFollowsLoading=!0,this.isStatsFollowersLoading=!0,this.isStatsNotesLoading=!0;let t=this.ndkUser.pubkey;return this.ndkUser.follows().then(n=>{this.stats.follows=n.size,this.isStatsFollowsLoading=!1,this.render()}).catch(n=>{console.log("Error fetching follows:",n)}),this.ndk.fetchEvents({kinds:[Bn.Contacts],"#p":[t||""]}).then(n=>{this.stats.followers=n.size,this.isStatsFollowersLoading=!1,this.render()}).catch(n=>{console.log("Error fetching followers:",n)}),this.ndk.fetchEvents({kinds:[Bn.Text],authors:[t]}).then(n=>{let r=0;n.forEach(s=>{s.hasTag("e")&&(r+=1)}),this.stats.replies=r,this.stats.notes=n.size-r,this.isStatsNotesLoading=!1,this.render()}).catch(n=>{console.log("Error fetching notes:",n)}),this.stats.zaps=0,this.render(),this.stats.relays=0,this.render(),this.stats}catch(t){throw console.log("getProfileStats",t),new Error("Error fetching stats")}};this.fetchRecentPosts=async()=>{try{if(this.isRecentPostsLoading=!0,this.render(),!this.ndkUser||!this.ndkUser.pubkey)throw new Error("User not available");let t=this.ndkUser.pubkey,n=await this.ndk.fetchEvents({kinds:[Bn.Text],authors:[t],limit:10}),r=Array.from(n).filter(s=>!s.hasTag("e")).sort((s,i)=>(i.created_at||0)-(s.created_at||0)).slice(0,3);return this.recentPosts=r,r}catch(t){return console.log("Error fetching recent posts:",t),[]}finally{this.isRecentPostsLoading=!1,this.render()}};this.getTheme=async()=>{this.theme="light";let t=this.getAttribute("theme");if(t){if(!["light","dark"].includes(t))throw new Error(`Invalid theme '${t}'. Accepted values are 'light', 'dark'`);this.theme=t}}}connectedCallback(){this.getAttribute("onClick")!==null&&(this.onClick=window.onClick),this.showRecentPosts=this.getAttribute("show-recent-posts")==="true",this.rendered||(this.ndk=new So({explicitRelayUrls:this.getRelays()}),this.getTheme(),this.connectToNostr(),this.getUserProfile(),this.rendered=!0)}static get observedAttributes(){return["relays","pubkey","nip05","theme","show-npub","show-follow","onClick","show-recent-posts"]}attributeChangedCallback(t,n,r){t==="relays"&&(this.ndk.explicitRelayUrls=this.getRelays(),this.connectToNostr()),["relays","npub","nip05"].includes(t)&&this.getUserProfile(),t==="onClick"&&(this.onClick=window[r]),t==="theme"&&(this.getTheme(),this.render()),t==="show-recent-posts"&&(this.showRecentPosts=r==="true",this.showRecentPosts&&this.ndkUser&&this.fetchRecentPosts(),this.render()),["show-npub","show-follow"].includes(t)&&this.render()}disconnectedCallback(){}getStyles(){let t="";return this.theme==="dark"?t=`
        --nstrc-profile-background: var(--nstrc-profile-background-dark);
        --nstrc-profile-skeleton-min-hsl: var(--nstrc-profile-skeleton-min-hsl-dark);
        --nstrc-profile-skeleton-max-hsl: var(--nstrc-profile-skeleton-max-hsl-dark);
        --nstrc-profile-text-primary: var(--nstrc-profile-text-primary-dark);
        --nstrc-profile-text-grey: var(--nstrc-profile-text-grey-dark);
        --nstrc-profile-banner-placeholder-color: var(--nstrc-profile-banner-placeholder-color-dark);
        --nstrc-profile-copy-foreground-color: var(--nstrc-profile-copy-foreground-color-dark);
        --nstrc-profile-post-background: rgba(255, 255, 255, 0.1);
        `:t=`
        --nstrc-profile-background: var(--nstrc-profile-background-light);
        --nstrc-profile-skeleton-min-hsl: var(--nstrc-profile-skeleton-min-hsl-light);
        --nstrc-profile-skeleton-max-hsl: var(--nstrc-profile-skeleton-max-hsl-light);
        --nstrc-profile-text-primary: var(--nstrc-profile-text-primary-light);
        --nstrc-profile-text-grey: var(--nstrc-profile-text-grey-light);
        --nstrc-profile-banner-placeholder-color: var(--nstrc-profile-banner-placeholder-color-light);
        --nstrc-profile-copy-foreground-color: var(--nstrc-profile-copy-foreground-color-light);
        --nstrc-profile-post-background: rgba(0, 0, 0, 0.05);
        `,`
      <style>
      :root {
          --nstrc-profile-background-light: #f5f5f5;
          --nstrc-profile-background-dark: #000000;
          --nstrc-profile-skeleton-min-hsl-light: 200, 20%, 80%;
          --nstrc-profile-skeleton-min-hsl-dark: 200, 20%, 20%;
          --nstrc-profile-skeleton-max-hsl-light: 200, 20%, 95%;
          --nstrc-profile-skeleton-max-hsl-dark: 200, 20%, 30%;
          --nstrc-profile-text-primary-light: #111111;
          --nstrc-profile-text-primary-dark: #ffffff;
          --nstrc-profile-text-grey-light: #808080;
          --nstrc-profile-text-grey-dark: #666666;
          --nstrc-profile-banner-placeholder-color-light: #e5e5e5;
          --nstrc-profile-banner-placeholder-color-dark: #222222;
          --nstrc-profile-copy-foreground-color-light: #222;
          --nstrc-profile-copy-foreground-color-dark: #CCC;
  
          ${t}
  
          --nstrc-profile-accent: #ca077c;
  
          --nstrc-follow-btn-padding: 5px 8px !important;
          --nstrc-follow-btn-font-size: 14px !important;
          --nstrc-follow-btn-border-radius: 12px !important;
          --nstrc-follow-btn-border-dark: 1px solid #DDDDDD !important;
          --nstrc-follow-btn-border-light: 1px solid #DDDDDD !important;
          --nstrc-follow-btn-horizontal-alignment: end !important;
        }
  
          .nostr-profile .skeleton {
              animation: profile-skeleton-loading 0.5s linear infinite alternate;
          }
  
          @keyframes profile-skeleton-loading {
              0% {
                  background-color: hsl(var(--nstrc-profile-skeleton-min-hsl));
              }
              100% {
                  background-color: hsl(var(--nstrc-profile-skeleton-max-hsl));
              }
          }
  
        .nostr-profile {
          -webkit-tap-highlight-color: transparent;
          text-size-adjust: 100%;
          font-weight: 400;
          font-size: 18px;
          line-height: 1.5;
          text-rendering: optimizeLegibility;
          overflow-wrap: break-word;
          font-family: Nacelle, sans-serif;
          -webkit-font-smoothing: antialiased;
          box-sizing: border-box;
          background-repeat: no-repeat;
          min-height: 500px;
          border: 1px solid #CCC;
          border-radius: 5px;
          background-color: var(--nstrc-profile-background);
          cursor: pointer;
        }
  
        #profile {
          position: relative;
          background-color: var(--nstrc-profile-background);
          padding-bottom: 4px;
        }
  
        #profile_banner {
          width: 100%;
          height: 214px;
          overflow: hidden;
        }
  
        #profile_banner a {
          outline: none;
          color: var(--nstrc-profile-accent);
        }
  
        #profile_banner a img {
          color: var(--nstrc-profile-accent);
          max-width: 100%;
          border-style: none;
          display: block;
          z-index: 22;
          width: 100%;
          height: 214px;
          object-fit: cover;
        }
  
        #profile_banner .banner-placeholder {
          width: 100%;
          height: 214px;
          background-color: var(--nstrc-profile-banner-placeholder-color);
        }
  
        .dp_container {
          position: absolute;
          top: 140px;
          left: 15px;
          overflow: hidden;
        }
  
        .avatar_container {
          border: solid 4px var(--nstrc-profile-background);
          border-radius: 50%;
          background-color: var(--nstrc-profile-background);
        }
  
        .avatar_wrapper {
          display: block;
          min-height: 142px;
        }
  
        .xxl_avatar {
          position: relative;
          background-color: var(--nstrc-profile-background);
          border-radius: 50%;
          width: 142px;
          height: 142px;
        }
  
        .backfill {
          background-color: var(--nstrc-profile-background);
          border-radius: 50%;
          width: 142px;
          height: 142px;
        }
  
        .backfill a {
          outline: none;
        }
  
        .backfill a img {
          max-width: 100%;
          border-style: none;
          display: block;
          z-index: 22;
          border-radius: 50%;
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
  
        .profile_actions {
          height: 76px;
          display: flex;
          justify-content: end;
          align-items: center;
          padding: 0 18px;
        }
  
        .profile_data {
          display: block;
          margin-inline: 20px;
          min-height: 52px;
          margin-top: 14px;
        }
  
        .basic_info {
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
  
        .name {
          display: flex;
          align-items: center;
          justify-content: flex-start;
          max-width: 60%;
          height: 100%;
        }
  
        .name-text {
          color: var(--nstrc-profile-text-primary);
          font-size: 20px;
          line-height: 1;
          font-weight: 700;
          text-overflow: ellipsis;
          display: flex;
          align-items: center;
          vertical-align: baseline;
        }
  
        .verification-check {
          width: 20px;
          height: 20px;
        }
  
        .verification-icon {
          width: 20px;
          height: 20px;
          position: relative;
          display: flex;
          justify-content: center;
          align-items: center;
          margin-inline: 4px;
        }
  
        ._whiteCheckL_lfbpc_49 {
          width: 12px;
          height: 12px;
          top: 4px;
          left: 4px;
          border-radius: 50%;
          background-color: #fff;
          position: absolute;
        }
  
        ._verifiedIconPrimal_lfbpc_30 {
          width: 100%;
          height: 100%;
          background: var(--nstrc-profile-accent);
          mask: url(https://primal.net/assets/verified-84f47cd3.svg) no-repeat 0/100%;
        }
  
        .joined {
          font-weight: 400;
          font-size: 14px;
          line-height: 16px;
          text-align: right;
          color: var(--nstrc-profile-text-grey);
        }
  
        .nip05-wrapper {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          color: var(--nstrc-profile-text-grey);
          font-weight: 400;
          font-size: 14px;
          line-height: 16px;
          margin-top: 2px;
          margin-bottom: 16px;
        }
  
        .nip05-container {
          color: var(--nstrc-profile-text-grey);
          font-weight: 400;
          font-size: 14px;
          line-height: 16px;
          display: flex;
          align-items: center;
        }
  
        .nip05 {
          color: var(--nstrc-profile-text-grey);
          font-weight: 400;
          font-size: 14px;
          line-height: 16px;
          width: 100%;
          overflow: hidden;
        }
  
        .about {
          margin-inline: 20px;
          font-weight: 400;
          font-size: 14px;
          line-height: 20px;
          color: var(--nstrc-profile-text-primary);
        }
  
        .links {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-inline: 20px;
          margin-block: 12px;
        }
  
        .website {
          font-weight: 400;
          font-size: 14px;
          line-height: 20px;
          display: flex;
          align-items: center;
        }
  
        .website a {
          font-weight: 400;
          font-size: 14px;
          line-height: 20px;
          outline: none;
          color: var(--nstrc-profile-accent);
          max-width: 350px;
          overflow: hidden;
          text-overflow: ellipsis;
          word-wrap: normal;
        }
  
        .stats {
          position: relative;
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: space-between;
          align-items: center;
          padding-inline: 8px;
          border-radius: 0;
          padding-top: 22px;
          border-top: none;
          background-color: var(--nstrc-profile-background);
        }
  
        .stat {
          position: relative;
          display: inline-block;
          padding-inline: 14px;
          padding-block: 2px;
          border: none;
          background: none;
          width: fit-content;
          height: 40px;
          margin: 0 0 12px;
        }
  
        .stat-inner {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
        }
  
        .stat-inner .stat-value {
          font-weight: 400;
          font-size: 24px;
          line-height: 24px;
          color: var(--nstrc-profile-text-primary);
        }
  
        .stat-inner .stat-name {
          font-weight: 400;
          font-size: 14px;
          line-height: 16px;
          color: var(--nstrc-profile-text-grey);
          text-transform: lowercase;
        }
  
        .error-container {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 20px;
          min-height: 500px;
        }
  
        .error {
          width: 35px;
          height: 35px;
          border-radius: 50%;
          background-color: red;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 20px;
          color: #FFF;
        }
  
        .error-text {
          color: red;
          font-weight: bold;
        }
  
        .npub-container {
          display: flex;
          align-items: center;
          gap: 4px;
          margin-top: 6px;
        }
  
        .npub-container .npub {
          color: #a2a2a2;
        }
  
        .npub.full {
          display: inline !important;
        }
  
        .npub.masked {
          display: none !important;
        }
  
        .copy-button {
          display: flex;
          font-size: 16px;
          min-width: 15px;
          min-height: 15px;
          align-items: center;
          justify-content: center;
          border-radius: 5px;
          cursor: pointer;
          font-weight: bold;
          color: var(--nstrc-profile-copy-foreground-color);
        }
          
        .nip05 {
          display: flex;
          gap: 5px;
        }
  
        /* Recent Posts Section Styles */
        .recent-posts {
          margin: 0 20px 20px;
          padding-top: 16px;
          border-top: 1px solid rgba(128, 128, 128, 0.2);
        }
  
        .recent-posts-title {
          font-size: 16px;
          font-weight: 700;
          margin-bottom: 12px;
          color: var(--nstrc-profile-text-primary);
          display: flex;
          align-items: center;
          gap: 6px;
        }
  
        .recent-posts-title::before {
          content: "";
          display: inline-block;
          width: 4px;
          height: 16px;
          background-color: var(--nstrc-profile-accent);
          border-radius: 2px;
        }
  
        .post {
          padding: 12px 14px;
          margin-bottom: 10px;
          border-radius: 8px;
          background-color: var(--nstrc-profile-post-background);
          transition: transform 0.2s ease;
          border: 1px solid rgba(128, 128, 128, 0.1);
        }
  
        .post:hover {
          transform: translateY(-2px);
        }
  
        .post:last-child {
          margin-bottom: 0;
        }
  
        .post-content {
          font-size: 14px;
          line-height: 1.5;
          margin-bottom: 8px;
          color: var(--nstrc-profile-text-primary);
          word-break: break-word;
          white-space: pre-wrap;
        }
  
        .post-content a {
          color: var(--nstrc-profile-accent);
          text-decoration: none;
        }
  
        .post-content a:hover {
          text-decoration: underline;
        }
  
        .post-meta {
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
  
        .post-date {
          font-size: 12px;
          color: var(--nstrc-profile-text-grey);
          display: flex;
          align-items: center;
          gap: 4px;
        }
  
        .post-date::before {
          content: "\u2022";
          font-size: 14px;
        }
  
        .no-posts {
          font-size: 14px;
          color: var(--nstrc-profile-text-grey);
          font-style: italic;
          padding: 12px;
          text-align: center;
          border: 1px dashed rgba(128, 128, 128, 0.3);
          border-radius: 8px;
        }
  
        .post-skeleton {
          height: 80px;
          border-radius: 8px;
          margin-bottom: 10px;
        }
  
        @media only screen and (max-width: 600px) {
          button.stat .stat-value {
            font-size: 18px !important;
          }
  
          .npub.full {
            display: none !important;
          }
  
          .npub.masked {
            display: inline !important;
          }
          
          .post {
            padding: 10px 12px;
          }
          
          .post-content {
            font-size: 13px;
          }
        }
  
        @media only screen and (max-width: 600px) {
          :root {
            --nstrc-follow-btn-padding: 5px 8px !important;
            --nstrc-follow-btn-font-size: 12px !important;
            --nstrc-follow-btn-min-height: auto !important;
            --nstrc-follow-btn-border-radius: 8px !important;
            --nstrc-follow-btn-error-max-width: 150px !important;
          }
        }
  
      </style>
      `}renderNpub(){let t=this.getAttribute("npub"),n=this.getAttribute("show-npub");if(n==="false"||n===null&&this.userProfile.nip05||this.ndkUser==null)return"";if(!t&&!this.ndkUser.npub)return console.warn("Cannot use showNpub without providing a nPub"),"";let r=t;return!r&&this.ndkUser&&this.ndkUser.npub&&(r=this.ndkUser.npub),r?`
      <div class="npub-container">
        ${this.isLoading?'<div style="width: 100px; height: 8px; border-radius: 5px" class="skeleton"></div>':`
                <span class="npub full">${r}</span>
                <span class="npub masked">${ih(r)}</span>
                <span id="npub-copy" class="copy-button">&#x2398;</span>
            `}
      </div>
    `:(console.warn("Cannot use showNPub without providing a nPub"),"")}copy(t){navigator.clipboard.writeText(t)}onProfileClick(){if(this.isError)return;if(this.onClick!==null&&typeof this.onClick=="function"){this.onClick(this.userProfile);return}let t="",n=this.getAttribute("nip05"),r=this.getAttribute("npub");if(n)t=n;else if(r)t=r;else return;window.open(`https://njump.me/${t}`,"_blank")}attachEventListeners(){this.querySelector(".nostr-profile")?.addEventListener("click",t=>{t.target.closest(".nostr-follow-button-container")||this.onProfileClick()}),this.querySelector("#npub-copy")?.addEventListener("click",t=>{t.stopPropagation(),this.copy(this.getAttribute("npub")||this.ndkUser.npub||"")}),this.querySelector("#nip05-copy")?.addEventListener("click",t=>{t.stopPropagation(),this.copy(this.getAttribute("nip05")||this.userProfile.nip05||"")})}renderRecentPosts(){return this.showRecentPosts?this.isRecentPostsLoading?`
        <div class="recent-posts">
          <h3 class="recent-posts-title">Recent Posts</h3>
          <div class="post skeleton" style="width: 100%; height: 80px; border-radius: 8px; margin-bottom: 10px;"></div>
          <div class="post skeleton" style="width: 100%; height: 80px; border-radius: 8px; margin-bottom: 10px;"></div>
          <div class="post skeleton" style="width: 100%; height: 80px; border-radius: 8px;"></div>
        </div>
      `:this.recentPosts.length===0?`
        <div class="recent-posts">
          <h3 class="recent-posts-title">Recent Posts</h3>
          <div class="no-posts">No recent posts found</div>
        </div>
      `:`
      <div class="recent-posts">
        <h3 class="recent-posts-title">Recent Posts</h3>
        ${this.recentPosts.map(n=>{let r=n.content||"",s=n.created_at?(0,Io.default)(n.created_at*1e3).format("MMM D, YYYY"):"";return`
        <div class="post">
          <div class="post-content">${r}</div>
          <div class="post-date">${s}</div>
        </div>
      `}).join("")}
      </div>
    `:""}render(){this.innerHTML=this.getStyles(),(this.userProfile===void 0||this.userProfile.image===void 0||this.userProfile.displayName===void 0&&this.userProfile.name===void 0)&&(this.isError=!0);let t="";this.userProfile&&this.userProfile.created_at&&(t=(0,Io.default)(this.userProfile.created_at*1e3).format("MMM D, YYYY"));let n=this.getAttribute("show-follow")==="true";!this.isLoading&&this.isError?this.innerHTML+=`<div class="nostr-profile">
                <div class='error-container'>
                    <div class="error">&#9888;</div>
                    <span class="error-text">
                      Unable to load profile
                      <br/>
                      <small style="font-weight: normal">Please check console for more information</small>
                      </span>
                    </div>
            </div>
        `:this.innerHTML+=`
            <div class="nostr-profile">
                <div id="profile">
                    <div id="profile_banner">
                    ${this.isLoading?'<div style="width: 100%; height: 100%;" class="skeleton"></div>':this.userProfile.banner?`
                                <a
                                    target="_blank"
                                    data-cropped="true"
                                    class="profile_image"
                                    href="#"
                                    data-pswp-width="991"
                                    data-pswp-height="330.3333333333333"
                                    >
                                        <img
                                        id="4075d846142df0a70fde5fd340e774697c4a7b4f2fce3635b02e061afcd16139"
                                        src="${this.userProfile.banner}"
                                        width="524px"/>
                                    </a>
                            `:'<div class="banner-placeholder"></div>'}
                    </div>
                    <div class="dp_container">
                    <div class="avatar_container">
                        <div class="avatar_wrapper">
                        <div class="xxl_avatar">
                            <div class="backfill">
                            ${this.isLoading?'<div style="width: 100%; height: 100%; border-radius: 50%" class="skeleton"></div>':`
                                    <a
                                        target="_blank"
                                        data-cropped="true"
                                        class="profile_image roundedImage"
                                        href="#"
                                        data-pswp-width="991"
                                        data-pswp-height="989.6777851901267"
                                        ><img
                                        id="70f547f7e6e31ae6952f41d75d50a4ac13b9290d5d8e9e9eb89801501de242fd"
                                        src="${this.userProfile.image}"
                                        width="524px"
                                    /></a>
                                `}
                            </div>
                        </div>
                        </div>
                    </div>
                    </div>
                    <div class="profile_actions">
                      ${this.ndkUser&&this.ndkUser.npub&&n?`
                          <nostr-follow-button
                            npub="${this.ndkUser.npub}"
                            theme="${this.theme}"
                          ></nostr-follow-button>
                        `:""}
                    </div>
                    <div class="profile_data">
                    <div class="basic_info">
                        <div class="name">
                        ${this.isLoading?'<div style="width: 100px; height: 16px; border-radius: 20px" class="skeleton"></div>':`
                                <div class="name-text">${this.userProfile.displayName||this.userProfile.name}</div>
                            `}
                        </div>
                    </div>
                    <div class="nip05-wrapper">
                        <div class="nip05-container">
                        ${this.isLoading?'<div style="width: 75px; height: 8px; border-radius: 20px" class="skeleton"></div>':this.userProfile.nip05?`<div class="nip05">
                                  <span>${this.userProfile.nip05}</span>
                                  <span id="nip05-copy" class="copy-button">&#x2398;</span>
                                </div>`:""}
                        </div>

                        ${this.renderNpub()}
                    </div>
                    </div>
                    
                    <div class="about">
                        ${this.isLoading?`
                                <div style="width: 100%; height: 12px; border-radius: 20px; margin-bottom: 12px" class="skeleton"></div>
                                <div style="width: 40%; height: 12px; border-radius: 20px" class="skeleton"></div>
                            `:this.userProfile.about||""}
                    </div>
                    <div class="links">
                    ${this.isLoading?'<div style="width: 150px; height: 12px; border-radius: 20px" class="skeleton"></div>':this.userProfile.website?`
                                <div class="website">
                                    <a target="_blank" href="${this.userProfile.website}"
                                    >${this.userProfile.website}</a
                                    >
                                </div>
                            `:""}
                    </div>
                </div>
                <div class="stats" data-orientation="horizontal">
                    ${this.isStatsError?'<p class="error-text">Error loading stats</p>':`
                        <button class="stat" data-orientation="horizontal">
                            <div class="stat-inner">
                                <div class="stat-value">
                                    ${this.isStatsNotesLoading?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':this.stats.notes}
                                </div>
                                <div class="stat-name">Notes</div>
                            </div>
                        </button>
                        
                        <button class="stat" data-orientation="horizontal">
                            <div class="stat-inner">
                                <div class="stat-value">
                                    ${this.isStatsNotesLoading?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':this.stats.replies}
                                </div>
                                <div class="stat-name">Replies</div>
                            </div></button>
                        
                        <!-- TODO: Add zaps after resolving the doubts
                        <button class="stat" data-orientation="horizontal">
                            <div class="stat-inner">
                                <div class="stat-value">
                                    ${this.isStatsLoading?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':this.stats.zaps}
                                </div>
                                <div class="stat-name">Zaps</div>
                            </div>
                        </button>
                        -->
                        
                        <button class="stat" data-orientation="horizontal">
                            <div class="stat-inner">
                                <div class="stat-value">
                                    ${this.isStatsFollowsLoading?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':this.stats.follows}
                                </div>
                                <div class="stat-name">Following</div>
                            </div>
                        </button>

                        <button class="stat" data-orientation="horizontal">
                            <div class="stat-inner">
                                <div class="stat-value">
                                    ${this.isStatsFollowersLoading?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':this.stats.followers}
                                </div>
                                <div class="stat-name">Followers</div>
                            </div>
                        </button>
                        
                        <!--
                        <button class="stat" data-orientation="horizontal">
                            <div class="stat-inner">
                                <div class="stat-value">
                                    ${this.isStatsRelaysLoading?'<div style="width: 20px; height: 28px; border-radius: 5px" class="skeleton"></div>':this.stats.relays}
                                </div>
                                <div class="stat-name">Relays</div>
                            </div>
                        </button>
                        -->
                      `}
                </div>
                ${this.renderRecentPosts()}
            </div>
        `,this.attachEventListeners()}};customElements.define("nostr-profile",Lo);export{Lo as default};
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
